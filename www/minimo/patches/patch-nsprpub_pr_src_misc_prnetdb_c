$OpenBSD: patch-nsprpub_pr_src_misc_prnetdb_c,v 1.2 2005/07/13 04:49:56 jolan Exp $
--- nsprpub/pr/src/misc/prnetdb.c.orig	Wed Mar  9 19:53:04 2005
+++ nsprpub/pr/src/misc/prnetdb.c	Tue Jul 12 22:06:58 2005
@@ -101,6 +101,7 @@ PRLock *_pr_dnsLock = NULL;
 #endif
 
 #if defined(OSF1) \
+	|| defined(OPENBSD) \
         || defined(AIX4_3_PLUS) || (defined(AIX) && defined(_THREAD_SAFE)) \
 	|| (defined(HPUX10_10) && defined(_REENTRANT)) \
         || (defined(HPUX10_20) && defined(_REENTRANT))
@@ -2110,7 +2111,12 @@ PR_IMPLEMENT(PRAddrInfo *) PR_GetAddrInf
          */
         hints.ai_socktype = SOCK_STREAM;
 
+	LOCK_DNS();
+
         rv = GETADDRINFO(hostname, NULL, &hints, &res);
+
+	UNLOCK_DNS();
+
         if (rv == 0)
             return (PRAddrInfo *) res;
 
