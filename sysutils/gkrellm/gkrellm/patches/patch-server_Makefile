$OpenBSD: patch-server_Makefile,v 1.8 2007/10/26 22:56:57 ajacoutot Exp $
--- server/Makefile.orig	Fri Oct 26 15:06:21 2007
+++ server/Makefile	Fri Oct 26 15:07:54 2007
@@ -2,12 +2,9 @@ PACKAGE_D ?= gkrellmd
 PKG_CONFIG ?= pkg-config
 BINMODE ?= 755
 
-INSTALLROOT ?= $(DESTDIR)$(PREFIX)
-ifeq ($(INSTALLROOT),)
-	INSTALLROOT = /usr/local
-endif
+INSTALLROOT ?= $(PREFIX)
 
-SINSTALLDIR ?= $(INSTALLROOT)/bin
+SINSTALLDIR ?= $(INSTALLROOT)/sbin
 INSTALLDIRMODE ?= 755
 
 INCLUDEDIR ?= $(INSTALLROOT)/include
@@ -17,11 +14,11 @@ INCLUDEDIRMODE ?= 755
 LIBDIR ?= $(INSTALLROOT)/lib
 LIBDIRMODE ?= 755
 
-SMANDIR ?= $(INSTALLROOT)/share/man/man1
+SMANDIR ?= $(INSTALLROOT)/man/man1
 MANMODE ?= 644
 MANDIRMODE ?= 755
 INSTALL ?= install
-LINK_FLAGS ?= -Wl,-E
+LINK_FLAGS ?= -Wl
 EXTRAOBJS =
 
 
@@ -51,23 +48,23 @@ PKG_LIB = `$(PKG_CONFIG) --libs glib-2.0 gmodule-2.0 g
 GLIB12_INCLUDE = `glib-config --cflags`
 GLIB12_LIB = `glib-config --libs glib gmodule`
 
-FLAGS = -O2 -I.. $(PKG_INCLUDE) $(GTOP_INCLUDE)
+FLAGS = -I.. $(PKG_INCLUDE) $(GTOP_INCLUDE)
 ifeq ($(glib12),1)
-FLAGS = -O2 -I.. $(GLIB12_INCLUDE) $(GTOP_INCLUDE)
+FLAGS = -I.. $(GLIB12_INCLUDE) $(GTOP_INCLUDE)
 endif
 ifeq ($(glib12),yes)
-FLAGS = -O2 -I.. $(GLIB12_INCLUDE) $(GTOP_INCLUDE)
+FLAGS = -I.. $(GLIB12_INCLUDE) $(GTOP_INCLUDE)
 endif
 
 FLAGS+= $(PTHREAD_INC)
 
-LIBS = $(PKG_LIB) $(GTOP_LIBS_D) $(SYS_LIBS) $(SENSORS_LIBS)
+LIBS += $(PKG_LIB) $(GTOP_LIBS_D) $(SYS_LIBS) $(SENSORS_LIBS)
 
 ifeq ($(glib12),1)
-LIBS = $(GLIB12_LIB) $(GTOP_LIBS_D) $(SYS_LIBS) $(SENSORS_LIBS)
+LIBS += $(GLIB12_LIB) $(GTOP_LIBS_D) $(SYS_LIBS) $(SENSORS_LIBS)
 endif
 ifeq ($(glib12),yes)
-LIBS = $(GLIB12_LIB) $(GTOP_LIBS_D) $(SYS_LIBS) $(SENSORS_LIBS)
+LIBS += $(GLIB12_LIB) $(GTOP_LIBS_D) $(SYS_LIBS) $(SENSORS_LIBS)
 endif
 
 ifeq ($(debug),1)
@@ -100,7 +97,7 @@ ifeq ($(HAVE_GETADDRINFO),1)
 endif
 
 
-override CC += -Wall $(FLAGS)
+CFLAGS += $(FLAGS)
 
 OS_NAME=$(shell uname -s)
 OS_RELEASE=$(shell uname -r)
