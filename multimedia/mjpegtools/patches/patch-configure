$OpenBSD: patch-configure,v 1.3 2006/01/10 02:23:37 jakemsr Exp $
--- configure.orig	Tue Feb  3 14:58:37 2004
+++ configure	Sun Jan  8 15:18:30 2006
@@ -22483,10 +22483,10 @@ fi
 
 # FreeBSD and OpenBSD have neither -lpthread nor integrated pthreads in libc.
 # Instead -pthread is used to the compiler/linker to get pthreads working right.
-if test x$OS_ARCH = xFreeBSD -o x$OS_ARCH = xOpenBSD; then
-   CFLAGS="$CFLAGS -pthread"
-   CXXFLAGS="$CXXFLAGS -pthread"
-fi
+#if test x$OS_ARCH = xFreeBSD -o x$OS_ARCH = xOpenBSD; then
+#   CFLAGS="$CFLAGS -pthread"
+#   CXXFLAGS="$CXXFLAGS -pthread"
+#fi
 
 
 case "$HOSTTYPE" in
@@ -22965,13 +22965,13 @@ rm -f conftest.$ac_objext conftest$ac_ex
 
 
 have_pthread=false
-echo "$as_me:$LINENO: checking for pthread_create in -lpthread" >&5
-echo $ECHO_N "checking for pthread_create in -lpthread... $ECHO_C" >&6
+echo "$as_me:$LINENO: checking for pthread_create in -pthread" >&5
+echo $ECHO_N "checking for pthread_create in -pthread... $ECHO_C" >&6
 if test "${ac_cv_lib_pthread_pthread_create+set}" = set; then
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-lpthread  $LIBS"
+LIBS="-pthread  $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 #line $LINENO "configure"
 /* confdefs.h.  */
@@ -23020,7 +23020,7 @@ fi
 echo "$as_me:$LINENO: result: $ac_cv_lib_pthread_pthread_create" >&5
 echo "${ECHO_T}$ac_cv_lib_pthread_pthread_create" >&6
 if test $ac_cv_lib_pthread_pthread_create = yes; then
-   PTHREAD_LIBS="-lpthread"
+   PTHREAD_LIBS="-pthread"
 
 cat >>confdefs.h <<\_ACEOF
 #define HAVE_LIBPTHREAD 1
@@ -23570,6 +23570,7 @@ if test x$with_dv = x ; then
 fi
 
 have_dv=false
+if test x"$with_dv" != x"no"; then
 EXTRA_LIBS=" $LIBM_LIBS $GLIB_LIBS  $PTHREAD_LIBS"
 echo "$as_me:$LINENO: checking for dv_decoder_free in -ldv" >&5
 echo $ECHO_N "checking for dv_decoder_free in -ldv... $ECHO_C" >&6
@@ -23635,8 +23636,8 @@ _ACEOF
 
     have_dv=true
 fi
+fi  # with_dv != no
 
-
 have_dv_yv12=false
 if test x$with_dv_yv12 = xyes -a $have_dv = true; then
 
@@ -25852,7 +25853,7 @@ echo "$as_me:$LINENO: checking x86 sub-a
 echo $ECHO_N "checking x86 sub-architecture settings... $ECHO_C" >&6
 
   if test "$enable_cmov_extension" != "no" ; then
-    arch=`uname -m`
+    arch=i`sysctl hw.model | sed -e 's,.*\(.86\)-class.*,\1,' | grep '^[456]86$' || echo 386`
   else
     arch=i586
   fi
@@ -26013,9 +26014,10 @@ else
 fi
 
 
-
+if test "$enable_simd_accel" != "false" -a "$enable_simd_accel" != "no" ; then
 CFLAGS="$ARCHFLAGS $CFLAGS"
 CXXFLAGS="$ARCHFLAGS $CXXFLAGS"
+fi
 if test "x${GCC}" != "xyes" ; then
   enable_compile_warnings=no
 fi
