$OpenBSD: patch-proto_bgp_attrs_c,v 1.1 2009/08/25 20:32:09 sthen Exp $

Fixes bug related to AS2->AS4 conversion, from upstream repo.

--- proto/bgp/attrs.c.orig	Tue Aug 25 20:59:18 2009
+++ proto/bgp/attrs.c	Tue Aug 25 20:59:33 2009
@@ -1189,7 +1189,7 @@ bgp_reconstruct_4b_atts(struct bgp_proto *p, rta *a, s
     if (a4)
       log(L_WARN "%s: AS4_AGGREGATOR attribute received, but AGGREGATOR attribute is missing", p->p.name);
 
-  int p2_len = as_path_getlen(p2->u.ptr);
+  int p2_len = as_path_getlen_int(p2->u.ptr, 2);
   int p4_len = p4 ? validate_as4_path(p, p4->u.ptr) : -1;
 
   if (p4 && (p4_len < 0))
