$OpenBSD: patch-lib_MailScanner_Message_pm,v 1.10 2011/03/02 23:38:52 sthen Exp $
--- lib/MailScanner/Message.pm.orig	Tue Jan 25 11:20:32 2011
+++ lib/MailScanner/Message.pm	Wed Feb 23 21:58:12 2011
@@ -731,12 +731,19 @@ sub IsSpam {
   # rblspamheader is useful start to spamreport if RBLsaysspam.
 
   # Do the Custom Spam Checker
-  my($gsscore, $gsreport);
+  my($gsscore, $gsreport, @gsheaders);
   #print STDERR "In Message.pm about to look at gsscanner\n";
   if ($usegsscanner) {
     #print STDERR "In Message.pm about to run gsscanner\n";
-    ($gsscore, $gsreport) = MailScanner::GenericSpam::Checks($this);
+    ($gsscore, $gsreport, @gsheaders) = MailScanner::GenericSpam::Checks($this);
     #print STDERR "In Message.pm we got $gsscore, $gsreport\n";
+    foreach my $line (@gsheaders) {
+      my ($header,$val)=split(/:/,$line);
+      #print STDERR "In Message.pm we got gsheader $line <${header}|${val}>\n";
+      $global::MS->{mta}->AddHeader($this,
+                                    "$header:",
+                                    $val);
+    }
     $this->{gshits} = $gsscore;
     $this->{gsreport} = $gsreport;
     $this->{sascore} += $gsscore; # Add the score
