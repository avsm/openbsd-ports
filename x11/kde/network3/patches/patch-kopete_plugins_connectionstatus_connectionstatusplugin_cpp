$OpenBSD: patch-kopete_plugins_connectionstatus_connectionstatusplugin_cpp,v 1.1 2006/05/06 23:19:13 brad Exp $
--- kopete/plugins/connectionstatus/connectionstatusplugin.cpp.orig	Sat May  6 18:11:09 2006
+++ kopete/plugins/connectionstatus/connectionstatusplugin.cpp	Sat May  6 18:13:58 2006
@@ -60,7 +60,9 @@ void ConnectionStatusPlugin::slotCheckSt
 
 		return;
 	}
-	
+
+	m_buffer = QString::null;
+
 	// Use KProcess to run netstat -rn. We'll then parse the output of
 	// netstat -rn in slotProcessStdout() to see if it mentions the
 	// default gateway. If so, we're connected, if not, we're offline
@@ -83,6 +85,8 @@ void ConnectionStatusPlugin::slotProcess
 {
 	if ( process == m_process )
 	{
+		setConnectedStatus( m_buffer.contains( "default" ) );
+		m_buffer = QString::null;
 		delete m_process;
 		m_process = 0L;
 	}
@@ -92,9 +96,8 @@ void ConnectionStatusPlugin::slotProcess
 {
 	// Look for a default gateway
 	//kdDebug( 14301 ) << k_funcinfo << endl;
-	QString qsBuffer = QString::fromLatin1( buffer, buflen );
+	m_buffer += QString::fromLatin1( buffer, buflen );
 	//kdDebug( 14301 ) << qsBuffer << endl;
-	setConnectedStatus( qsBuffer.contains( "default" ) );
 }
 
 void ConnectionStatusPlugin::setConnectedStatus( bool connected )
