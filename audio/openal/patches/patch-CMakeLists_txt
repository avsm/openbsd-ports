$OpenBSD: patch-CMakeLists_txt,v 1.1 2011/06/25 18:42:02 jasper Exp $
--- CMakeLists.txt.orig	Fri Jun 24 03:02:57 2011
+++ CMakeLists.txt	Sat Jun 25 20:46:26 2011
@@ -50,7 +50,7 @@ OPTION(REQUIRE_PULSEAUDIO "Require PulseAudio backend"
 OPTION(REQUIRE_COREAUDIO  "Require CoreAudio backend"          OFF)
 OPTION(REQUIRE_OPENSL     "Require OpenSL backend"             OFF)
 
-OPTION(DLOPEN  "Check for the dlopen API for loading optional libs"  ON)
+OPTION(DLOPEN  "Check for the dlopen API for loading optional libs"  OFF)
 
 OPTION(WERROR  "Treat compile warnings as errors"      OFF)
 
@@ -145,13 +145,13 @@ ELSE()
         ADD_DEFINITIONS(-Werror)
     ENDIF()
 
-    SET(CMAKE_C_FLAGS_RELWITHDEBINFO "-g -O2 -D_DEBUG" CACHE STRING
+    SET(CMAKE_C_FLAGS_RELWITHDEBINFO "-g -D_DEBUG" CACHE STRING
         "Flags used by the compiler during Release with Debug Info builds."
         FORCE)
-    SET(CMAKE_C_FLAGS_MINSIZEREL "-Os -DNDEBUG" CACHE STRING
+    SET(CMAKE_C_FLAGS_MINSIZEREL "-DNDEBUG" CACHE STRING
         "Flags used by the compiler during release minsize builds."
         FORCE)
-    SET(CMAKE_C_FLAGS_RELEASE "-O2 -fomit-frame-pointer -DNDEBUG" CACHE STRING
+    SET(CMAKE_C_FLAGS_RELEASE "-fomit-frame-pointer -DNDEBUG" CACHE STRING
         "Flags used by the compiler during release builds"
         FORCE)
     SET(CMAKE_C_FLAGS_DEBUG "-g3 -D_DEBUG" CACHE STRING
@@ -508,6 +508,15 @@ ENDIF()
 
 # Check PortAudio backend
 IF(PORTAUDIO)
+    IF(${CMAKE_SYSTEM_NAME} STREQUAL "OpenBSD")
+        INCLUDE(FindPkgConfig)
+        PKG_CHECK_MODULES(PORTAUDIO REQUIRED portaudio-2.0)
+        INCLUDE_DIRECTORIES("${PORTAUDIO_INCLUDE_DIRS}")
+        LINK_DIRECTORIES("${PORTAUDIO_LIBRARY_DIRS}")
+        SET(HAVE_PORTAUDIO 1)
+        SET(HAVE_LIBPORTAUDIO 1)
+        SET(HAVE_PORTAUDIO_H 1)
+    ENDIF()
     CHECK_INCLUDE_FILE(portaudio.h HAVE_PORTAUDIO_H)
     IF(HAVE_PORTAUDIO_H)
         CHECK_SHARED_LIBRARY_EXISTS(portaudio Pa_Initialize 0 "" HAVE_LIBPORTAUDIO)
