# $OpenBSD: patch-aa,v 1.6 1999/07/01 22:07:44 form Exp $

--- bsd/kernel.cc.orig	Tue Feb 16 20:09:21 1999
+++ bsd/kernel.cc	Fri Jul  2 04:46:10 1999
@@ -67,7 +67,11 @@
 
 #ifdef HAVE_SWAPCTL
 #include <unistd.h>		/*  For swapctl proto.  */
+#ifdef XOSVIEW_OPENBSD
+#include <sys/swap.h>
+#else
 #include <vm/vm_swap.h>		/*  For swapent, SWAP_*.  */
+#endif
 #include <stdlib.h>		/*  For malloc(), free().  */
 #endif
 
@@ -110,9 +114,9 @@
 { "_eintrcnt" },
 #define EINTRCNT_SYM_INDEX 	8
 
-#if defined(XOSVIEW_OPENBSD) && (defined(pc532) || defined(i386))
+#if defined(XOSVIEW_OPENBSD) && (defined(__pc532__) || defined(__i386__))
 
-# ifdef i386
+# ifdef __i386__
 { "_intrhand" },
 #define INTRHAND_SYM_INDEX    9
 { "_intrstray" },
@@ -661,7 +665,7 @@
 }
 
 /*  ---------------------- Interrupt Meter stuff  -----------------  */
-#if !defined(XOSVIEW_OPENBSD) || !(defined(pc532) && defined(i386))
+#if !defined(XOSVIEW_OPENBSD) || !(defined(__pc532__) || defined(__i386__))
 static unsigned long kvm_intrcnt[128];// guess at space needed
 #endif
 
@@ -672,16 +676,16 @@
 int
 BSDIntrInit() {
     OpenKDIfNeeded();
-#if defined(XOSVIEW_OPENBSD) && defined(i386)
+#if defined(XOSVIEW_OPENBSD) && defined(__i386__)
     return ValidSymbol(INTRHAND_SYM_INDEX) && ValidSymbol(INTRSTRAY_SYM_INDEX);
-#elif defined (XOSVIEW_OPENBSD) && defined(pc532)
+#elif defined (XOSVIEW_OPENBSD) && defined(__pc532__)
     return ValidSymbol(IVP_SYM_INDEX);
 #else
     return ValidSymbol(INTRCNT_SYM_INDEX) && ValidSymbol(EINTRCNT_SYM_INDEX);
 #endif
 }
 
-#if !defined(XOSVIEW_OPENBSD) || !(defined(pc532) || defined(i386))
+#if !defined(XOSVIEW_OPENBSD) || !(defined(__pc532__) || defined(__i386__))
 int
 BSDNumInts() {
   int nintr;
@@ -702,7 +706,7 @@
 # endif
 #endif
 }
-#endif /* XOSVIEW_OPENBSD */
+#endif /* XOSVIEW_OPENBSD && !(__i386__ || __pc532__) */
 
 void
 BSDGetIntrStats (unsigned long intrCount[NUM_INTR]) {
@@ -727,8 +731,8 @@
   //  counts.  We'll just use the intrcnt array here.  If anyone
   //  has problems, please mail me.  bgrayson
   {
-#if defined(XOSVIEW_OPENBSD) && (defined(pc532) || defined(i386))
-# ifdef i386
+#if defined(XOSVIEW_OPENBSD) && (defined(__pc532__) || defined(__i386__))
+# ifdef __i386__
   struct intrhand *intrhand[16], *ihp, ih;
   int intrstray[16];
 
@@ -749,8 +753,8 @@
       ihp = ih.ih_next;
     }
   }
-# endif /* i386 */
-# ifdef pc532
+# endif /* __i386__ */
+# ifdef __pc532__
   struct iv ivt[32], *ivp = ivt;
 
   safe_kvm_read(nlst[IVP_SYM_INDEX].n_value, ivp, sizeof(ivt));
@@ -760,15 +764,15 @@
     else
       intrCount[i] = 0;
   }
-# endif /* pc532 */
-#else /* XOSVIEW_OPENBSD && (pc532 || i386) */
+# endif /* __pc532__ */
+#else /* XOSVIEW_OPENBSD && (__pc532__ || __i386__) */
     int nintr = BSDNumInts();
     safe_kvm_read(nlst[INTRCNT_SYM_INDEX].n_value, kvm_intrcnt,
       sizeof(long)*nintr);
     for (int i=0;i<nintr;i++) {
       intrCount[i] = kvm_intrcnt[i];
     }
-#endif /* XOSVIEW_OPENBSD && (pc532 || i386) */
+#endif /* XOSVIEW_OPENBSD && (__pc532__ || __i386__) */
   }
   return;
 #endif
