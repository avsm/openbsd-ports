# $OpenBSD: Makefile,v 1.15 1999/10/27 22:54:42 brad Exp $
# $FreeBSD: Makefile,v 1.7 1999/02/12 21:55:04 obrien Exp $

DISTNAME=	proftpd-1.2.0pre9
PKGNAME=	proftpd-1.2.0
CATEGORIES=	net
MASTER_SITES=	ftp://ftp.tos.net/pub/proftpd/ \

NEED_VERSION=	1.73

# If you remove that BROKEN line, the port will build.
#
# But there have been a series of holes and exploits posted recently,
# so using proftpd is a sure way to let yourself be vulnerable.
#
# It is recommended that you don't use proftpd for now, 
# unless you're really sure you know what you are doing.
#
BROKEN=	"Needs a security audit. Use at your own risk"

MAINTAINER=	brad@openbsd.org

USE_GMAKE=	yes
GNU_CONFIGURE=	yes
CONFIGURE_ARGS=	--localstatedir="/var/run" \
		--with-modules="mod_ratio:mod_readme"

post-configure:
	@${MV} ${WRKSRC}/src/proftpd.8 ${WRKSRC}/src/proftpd.8.pre_sed
	@${SED}	-e 's:/usr/sbin/proftpd:${PREFIX}/libexec/proftpd:' \
		-e 's:/usr/sbin:${PREFIX}/sbin:' \
		-e 's:/usr/bin:${PREFIX}/bin:' \
		-e 's:/var/run:/var/run/proftpd:' \
		< ${WRKSRC}/src/proftpd.8.pre_sed > ${WRKSRC}/src/proftpd.8
	@${MV} ${WRKSRC}/src/ftpshut.8 ${WRKSRC}/src/ftpshut.8.pre_sed
	@${SED}	-e 's:/usr/sbin:${PREFIX}/sbin:' \
		-e 's:/etc:/var/run:' \
		-e 's:/var/run:/var/run/proftpd:' \
		< ${WRKSRC}/src/ftpshut.8.pre_sed > ${WRKSRC}/src/ftpshut.8
	@${MV} ${WRKSRC}/src/ftpcount.1 ${WRKSRC}/src/ftpcount.1.pre_sed
	@${SED}	-e 's:/usr/bin:${PREFIX}/bin:' \
		-e 's:/var/run:/var/run/proftpd:' \
		< ${WRKSRC}/src/ftpcount.1.pre_sed > ${WRKSRC}/src/ftpcount.1
	@${MV} ${WRKSRC}/src/ftpwho.1 ${WRKSRC}/src/ftpwho.1.pre_sed
	@${SED}	-e 's:/usr/bin:${PREFIX}/bin:' \
		-e 's:/var/run:/var/run/proftpd:' \
		< ${WRKSRC}/src/ftpwho.1.pre_sed > ${WRKSRC}/src/ftpwho.1

do-install:
	@${MKDIR} ${PREFIX}/lib/proftpd
	${INSTALL_PROGRAM} ${WRKSRC}/ftpcount ${PREFIX}/bin
	${INSTALL_PROGRAM} ${WRKSRC}/ftpwho ${PREFIX}/bin
	${INSTALL_PROGRAM} ${WRKSRC}/proftpd ${PREFIX}/libexec
	${INSTALL_PROGRAM} ${WRKSRC}/ftpshut ${PREFIX}/sbin
	${INSTALL_MAN} ${WRKSRC}/src/ftpcount.1 ${PREFIX}/man/man1
	${INSTALL_MAN} ${WRKSRC}/src/ftpwho.1 ${PREFIX}/man/man1
	${INSTALL_MAN} ${WRKSRC}/src/xferlog.5 ${PREFIX}/man/man5
	${INSTALL_MAN} ${WRKSRC}/src/ftpshut.8 ${PREFIX}/man/man8
	${INSTALL_MAN} ${WRKSRC}/src/proftpd.8 ${PREFIX}/man/man8
	${INSTALL_DATA} ${WRKSRC}/sample-configurations/basic.conf ${PREFIX}/lib/proftpd/proftpd.conf.sample

post-install:
	@PKG_PREFIX="${PREFIX}" ${SH} ${PKGDIR}/INSTALL ${DISTNAME} POST-INSTALL

.include <bsd.port.mk>
