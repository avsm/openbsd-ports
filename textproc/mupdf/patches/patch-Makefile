$OpenBSD: patch-Makefile,v 1.2 2010/09/03 12:38:19 sthen Exp $
--- Makefile.orig	Wed Aug 25 15:12:08 2010
+++ Makefile	Fri Sep  3 13:21:43 2010
@@ -44,13 +44,15 @@ CFLAGS += $(THIRD_INCS) $(SYS_FREETYPE_INC)
 ifneq "$(verbose)" ""
 
 GENFILE_CMD = $(firstword $^) $@ $(wordlist 2, 999, $^)
+AS_CMD = $(AS) -o $@ $<
 CC_CMD = $(CC) -o $@ -c $< $(CFLAGS)
 LD_CMD = $(CC) -o $@ $^ $(LDFLAGS) $(LIBS)
-AR_CMD = rm -f $@ && $(AR) cru $@ $^
+AR_CMD = $(AR) cru $@ $^
 
 else
 
 GENFILE_CMD = @ echo GENFILE $@ && $(firstword $^) $@ $(wordlist 2, 999, $^)
+AS_CMD = @ echo AS $@ && $(AS) -o $@ $<
 CC_CMD = @ echo CC $@ && $(CC) -o $@ -c $< $(CFLAGS)
 LD_CMD = @ echo LD $@ && $(CC) -o $@ $^ $(LDFLAGS) $(LIBS)
 AR_CMD = @ echo AR $@ && rm -f $@ && $(AR) cru $@ $^
@@ -65,6 +67,10 @@ FONTDUMP_EXE := $(OBJDIR)/fontdump
 $(FONTDUMP_EXE): $(OBJDIR)/fontdump.o
 	$(LD_CMD)
 
+FONTRES_EXE=$(OBJDIR)/fontres
+$(FONTRES_EXE): $(OBJDIR)/fontres.o
+	$(LD_CMD)
+
 CMAPDUMP_EXE := $(OBJDIR)/cmapdump
 $(CMAPDUMP_EXE): $(OBJDIR)/cmapdump.o
 	$(LD_CMD)
@@ -179,6 +185,8 @@ $(OBJDIR)/%.o: mupdf/%.c
 	$(CC_CMD)
 $(OBJDIR)/%.o: $(GENDIR)/%.c
 	$(CC_CMD)
+$(OBJDIR)/%.o: $(GENDIR)/%.s
+	$(AS_CMD)
 
 #
 # Generated font file dumps
@@ -206,18 +214,18 @@ CJKFONT_FILES := \
 
 ifeq "$(pregen)" ""
 
-$(GENDIR)/font_base14.c: $(FONTDUMP_EXE) $(BASEFONT_FILES)
+$(GENDIR)/font_base14.s: $(FONTRES_EXE) $(BASEFONT_FILES)
 	$(GENFILE_CMD)
-$(GENDIR)/font_cjk.c: $(FONTDUMP_EXE) $(CJKFONT_FILES)
+$(GENDIR)/font_cjk.s: $(FONTRES_EXE) $(CJKFONT_FILES)
 	$(GENFILE_CMD)
 
 endif
 
 FONT_SRC := \
-	$(GENDIR)/font_base14.c \
-	$(GENDIR)/font_cjk.c
+	$(GENDIR)/font_base14.s \
+	$(GENDIR)/font_cjk.s
 
-FONT_OBJ := $(FONT_SRC:$(GENDIR)/%.c=$(OBJDIR)/%.o)
+FONT_OBJ := $(FONT_SRC:$(GENDIR)/%.s=$(OBJDIR)/%.o)
 
 
 #
