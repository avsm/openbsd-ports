--- konq-embed/dropin/klibloader.cpp.orig	Wed May 14 03:07:54 2003
+++ konq-embed/dropin/klibloader.cpp	Fri May 16 20:50:38 2003
@@ -27,6 +27,8 @@
 #include "kglobal.h"
 #include <kstddirs.h>
 
+#include <stdlib.h>
+#include <string.h>
 #include <assert.h>
 
 #if defined(HAVE_DLFCN)
@@ -86,7 +88,19 @@ KDLOpenLibrary::~KDLOpenLibrary()
 
 void *KDLOpenLibrary::symbol( const char *name )
 {
-    return dlsym( m_handle, name );
+    void *res = dlsym( m_handle, name );
+#ifdef __OpenBSD__
+    if ( !res ) {
+	char *name2 = (char *)malloc(strlen(name)+2);
+	if (name2) {
+	   name2[0] = '_';
+	   strcpy(name2+1, name);
+	   res = dlsym( m_handle, name2);
+	   free(name2);
+	}
+    }
+#endif
+    return res;
 }
 #endif
 
@@ -141,6 +155,9 @@ KLibrary *KLibLoader::library( const cha
 
 KLibrary *KLibLoader::globalLibrary( const char *name )
 {
+#ifndef RTLD_GLOBAL
+# define RTLD_GLOBAL 0
+#endif 
 #if defined(HAVE_DLFCN)
     void *handle = dlopen( name, RTLD_LAZY | RTLD_GLOBAL );
     if ( !handle )
