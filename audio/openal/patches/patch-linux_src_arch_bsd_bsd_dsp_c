$OpenBSD: patch-linux_src_arch_bsd_bsd_dsp_c,v 1.1.1.1 2004/10/21 05:04:16 jolan Exp $
--- linux/src/arch/bsd/bsd_dsp.c.orig	2003-06-20 11:18:33.000000000 -0700
+++ linux/src/arch/bsd/bsd_dsp.c	2004-01-10 08:23:30.000000000 -0800
@@ -15,7 +15,7 @@
 
 #include <assert.h>
 #include <fcntl.h>
-#include <sys/soundcard.h>
+#include <soundcard.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
@@ -112,7 +112,7 @@ static int AL2BSDFMT(int fmt)
  *
  */
 void *grab_write_native(void) {
-	const char *dsppath = "/dev/dsp";
+	const char *dsppath = "/dev/audio";
 	int divisor = _alSpot(_AL_DEF_BUFSIZ) | (2<<16);
 
 	dsp_fd = open(dsppath, O_WRONLY | O_NONBLOCK);
@@ -148,9 +148,11 @@ int grab_mixerfd(void) {
 	mixer_fd = open("/dev/mixer", O_WRONLY | O_NONBLOCK);
 
 	if(mixer_fd > 0) {
+#if 0
 		if(fcntl(mixer_fd, F_SETFL, ~O_NONBLOCK) == -1) {
 			perror("fcntl");
 		}
+#endif
 
 		return mixer_fd;
 	} else {
@@ -212,7 +214,7 @@ void release_native(void *handle) {
 
 	handle_fd = *(int *) handle;
 
-	if(ioctl(handle_fd, SNDCTL_DSP_RESET) < 0) {
+	if(ioctl(handle_fd, SNDCTL_DSP_RESET, NULL) < 0) {
 #ifdef DEBUG_MAXIMUS
 		fprintf(stderr, "Couldn't reset dsp\n");
 #endif
