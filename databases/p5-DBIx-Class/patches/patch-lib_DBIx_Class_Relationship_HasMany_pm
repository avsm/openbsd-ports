$OpenBSD: patch-lib_DBIx_Class_Relationship_HasMany_pm,v 1.1 2006/12/06 15:09:08 espie Exp $
--- lib/DBIx/Class/Relationship/HasMany.pm.orig	Wed Dec  6 15:56:28 2006
+++ lib/DBIx/Class/Relationship/HasMany.pm	Wed Dec  6 15:57:00 2006
@@ -16,6 +16,10 @@ sub has_many {
       "${class} has more"
     ) if $too_many;
 
+    $class->throw_exception(
+      "has_many needs a primary key to infer a join; ".
+      "${class} has none"
+    ) if !defined $pri;
     my ($f_key,$guess);
     if (defined $cond && length $cond) {
       $f_key = $cond;
