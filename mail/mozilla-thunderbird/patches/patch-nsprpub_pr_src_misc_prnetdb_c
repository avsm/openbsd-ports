$OpenBSD: patch-nsprpub_pr_src_misc_prnetdb_c,v 1.5 2006/01/23 12:34:06 wilfried Exp $
--- nsprpub/pr/src/misc/prnetdb.c.orig	Thu Aug 18 19:24:38 2005
+++ nsprpub/pr/src/misc/prnetdb.c	Sat Sep 10 09:08:28 2005
@@ -2110,7 +2110,12 @@ PR_IMPLEMENT(PRAddrInfo *) PR_GetAddrInf
          */
         hints.ai_socktype = SOCK_STREAM;
 
+	LOCK_DNS();
+
         rv = GETADDRINFO(hostname, NULL, &hints, &res);
+
+	UNLOCK_DNS();
+
         if (rv == 0)
             return (PRAddrInfo *) res;
 
