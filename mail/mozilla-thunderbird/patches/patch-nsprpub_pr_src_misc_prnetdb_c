$OpenBSD: patch-nsprpub_pr_src_misc_prnetdb_c,v 1.3 2004/12/27 21:21:39 wilfried Exp $
--- nsprpub/pr/src/misc/prnetdb.c.orig	Thu Sep  2 01:07:28 2004
+++ nsprpub/pr/src/misc/prnetdb.c	Wed Nov 10 21:50:24 2004
@@ -98,6 +98,7 @@ PRLock *_pr_dnsLock = NULL;
 #endif
 
 #if defined(OSF1) \
+	|| defined(OPENBSD) \
         || defined(AIX4_3_PLUS) || (defined(AIX) && defined(_THREAD_SAFE)) \
 	|| (defined(HPUX10_10) && defined(_REENTRANT)) \
         || (defined(HPUX10_20) && defined(_REENTRANT))
@@ -2098,7 +2099,12 @@ PR_IMPLEMENT(PRAddrInfo *) PR_GetAddrInf
          */
         hints.ai_socktype = SOCK_STREAM;
 
+	LOCK_DNS();
+
         rv = GETADDRINFO(hostname, NULL, &hints, &res);
+
+	UNLOCK_DNS();
+
         if (rv == 0)
             return (PRAddrInfo *) res;
 
