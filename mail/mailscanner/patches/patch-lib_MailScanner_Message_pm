$OpenBSD: patch-lib_MailScanner_Message_pm,v 1.2 2008/04/24 21:31:00 todd Exp $
--- lib/MailScanner/Message.pm.orig	Sat Mar  1 19:31:02 2008
+++ lib/MailScanner/Message.pm	Tue Mar 18 14:16:39 2008
@@ -650,12 +650,19 @@ sub IsSpam {
   # rblspamheader is useful start to spamreport if RBLsaysspam.
 
   # Do the Custom Spam Checker
-  my($gsscore, $gsreport);
+  my($gsscore, $gsreport, @gsheaders);
   #print STDERR "In Message.pm about to look at gsscanner\n";
   if ($usegsscanner) {
     #print STDERR "In Message.pm about to run gsscanner\n";
-    ($gsscore, $gsreport) = MailScanner::GenericSpam::Checks($this);
+    ($gsscore, $gsreport, @gsheaders) = MailScanner::GenericSpam::Checks($this);
     #print STDERR "In Message.pm we got $gsscore, $gsreport\n";
+    foreach my $line (@gsheaders) {
+      my ($header,$val)=split(/:/,$line);
+      #print STDERR "In Message.pm we got gsheader $line <${header}|${val}>\n";
+      $global::MS->{mta}->AddHeader($this,
+                                    "$header:",
+                                    $val);
+    }
     $this->{gshits} = $gsscore;
     $this->{gsreport} = $gsreport;
     $this->{sascore} = $gsscore; # Add the score
