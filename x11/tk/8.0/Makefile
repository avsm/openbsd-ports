# $OpenBSD: Makefile,v 1.12 2001/10/07 11:35:39 espie Exp $
# $FreeBSD: Makefile,v 1.7 1997/12/01 16:50:58 pst Exp $

COMMENT=	"graphical toolkit for Tcl"

DISTNAME=	tk8.0.5
PKGNAME=	tk-8.0.5
CATEGORIES=	x11 tk80
NEED_VERSION=	1.402
MASTER_SITES=	${MASTER_SITE_TCLTK}
MASTER_SITE_SUBDIR= tcl8_0

HOMEPAGE=	http://dev.scriptics.com/software/tcltk/

LIB_DEPENDS=	tcl80.1.5::lang/tcl/8.0

MAINTAINER=	Niklas Hallqvist <niklas@openbsd.org>

PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

MAKE_FLAGS=	CFLAGS="${CFLAGS}"
FAKE_FLAGS=	INSTALL="install -c" INSTALL_ROOT="${WRKINST}" \
		BASE_INCLUDE_DIR='$$(prefix)/include/tk$$(VERSION)' \
		INCLUDE_INSTALL_DIR='$$(INSTALL_ROOT)$$(BASE_INCLUDE_DIR)' \
		GENERIC_INCLUDE_INSTALL_DIR='$$(BASE_INCLUDE_DIR)/generic' \
		UNIX_INCLUDE_INSTALL_DIR='$$(BASE_INCLUDE_DIR)/unix' \
		MAN_INSTALL_DIR='$${INSTALL_ROOT}$$(TK_LIBRARY)/man'

SEPARATE_BUILD=	concurrent
USE_X11=	Yes
CONFIGURE_STYLE= gnu
CONFIGURE_ARGS+= ${CONFIGURE_SHARED}
CONFIGURE_ARGS+= --enable-static --with-tcl="${LOCALBASE}/lib/tcl8.0"
CONFIGURE_ENV=	PORTSDIR="${PORTSDIR}"

WRKDIST=	${WRKDIR}/${DISTNAME}/unix

REGRESS_TARGET=	test
REGRESS_DEPENDS=::lang/tcl/8.3:regress
REGRESS_FLAGS=TCL_BIN_DIR=`cd ${PORTSDIR}/lang/tcl/8.3 && ${MAKE} show=WRKBUILD`
# This regression test wants an X11 display
REGRESS_FLAGS+=DISPLAY=${DISPLAY} XAUTHORITY=${XAUTHORITY}
REGRESS_IS_INTERACTIVE=Yes

post-install:
	@strip ${PREFIX}/bin/wish8.0

.include <bsd.port.mk>
