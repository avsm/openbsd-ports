$OpenBSD: patch-src_global_sent_c,v 1.1 2004/06/11 07:47:30 brad Exp $
--- src/global/sent.c.orig	2003-09-20 17:43:30.000000000 -0400
+++ src/global/sent.c	2004-06-10 00:13:49.000000000 -0400
@@ -161,17 +161,24 @@ int     vsent(int flags, const char *id,
      * Normal mail delivery. May also send a delivery record to the user.
      */
     else {
+	VSTRING *why = vstring_alloc(100);
+
+	vstring_vsprintf(why, fmt, ap);
+
 	if ((flags & DEL_REQ_FLAG_RECORD) == 0
-	    || vtrace_append(flags, id, orig_rcpt, recipient, relay,
-			     entry, "2.0.0", "delivered", fmt, ap) == 0) {
-	    vlog_adhoc(id, orig_rcpt, recipient, relay,
-		       entry, "sent", fmt, ap);
+	    || trace_append(flags, id, orig_rcpt, recipient, relay,
+			     entry, "2.0.0", "delivered",
+			     "%s", vstring_str(why)) == 0) {
+	    log_adhoc(id, orig_rcpt, recipient, relay,
+		       entry, "sent", "%s", vstring_str(why));
 	    status = 0;
 	} else {
 	    status = defer_append(flags, id, orig_rcpt, recipient, offset,
 				  relay, entry, "%s: %s service failed",
 				  id, var_trace_service);
 	}
+
+	vstring_free(why);
 	return (status);
     }
 }
