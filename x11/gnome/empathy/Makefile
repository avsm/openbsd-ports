# $OpenBSD: Makefile,v 1.70 2011/06/08 17:41:57 rpointel Exp $

COMMENT= 		telepathy based messenger for GNOME

GNOME_PROJECT=		empathy
GNOME_VERSION=		2.34.0

REVISION=		5

CATEGORIES=		net

HOMEPAGE=		http://live.gnome.org/Empathy

# GPLv2
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

MODULES=		devel/gettext \
			lang/python \
			x11/gnome \
			devel/dconf

WANTLIB += GL ORBit-2 X11 Xau Xcomposite Xcursor Xdamage Xdmcp
WANTLIB += Xext Xfixes Xi Xinerama Xrandr Xrender Xxf86vm asn1
WANTLIB += atk-1.0 c cairo clutter-glx-1.0 com_err crypto dbus-1
WANTLIB += dbus-glib-1 drm expat fontconfig freetype gmp hogweed nettle
WANTLIB += gcrypt gdk-x11-2.0 gdk_pixbuf-2.0 gio-2.0 glib-2.0 unique-1.0
WANTLIB += gmodule-2.0 gnome-keyring gnutls gobject-2.0
WANTLIB += gpg-error gssapi gstbase-0.10 gstfarsight-0.10 gstinterfaces-0.10
WANTLIB += gstreamer-0.10 gthread-2.0 gtk-x11-2.0 krb5 m nspr4 geoclue
WANTLIB += nss3 ogg pango-1.0 pangocairo-1.0 pangoft2-1.0 pcre enchant
WANTLIB += pixman-1 plc4 plds4 png proxy pthread pthread-stubs
WANTLIB += smime3 soup-2.4 soup-gnome-2.4 sqlite3 ssl3 stdc++ notify
WANTLIB += tasn1 telepathy-glib vorbis vorbisfile xcb xcb-render ltdl
WANTLIB += gconf-2 gee xcb-shm xml2 z canberra canberra-gtk camel-1.2
WANTLIB += ebook-1.2 edataserver-1.2 json-glib-1.0 champlain-0.8
WANTLIB += champlain-gtk-0.8 clutter-gtk-0.10 telepathy-farsight
WANTLIB += telepathy-logger folks folks-telepathy gcr gp11

BUILD_DEPENDS=		devel/iso-codes \
			x11/py-gtk2
#XXX see below		x11/gnome/nautilus-sendto
LIB_DEPENDS=		audio/libcanberra,-gtk \
			databases/evolution-data-server \
			devel/json-glib \
			devel/libnotify>=0.7.2 \
			devel/libtool,-ltdl \
			devel/libunique \
			geo/geoclue \
			geo/libchamplain/core \
			graphics/clutter/clutter-gtk \
			net/telepathy/telepathy-farsight \
			net/telepathy/telepathy-logger>=0.2.8 \
			textproc/enchant \
			net/telepathy/folks>=0.4.0 \
			x11/gnome/keyring
RUN_DEPENDS=		devel/iso-codes \
			net/telepathy/telepathy-mission-control \
			net/telepathy/telepathy-butterfly \
			net/telepathy/telepathy-gabble \
			net/telepathy/telepathy-idle \
			net/telepathy/telepathy-salut \
			x11/gnome/icon-theme>=2.30.3

DESKTOP_FILES=		Yes
MODGNOME_HELP_FILES=	Yes
MODGCONF2_SCHEMAS_DIR=	empathy

AUTOCONF_VERSION=	2.65
CONFIGURE_STYLE=	autoconf gnu
CONFIGURE_ARGS+=	${CONFIGURE_SHARED} \
			--enable-spell=Yes \
			--enable-location=Yes \
			--enable-map=Yes\
			--enable-webkit=no \
			--enable-control-center-embedding=no \
			--with-connectivity=no \
			--with-eds \
			--with-ca-file=/etc/ssl/cert.pem \
			--disable-Werror \
			--enable-call=no
# XXX lots of 'libnstempathy.so: undefined symbol' at runtime
# revisit when telepathy-yell is moved out from empathy(?)
CONFIGURE_ARGS+=	--disable-nautilus-sendto \

CONFIGURE_ENV=		CPPFLAGS="-I${LOCALBASE}/include" \
			LDFLAGS="-L${LOCALBASE}/lib"
USE_GROFF =		Yes

FAKE_FLAGS+=		pkgdatadir=${PREFIX}/share/

pre-configure:
	@ln -sf ${LOCALBASE}/bin/python${MODPY_VERSION}-config \
		${WRKDIR}/bin/python-config

.include <bsd.port.mk>
