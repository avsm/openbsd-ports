$OpenBSD: patch-src_lib_istream_c,v 1.1 2009/02/08 14:54:21 sthen Exp $
--- src/lib/istream.c.orig	Thu Feb  5 16:24:58 2009
+++ src/lib/istream.c	Thu Feb  5 16:25:44 2009
@@ -92,6 +92,10 @@ ssize_t i_stream_read(struct istream *stream)
 	case 0:
 		i_assert(!stream->blocking);
 		break;
+	default:
+		i_assert(ret > 0);
+		i_assert((size_t)ret <= _stream->pos - _stream->skip);
+		break;
 	}
 	return ret;
 }
