--- src/auth.c.~1~	Mon Jul 27 12:05:01 1998
+++ src/auth.c	Sat Aug 15 17:20:53 1998
@@ -44,6 +44,7 @@
 	FILE *fp;
 	t_bool builtinauth = FALSE;
 	static int cookiefd = -1;
+	int fdfd;
 #ifdef HAVE_PUTENV
 	char *new_env;
 	static char *old_env = 0;
@@ -64,14 +65,16 @@
 		char tempfile[BUFSIZ];
 
 		sprintf (tempfile, "%stin_AXXXXXX", TMPDIR);
-		if (!mktemp (tempfile)) {
+		fdfd = mkstemp(tempfile);
+		if (fdfd == -1) {
 			error_message (txt_cannot_create_uniq_name);
 #ifdef DEBUG
 			debug_nntp ("authorization", txt_cannot_create_uniq_name);
 #endif
 			return FALSE;
 		} else {
-			if ((fp = fopen (tempfile, "w+")) != (FILE *) 0) {
+			fp = fdopen (fdfd, "w+");
+			if (fp) {
 				cookiefd = fileno (fp);
 				(void) unlink (tempfile);
 			} else {
