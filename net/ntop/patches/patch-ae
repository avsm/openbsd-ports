--- ntop.c.orig	Mon Aug  3 12:12:43 1998
+++ ntop.c	Sun Nov 29 15:31:33 1998
@@ -40,6 +40,7 @@
 
 /* Globals */
 char *program_name, *device;
+int datalink;
 
 /* Locals */
 static pcap_t *p;
@@ -134,10 +135,15 @@
 
   /* Fire up libpcap */
   p = pcap_open_live(device, DEFAULT_SNAPLEN, !pflag, 1000, ebuf);
-
   if (p == NULL)
     error(ebuf);
 
+  /* Find out what datalink type the interface is */
+  datalink = pcap_datalink(p);
+  if (link_header_len(datalink, 0, 0) == -1)
+    error("unsupported link type");
+
+
   if (pcap_lookupnet(device, &localnet, &netmask, ebuf) < 0)
     error(ebuf);
 
@@ -298,11 +304,11 @@
 usage()
 {
   extern char version[];
-  extern char pcap_version[];
+/*  extern char pcap_version[]; */
 
   (void)fprintf(stderr, "%s v.%s for %s\n", program_name, 
 		version, osName);
-  (void)fprintf(stderr, "[libpcap version %s]\n", pcap_version);
+/*  (void)fprintf(stderr, "[libpcap version %s]\n", pcap_version); */
   (void)fprintf(stderr, "Written by %s.\n", author);
   (void)fprintf(stderr, "\nUsage: %s [-r (refresh time [default 3 secs]]\n\t"
 		"    [-n (numeric IP addresses)]\n\t"
