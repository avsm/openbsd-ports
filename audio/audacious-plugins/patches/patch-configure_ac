$OpenBSD: patch-configure_ac,v 1.7 2011/04/01 03:24:25 jakemsr Exp $
--- configure.ac.orig	Tue Feb 22 12:29:46 2011
+++ configure.ac	Thu Mar 31 20:40:59 2011
@@ -785,10 +785,10 @@ dnl In 2010, some libavcodec functions were moved into
 dnl libavcore, making our checks here a bit complex.
 
 if test $enable_ffaudio = yes ; then
-    PKG_CHECK_MODULES([NEED_AVCORE], [libavcodec >= 52.94.3],
-     [have_new_ffmpeg=yes], [have_new_ffmpeg=no])
+    PKG_CHECK_MODULES([NEED_AVCORE], [libavcodec >= 52.94.3 libavcodec <= 52.113.1],
+     [have_split_ffmpeg=yes], [have_split_ffmpeg=no])
 
-    if test $have_new_ffmpeg = yes ; then
+    if test $have_split_ffmpeg = yes ; then
         PKG_CHECK_MODULES([FFMPEG],
          [libavcodec >= 52.20.0 libavcore >= 0.12.0 libavformat >= 52.31.0 libavutil >= 49.15.0],
          [have_ffaudio=yes], [have_ffaudio=no])
@@ -809,13 +809,21 @@ AC_ARG_ENABLE( jack,
                 [enable_jack="yes"])
 
 if test "x$enable_jack" = "xyes"; then
-        AM_PATH_JACK(have_jack=yes, have_jack=no)
+	PKG_CHECK_MODULES(JACK, jack >= 0.109.10, , [AC_MSG_WARN(
+	[*** Cannot find jack 0.109.10 or newer, jack will not be built ***])
+	enable_jack=no])
 else
         AC_MSG_RESULT([*** jack plugin disabled per user request ***])
-        have_jack=no
+        enable_jack=no
 fi
 
-if test "x$have_jack" = "xyes"; then
+if test "x$enable_jack" = xyes; then
+       PKG_CHECK_MODULES(SAMPLERATE, samplerate >= 0.0.15, , [AC_MSG_WARN(
+       [Could not find libsamplerate, necessary for jack output plugin.])
+       enable_jack=no])
+fi
+
+if test "x$enable_jack" = xyes; then
 	OUTPUT_PLUGINS="$OUTPUT_PLUGINS jack"
 fi
 
@@ -1196,7 +1204,7 @@ have_solaris=no
 have_sun=no
 ARCH_DEFINES=""
 case "$host" in
-    *-*-openbsd* | *-*-netbsd* | *-*-mirbsd*)
+    *-*-netbsd* | *-*-mirbsd*)
         have_sun=yes
         if test "${is_elf}" = "no"
         then
@@ -1204,6 +1212,12 @@ case "$host" in
         fi
         OUTPUT_PLUGINS="$OUTPUT_PLUGINS sun"
     ;;
+    *-*-openbsd*)
+        if test "${is_elf}" = "no"
+        then
+            AC_DEFINE(SYMBOL_PREFIX, "_", [Define to symbol prefix, if any])
+        fi
+    ;;
     *-*-darwin*)
         AC_DEFINE(SYMBOL_PREFIX, "_", [Define to symbol prefix, if any])
     ;;
@@ -1557,6 +1571,20 @@ if test "x$enable_lyricwiki" = "xyes"; then
     GENERAL_PLUGINS="$GENERAL_PLUGINS lyricwiki"
 fi
 
+dnl *** sndio
+
+AC_ARG_ENABLE(sndio,
+    [  --enable-sndio          enable sndio output plugin (default=disabled) ],
+    [have_sndio=$enableval],
+    [have_sndio=no]
+)
+
+if test "x$have_sndio" = "xyes"; then
+	OUTPUT_PLUGINS="$OUTPUT_PLUGINS sndio"
+else
+	have_sndio=no
+fi
+
 dnl *** End of all plugin checks ***
 
 AC_SUBST(ARCH_DEFINES)
@@ -1652,6 +1680,7 @@ echo "    -> FileWriter MP3 output part:        $have_
 echo "    -> FileWriter Vorbis output part:     $have_vorbisenc"
 echo "    -> FileWriter FLAC output part:       $have_writer_flac"
 echo "  Null Audio output (null):               yes"
+echo "  Sndio Audio output (sndio):             $have_sndio"
 echo
 echo "  Input Plugins"
 echo "  -------------"
