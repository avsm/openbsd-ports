$OpenBSD: patch-configure_in,v 1.3.2.1 2003/05/07 20:31:47 marcm Exp $
--- configure.in.orig	Mon Mar 17 09:06:46 2003
+++ configure.in	Fri Mar 21 13:26:54 2003
@@ -86,7 +86,8 @@ AC_CHECK_HEADERS(alloca.h)
 
 dnl check for socklen_t (in Unix98)
 AC_MSG_CHECKING(for socklen_t)
-AC_TRY_COMPILE([#include <sys/socket.h>
+AC_TRY_COMPILE([#include <sys/types.h>
+#include <sys/socket.h>
 socklen_t x;
 ],[],[AC_MSG_RESULT(yes)],[
 AC_TRY_COMPILE([#include <sys/socket.h>
@@ -360,7 +361,7 @@ AC_SUBST(DB3_CFLAGS)
 
 CPPFLAGS_save="$CPPFLAGS"
 CPPFLAGS="$DB3_CFLAGS $CPPFLAGS"
-AC_CHECK_HEADERS(db.h db3/db.h, break)
+AC_CHECK_HEADERS(db3.h db.h db3/db.h, break)
 
 AC_CACHE_CHECK([db3 header version], ac_cv_db3_header_version,
 [
@@ -368,8 +369,12 @@ AC_CACHE_CHECK([db3 header version], ac_
 		#ifdef HAVE_DB3_DB_H
 		#include <db3/db.h>
 		#else
+		#ifdef HAVE_DB3_H
+		#include <db3.h>
+		#else
 		#include <db.h>
 		#endif
+		#endif
 	],[
 		#if DB_VERSION_MAJOR != $evolution_db_version_major || \
 		    DB_VERSION_MINOR != $evolution_db_version_minor || \
@@ -392,8 +397,12 @@ AC_CACHE_CHECK([for db3 library name], a
 			#ifdef HAVE_DB3_DB_H
 			#include <db3/db.h>
 			#else
+			#ifdef HAVE_DB3_H
+			#include <db3.h>
+			#else
 			#include <db.h>
 			#endif
+			#endif
 		],[
 			DB *db;
 			db_create (&db, 0, 0);
@@ -418,8 +427,12 @@ AC_CACHE_CHECK([that db3 library version
 		#ifdef HAVE_DB3_DB_H
 		#include <db3/db.h>
 		#else
+		#ifdef HAVE_DB3_H
+		#include <db3.h>
+		#else
 		#include <db.h>
 		#endif
+		#endif
 
 		int
 		main (void)
@@ -652,26 +665,36 @@ if test "$x{with_krb5}" != "xno"; then
 	
 	mitlibs="-lkrb5 -lk5crypto -lcom_err -lgssapi_krb5"
 	heimlibs="-lkrb5 -lcrypto -lasn1 -lcom_err -lroken -lgssapi"
+	altheimlibs="-lkrb5 -lcrypto -lasn1 -lgssapi"
 	AC_CACHE_CHECK([for Kerberos 5], ac_cv_lib_kerberos5,
 	[
 		LDFLAGS="$LDFLAGS -L$with_krb5/lib $mitlibs"
 		AC_TRY_LINK_FUNC(krb5_init_context, ac_cv_lib_kerberos5="$mitlibs",
 		[
 			LDFLAGS="$LDFLAGS_save -L$with_krb5/lib $heimlibs"
-			AC_TRY_LINK_FUNC(krb5_init_context, ac_cv_lib_kerberos5="$heimlibs", ac_cv_lib_kerberos5="no")
+			AC_TRY_LINK_FUNC(krb5_init_context, ac_cv_lib_kerberos5="$heimlibs",
+			[
+				LDFLAGS="$LDFLAGS_save -L$with_krb5/lib $altheimlibs"
+				AC_TRY_LINK_FUNC(krb5_init_context, ac_cv_lib_kerberos5="$altheimlibs", ac_cv_lib_kerberos5=no)
+			])
 		])
 		LDFLAGS="$LDFLAGS_save"
 	])
 	if test "$ac_cv_lib_kerberos5" != "no"; then
 		AC_DEFINE(HAVE_KRB5)
-		if test "$ac_cv_lib_kerberos5" == "$mitlibs"; then
-			msg_krb5="yes (MIT)"
-			AC_DEFINE(HAVE_MIT_KRB5)
+		if test "$ac_cv_lib_kerberos5" == "$altheimlibs"; then
+			KRB5_CFLAGS="-I$with_krb5/include/kerberosV"
+			msg_krb5="yes (alternate Heimdal)"
 		else
-			msg_krb5="yes (Heimdal)"
-			AC_DEFINE(HAVE_HEIMDAL_KRB5)
+			if test "$ac_cv_lib_kerberos5" == "$mitlibs"; then
+				msg_krb5="yes (MIT)"
+				AC_DEFINE(HAVE_MIT_KRB5)
+			else
+				msg_krb5="yes (Heimdal)"
+				AC_DEFINE(HAVE_HEIMDAL_KRB5)
+			fi
+			KRB5_CFLAGS="-I$with_krb5/include/krb5"
 		fi
-		KRB5_CFLAGS="-I$with_krb5/include/krb5"
 		KRB5_LDFLAGS="-L$with_krb5/lib $ac_cv_lib_kerberos5"
 	fi
 else
