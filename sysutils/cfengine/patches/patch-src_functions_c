$OpenBSD: patch-src_functions_c,v 1.4 2005/07/21 15:16:46 aanriot Exp $
--- src/functions.c.orig	Sat Apr  9 11:02:50 2005
+++ src/functions.c	Fri Jul 15 12:24:01 2005
@@ -221,13 +221,13 @@ switch (fn = FunctionStringToCode(name))
     {
     if (strcmp(value,CF_NOCLASS) == 0)
        {
-       strcpy(value,CF_ANYCLASS);
+       (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
        return value;
        }
     
     if (strcmp(value,CF_ANYCLASS) == 0)
        {
-       strcpy(value,CF_NOCLASS);
+       (void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
        return value;
        }
     }
@@ -321,46 +321,46 @@ FunctionArgs(args,argv,1);
 
 if (lstat(args,&statbuf) == -1)
    {
-   strcpy(value,CF_NOCLASS);
+   (void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
    return;
    }
  else
     {
     if (fn == fn_fileexists)
        {
-       strcpy(value,CF_ANYCLASS);
+       (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
        return;
        }
     }
  
-strcpy(value,CF_NOCLASS);
+(void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
  
  switch(fn)
     {
     case fn_isdir:
         if (S_ISDIR(statbuf.st_mode))
            {
-           strcpy(value,CF_ANYCLASS);
+           (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
            return;
            }
         break;
     case fn_islink:
         if (S_ISLNK(statbuf.st_mode))
            {
-           strcpy(value,CF_ANYCLASS);
+           (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
            return;
            }
         break;
     case fn_isplain:
         if (S_ISREG(statbuf.st_mode))
            {
-           strcpy(value,CF_ANYCLASS);
+           (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
            return;
            }
         break;
     }
  
- strcpy(value,CF_NOCLASS);
+ (void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
 }
 
 /*********************************************************************/
@@ -375,7 +375,7 @@ if (strchr(args,','))
    return;
    }
  
-strcpy(value,CF_NOCLASS);
+(void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
 
 if (!FuzzyMatchParse(args))
    {
@@ -390,7 +390,7 @@ for (ip = IPADDRESSES; ip != NULL; ip = 
    if (FuzzySetMatch(args,ip->name) == 0)
       {
       Debug("IPRange Matched\n");
-      strcpy(value,CF_ANYCLASS);
+      (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
       return;
       }
    }
@@ -401,12 +401,12 @@ Debug("Checking IP Range against RDNS %s
 if (FuzzySetMatch(args,VIPADDRESS) == 0)
    {
    Debug("IPRange Matched\n");
-   strcpy(value,CF_ANYCLASS);
+   (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
    return;
    }
 
 Debug("IPRange did not match\n");
-strcpy(value,CF_NOCLASS);
+(void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
 }
 
 /*********************************************************************/
@@ -419,7 +419,7 @@ Debug("SRDEBUG args=%s value=%s\n",args,
 
 if (!FuzzyHostParse(args))
    {
-   strcpy(value,CF_NOCLASS);
+   (void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
    return;
    }
 /* VDEFAULTBINSERVER.name is relative domain name */
@@ -428,12 +428,12 @@ if (!FuzzyHostParse(args))
 if (FuzzyHostMatch(args,VDEFAULTBINSERVER.name) == 0)
    {
    Debug("SRDEBUG SUCCESS!\n");
-   strcpy(value,CF_ANYCLASS);
+   (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
    }
 else
    {
    Debug("SRDEBUG FAILURE\n");
-   strcpy(value,CF_NOCLASS);
+   (void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
    }
  
 return;
@@ -447,7 +447,7 @@ void HandleCompareStat(enum builtin fn,c
   char argv[CF_MAXFARGS][CF_MAXVARSIZE];
 
 FunctionArgs(args,argv,2); 
-strcpy(value,CF_NOCLASS);
+(void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
  
 if (stat(argv[0],&frombuf) == -1)
    {
@@ -464,7 +464,7 @@ switch(fn)
    case fn_newerthan:
        if (frombuf.st_mtime < tobuf.st_mtime)
           {
-          strcpy(value,CF_ANYCLASS);
+          (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
           return;
           }
        break;
@@ -472,7 +472,7 @@ switch(fn)
    case fn_accessedbefore:
        if (frombuf.st_atime < tobuf.st_atime)
           {
-          strcpy(value,CF_ANYCLASS);
+          (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
           return;
           }
        break;
@@ -480,13 +480,13 @@ switch(fn)
    case fn_changedbefore:
        if (frombuf.st_ctime < tobuf.st_ctime)
           {
-          strcpy(value,CF_ANYCLASS);
+          (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
           return;
           }       
        break;
    }
  
-strcpy(value,CF_NOCLASS);
+(void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
 }
 
 
@@ -533,7 +533,7 @@ if (*args == '/')
    
    if (ShellCommandReturnsZero(command))
       {
-      strcpy(value,CF_ANYCLASS);
+      (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
       return;
       }
    }
@@ -542,7 +542,7 @@ if (*args == '/')
     yyerror("ExecResult(/command) must specify an absolute path");
     }
  
- strcpy(value,CF_NOCLASS); 
+ (void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE); 
 }
 
 
@@ -560,11 +560,11 @@ Debug("HandleIsDefined(%s)\n",args); 
  
 if (GetMacroValue(CONTEXTID,args))
    {
-   strcpy(value,CF_ANYCLASS);
+   (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
    return;
    }
 
-strcpy(value,CF_NOCLASS); 
+(void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE); 
 }
 
 /*********************************************************************/
@@ -580,7 +580,7 @@ value[0] = '\0';
 
 if (PARSING)
    {
-   strcpy(value,"doinstall");
+   (void)strlcpy(value,"doinstall",CF_EXPANDSIZE);
    return;
    }
  
@@ -634,11 +634,11 @@ FunctionArgs(args,argv,2); 
  
 if (strcmp(argv[0],argv[1]) == 0)
    {
-   strcpy(value,CF_ANYCLASS); 
+   (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE); 
    }
 else
    {
-   strcpy(value,CF_NOCLASS);
+   (void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
    } 
 }
 
@@ -662,11 +662,11 @@ if ((a != CF_NOVAL) && (b != CF_NOVAL)) 
       {
       if (a > b)
          {
-         strcpy(value,CF_ANYCLASS);
+         (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
          }
       else
          {
-         strcpy(value,CF_NOCLASS);
+         (void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
          }
       return;
       }
@@ -674,11 +674,11 @@ if ((a != CF_NOVAL) && (b != CF_NOVAL)) 
       {
       if (a < b)  
          {
-         strcpy(value,CF_ANYCLASS);
+         (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
          }
       else
          {
-         strcpy(value,CF_NOCLASS);
+         (void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
          }
       return;
       }
@@ -690,22 +690,22 @@ if (strcmp(argv[0],argv[1]) > 0)
    {
    if (ch == '+')
       {
-      strcpy(value,CF_ANYCLASS);
+      (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
       }
    else
       {
-      strcpy(value,CF_NOCLASS);
+      (void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
       }
    }
 else
    {
    if (ch == '+')
       {
-      strcpy(value,CF_NOCLASS);
+      (void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
       }
    else
       {
-      strcpy(value,CF_ANYCLASS);
+      (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
       }
    } 
 }
@@ -731,11 +731,11 @@ ret = LocateNextItemMatching(list,argv[0
      
 if (ret != NULL)
    {
-   strcpy(value,CF_ANYCLASS); 
+   (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE); 
    }
 else
    {
-   strcpy(value,CF_NOCLASS);
+   (void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
    }
  
 DeleteItemList(list); 
@@ -1080,7 +1080,7 @@ first[0] = '\0';
  
 if (psize < 2)
    {
-   strcpy(value,"silly");
+   (void)strlcpy(value,"silly",CF_EXPANDSIZE);
    CfLog(cferror,"Partitioning of size < 2 is silly","");
    return;
    }
@@ -1089,7 +1089,7 @@ Verbose("Searching for my peer group in 
 
 if (!((strcmp("random",policy) == 0) || (strcmp("first",policy) == 0)))
    {
-   strcpy(value,"silly");
+   (void)strlcpy(value,"silly",CF_EXPANDSIZE);
    CfLog(cferror,"Partition leader policy is first/random only","");
    return;
    }
@@ -1244,7 +1244,7 @@ value[0] = '\0'; 
  
 if (psize < 2)
    {
-   strcpy(value,"silly");
+   (void)strlcpy(value,"silly",CF_EXPANDSIZE);
    CfLog(cferror,"Partitioning of size < 2 is silly","");
    return;
    }
@@ -1253,7 +1253,7 @@ Verbose("Searching for my peer group nei
 
 if (!(strcmp("random",policy) == 0 || strcmp("first",policy) == 0))
    {
-   strcpy(value,"silly");
+   (void)strlcpy(value,"silly",CF_EXPANDSIZE);
    CfLog(cferror,"Partition leader policy is first/random only","");
    return;
    }
@@ -1376,7 +1376,7 @@ for (ip = SplitStringAsItemList(args,','
    AppendItem(&METHODRETURNVARS,ip->name,CLASSBUFF);
    }
  
-strcpy(value,"noinstall");
+(void)strlcpy(value,"noinstall",CF_EXPANDSIZE);
 }
 
 /*********************************************************************/
@@ -1392,7 +1392,7 @@ for (ip = SplitStringAsItemList(args,','
    AppendItem(&METHODRETURNCLASSES,args,CLASSBUFF);
    }
 
-strcpy(value,"noinstall");
+(void)strlcpy(value,"noinstall",CF_EXPANDSIZE);
 }
 
 /*********************************************************************/
@@ -1418,7 +1418,7 @@ Debug("ShowState(%s)\n",args); 
 
 if (PARSING)
    {
-   strcpy(value,"doinstall");
+   (void)strlcpy(value,"doinstall",CF_EXPANDSIZE);
    return;
    }
  
@@ -1604,12 +1604,12 @@ if (stat(buffer,&statbuf) == 0)
    
    printf("%s: -----------------------------------------------------------------------------------\n",VPREFIX);
    snprintf(buffer,CF_BUFSIZE,"State of %s peaked at %s\n",args,ctime(&statbuf.st_mtime));
-   strcpy(value,buffer);
+   (void)strlcpy(value,buffer,CF_EXPANDSIZE);
    }
 else 
    {
    snprintf(buffer,CF_BUFSIZE,"State parameter %s is not known or recorded\n",args);   
-   strcpy(value,buffer);
+   (void)strlcpy(value,buffer,CF_EXPANDSIZE);
    }
 
 DeleteItemList(addresses); 
@@ -1636,7 +1636,7 @@ FunctionArgs(args,argv,1);
 
 if (PARSING)
    {
-   strcpy(value,"doinstall");
+   (void)strlcpy(value,"doinstall",CF_EXPANDSIZE);
    return;
    }
 
@@ -1647,7 +1647,7 @@ if (time >= 0)
    CheckFriendConnections(time);
    }
  
-strcpy(value,""); /* No reply */
+(void)strlcpy(value,"",CF_EXPANDSIZE); /* No reply */
 }
 
 /*********************************************************************/
@@ -1721,11 +1721,11 @@ Debug("PrepModule(%s,%s)\n",argv[0],argv
  
 if (CheckForModule(argv[0],argv[1]))
    {
-   strcpy(value,CF_ANYCLASS);
+   (void)strlcpy(value,CF_ANYCLASS,CF_EXPANDSIZE);
    }
 else
    {
-   strcpy(value,CF_NOCLASS);
+   (void)strlcpy(value,CF_NOCLASS,CF_EXPANDSIZE);
    }
 }
 
