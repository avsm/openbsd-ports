$OpenBSD: patch-mozilla_nsprpub_pr_src_misc_prnetdb_c,v 1.7 2009/08/04 13:56:09 martynas Exp $
--- mozilla/nsprpub/pr/src/misc/prnetdb.c.orig	Sat May  2 02:08:05 2009
+++ mozilla/nsprpub/pr/src/misc/prnetdb.c	Sat Jun 20 23:38:30 2009
@@ -2039,7 +2039,12 @@ PR_IMPLEMENT(PRAddrInfo *) PR_GetAddrInfoByName(const 
          */
         hints.ai_socktype = SOCK_STREAM;
 
+	LOCK_DNS();
+
         rv = GETADDRINFO(hostname, NULL, &hints, &res);
+
+	UNLOCK_DNS();
+
         if (rv == 0)
             return (PRAddrInfo *) res;
 
