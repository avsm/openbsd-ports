$OpenBSD: patch-configure,v 1.41 2007/04/19 08:37:09 ajacoutot Exp $
--- configure.orig	Sun Jun 11 20:35:47 2006
+++ configure	Thu Apr 19 09:41:27 2007
@@ -77,7 +77,7 @@ cc_check() {
 }
 
 cxx_check() {
-  compile_check $TMPCPP $@ -lstdc++
+  compile_check $TMPCPP $@ -lstdc++ -lm
 }
 
 tmp_run() {
@@ -839,6 +839,8 @@ if x86 || x86_64 ; then
   pparam=`echo $exts | sed -e s/k6_mtrr/mtrr/ -e s/cyrix_arr/mtrr/ -e s/centaur_mcr/mtrr/ \
                            -e s/xmm/sse/ -e s/kni/sse/`
 
+  if x86_64 ; then pparam="3dnow 3dnowext mmx mmxext xmm sse sse2" ; fi
+
   for ext in $pparam ; do
     eval _$ext=auto && eval _$ext=yes
   done
@@ -2970,7 +2972,7 @@ fi
 echores "$_rpath"
 
 echocheck "iconv"
-if test "$_iconv" = auto ; then
+if test "$_iconv" != no ; then
   _iconv_tmp='#include <iconv.h>'
 
   cat > $TMPC << EOF
@@ -4137,6 +4139,8 @@ if test "$_aa" = yes ; then
   _def_aa='#define HAVE_AA 1'
   if cygwin ; then
     _ld_aa=`aalib-config --libs | cut -d " " -f 2,5,6`
+  else
+    _ld_aa="-laa"
   fi
   _vosrc="$_vosrc vo_aa.c"
   _vomodules="aa $_vomodules"
@@ -5089,7 +5093,7 @@ echores "$_sgiaudio"
 
 
 echocheck "VCD support"
-if linux || bsdos || freebsd || netbsd || sunos || darwin ; then
+if linux || bsdos || freebsd || netbsd || sunos || darwin || openbsd ; then
   _inputmodules="vcd $_inputmodules"
   _def_vcd='#define HAVE_VCD 1'
   _vcd="yes"
@@ -6723,7 +6727,7 @@ if test "$_tv_bsdbt848" = auto ; then
  if test "$_tv" = yes ; then
     cat > $TMPC <<EOF
 #include <sys/types.h>
-#if defined(__NetBSD__)
+#if defined(__NetBSD__) || defined(__OpenBSD__)
 #include <dev/ic/bt8xx.h>
 #else
 #include <machine/ioctl_bt848.h>
@@ -7453,7 +7457,7 @@ CACA_LIB = $_ld_caca
 # audio output
 ALSA_LIB = $_ld_alsa
 NAS_LIB = $_ld_nas
-ARTS_LIB = $_ld_arts
+ARTS_LIB = $_ld_arts -lstdc++
 ARTS_INC = $_inc_arts
 ESD_LIB = $_ld_esd
 ESD_INC = $_inc_esd
@@ -7764,7 +7768,7 @@ $_def_malloc
 $_def_memalign
 #ifndef HAVE_MEMALIGN
 # define memalign(a,b) malloc(b)
-#define MEMALIGN_HACK 1
+/* #undef MEMALIGN_HACK 1 */
 #endif
 
 /* Define this if your system has the "alloca.h" header file */
@@ -8042,7 +8046,7 @@ $_def_vcd
 #define DEFAULT_DVD_DEVICE	"/dev/rdiskN"
 #elif defined(__OpenBSD__)
 #define DEFAULT_CDROM_DEVICE	"/dev/rcd0a"
-#define DEFAULT_DVD_DEVICE	DEFAULT_CDROM_DEVICE
+#define DEFAULT_DVD_DEVICE	"/dev/rcd0c"
 #elif defined(__FreeBSD__)
 #define DEFAULT_CDROM_DEVICE	"/dev/acd0"
 #define DEFAULT_DVD_DEVICE	DEFAULT_CDROM_DEVICE
