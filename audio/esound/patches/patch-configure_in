--- configure.in.orig	Fri Mar  1 17:07:05 2002
+++ configure.in	Tue Mar  5 09:21:38 2002
@@ -151,6 +151,16 @@ if test "x$enable_local_sound" = "xyes";
       esac
    fi
 
+   if test "${ac_cv_header_sys_audioio_h}" = "yes"; then
+      case ${host_os} in
+      openbsd* | netbsd*)
+         found_sound=yes
+         DRIVER_SUN=1
+         AC_DEFINE(DRIVER_SUN)
+         ;;
+      esac
+   fi
+
    case ${host_os} in
    os2*)
       found_sound=yes
@@ -200,7 +210,9 @@ if test "x$enable_local_sound" = "xyes";
    echo "---------------------------------------------------------------------"
    echo "--- Checking to see which audio libraries are required for linking.";
    echo "--- Most of these checks should also fail. Do not be alarmed.";
-   AC_CHECK_FUNC(_oss_ioctl,,[AC_CHECK_LIB(ossaudio,_oss_ioctl)])
+   if test ! "$DRIVER_SUN"; then
+     AC_CHECK_FUNC(_oss_ioctl,,[AC_CHECK_LIB(ossaudio,_oss_ioctl)])
+   fi
    AC_CHECK_FUNC(ALnewconfig,,[AC_CHECK_LIB(audio,ALnewconfig)])
    if test "x$enable_alsa" = "xyes"; then
       AC_CHECK_FUNC(snd_cards,,[AC_CHECK_LIB(sound,snd_cards)])
@@ -285,7 +297,8 @@ if test "x$with_libwrap" = "xyes"; then
 
    wrap_ok=no
    AC_TRY_LINK(
-[#include <tcpd.h>
+[#include <stdio.h>
+#include <tcpd.h>
 #include <syslog.h>
 int allow_severity = LOG_INFO;
 int deny_severity = LOG_WARNING;],
@@ -295,7 +308,8 @@ int deny_severity = LOG_WARNING;],
        wrap_ok=yes],
       [LIBS="$LIBS -lnsl"
        AC_TRY_LINK(
-[#include <tcpd.h>
+[#include <stdio.h>
+#include <tcpd.h>
 #include <syslog.h>
 int allow_severity = LOG_INFO;
 int deny_severity = LOG_WARNING;],
