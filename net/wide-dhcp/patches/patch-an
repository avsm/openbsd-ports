*** server/dhcps.c.orig	Tue Aug 19 14:14:39 1997
--- server/dhcps.c	Fri Jul 17 18:33:37 1998
***************
*** 126,132 ****
  
  char **argv_orig;
  
! void
  main(argc, argv)
    int argc;
    char **argv;
--- 126,132 ----
  
  char **argv_orig;
  
! int
  main(argc, argv)
    int argc;
    char **argv;
***************
*** 211,219 ****
  #define LOG_PERROR	0	/* Don't bother if not defined... */
  #endif
    if (debug == 1) {
!     openlog("dhcps", LOG_PID | LOG_CONS | LOG_PERROR, LOG_LOCAL0);
    } else {
!     openlog("dhcps", LOG_PID | LOG_CONS, LOG_LOCAL0);
    }
  
    init_db();               /* initialize databases */
--- 211,219 ----
  #define LOG_PERROR	0	/* Don't bother if not defined... */
  #endif
    if (debug == 1) {
!     openlog("dhcps", LOG_PID | LOG_CONS | LOG_PERROR, LOG_LOCAL1);
    } else {
!     openlog("dhcps", LOG_PID | LOG_CONS, LOG_LOCAL1);
    }
  
    init_db();               /* initialize databases */
***************
*** 526,531 ****
--- 526,532 ----
      syslog(LOG_ERR, "Cannot open the binding database \"%s\"", binding_db);
      exit(1);
    }
+   unlink(ADDRPOOL_DUMP);
    if ((dump_fp = fopen(ADDRPOOL_DUMP, "w+")) == NULL) {
      syslog(LOG_ERR, "Cannot open the resource dump file \"%s\"",ADDRPOOL_DUMP);
      exit(1);
***************
*** 1832,1838 ****
      snd.dhcp->options[off_options] = END;
    } else if (off_extopt > 0 && off_extopt < maxoptlen - DFLTOPTLEN &&
  	     sbufvec[1].iov_base != NULL) {
!     sbufvec[1].iov_base[off_extopt++] = END;
    }
  
    if (off_extopt < sbufvec[1].iov_len) {
--- 1833,1839 ----
      snd.dhcp->options[off_options] = END;
    } else if (off_extopt > 0 && off_extopt < maxoptlen - DFLTOPTLEN &&
  	     sbufvec[1].iov_base != NULL) {
!     *((char *)sbufvec[1].iov_base + off_extopt++) = END;
    }
  
    if (off_extopt < sbufvec[1].iov_len) {
***************
*** 2290,2296 ****
--- 2291,2301 ----
    char *inserted;
    char flag;
  {
+ #if defined(__OpenBSD__)
+   u_int32_t *addr = 0;
+ #else
    u_Long *addr = 0;
+ #endif
    char option[6];
    int symbol = 0;
    int retval = 0;
***************
*** 2851,2857 ****
        len -= done;
        off_options += done; /* invalid offset, So, to access
  					    here will cause fatal error */
!       bcopy(&opt[done], &sbufvec[1].iov_base[off_extopt], len);
        off_extopt += len;
        return(0);
      }
--- 2856,2862 ----
        len -= done;
        off_options += done; /* invalid offset, So, to access
  					    here will cause fatal error */
!       bcopy(&opt[done], (char *)sbufvec[1].iov_base + off_extopt, len);
        off_extopt += len;
        return(0);
      }
***************
*** 2927,2933 ****
      return(GOOD);
    }
  
! #if defined(__bsdi__) || defined(__FreeBSD__)
    delarp(ip);
  #else
    delarp(ip, sockfd);
--- 2932,2938 ----
      return(GOOD);
    }
  
! #if defined(__bsdi__) || defined(__FreeBSD__) || defined(__OpenBSD__)
    delarp(ip);
  #else
    delarp(ip, sockfd);
