$OpenBSD: patch-Makefile_in,v 1.5 2009/08/20 08:07:48 ajacoutot Exp $
--- Makefile.in.orig	Tue Aug  4 23:42:38 2009
+++ Makefile.in	Thu Aug 20 09:26:03 2009
@@ -3649,10 +3649,10 @@ cups_drv = prnt/drv/hpcups.drv
 @HPLIP_BUILD_TRUE@@SCAN_BUILD_TRUE@	  scan/sane/sanei_init_debug.c scan/sane/marvell.h scan/sane/marvelli.h scan/sane/marvell.c scan/sane/soapht.c scan/sane/soap.c \
 @HPLIP_BUILD_TRUE@@SCAN_BUILD_TRUE@          scan/sane/soaphti.h scan/sane/soapi.h scan/sane/xml.c scan/sane/xml.h
 
-@DARWIN_BUILD_FALSE@@HPLIP_BUILD_TRUE@@SCAN_BUILD_TRUE@libsane_hpaio_la_LDFLAGS = -version-info 1:0:0
+@DARWIN_BUILD_FALSE@@HPLIP_BUILD_TRUE@@SCAN_BUILD_TRUE@libsane_hpaio_la_LDFLAGS = -module -avoid-version
 @DARWIN_BUILD_TRUE@@HPLIP_BUILD_TRUE@@SCAN_BUILD_TRUE@libsane_hpaio_la_LDFLAGS = -module -framework CoreFoundation -version-info 1:0:0
 # The following is a interlibrary dependency that must be compiled first.
-@HPLIP_BUILD_TRUE@@SCAN_BUILD_TRUE@libsane_hpaio_la_LIBADD = libhpip.la libhpmud.la $(DBUS_LIBS) -lcups -ldl -lsane
+@HPLIP_BUILD_TRUE@@SCAN_BUILD_TRUE@libsane_hpaio_la_LIBADD = libhpip.la libhpmud.la $(DBUS_LIBS) -lcups -lsane
 #libsane_hpaio_la_CFLAGS = -DWITH_NONAMESPACES -DSOAP_DEBUG
 @HPLIP_BUILD_TRUE@@SCAN_BUILD_TRUE@libsane_hpaio_la_CFLAGS = $(DBUS_CFLAGS)
 
@@ -3676,7 +3676,7 @@ cups_drv = prnt/drv/hpcups.drv
 # hp-mkuri.
 @HPLIP_BUILD_TRUE@hp_mkuridir = $(bindir)
 @HPLIP_BUILD_TRUE@hp_mkuri_SOURCES = io/hpmud/hp-mkuri.c
-@HPLIP_BUILD_TRUE@hp_mkuri_LDADD = -ldl libhpmud.la
+@HPLIP_BUILD_TRUE@hp_mkuri_LDADD = libhpmud.la
 
 # hpmud.rules
 @HPLIP_BUILD_TRUE@rulesdir = /etc/udev/rules.d
@@ -3858,7 +3858,7 @@ cups_drv = prnt/drv/hpcups.drv
 @FULL_BUILD_TRUE@@HPLIP_BUILD_TRUE@hppgsz_SOURCES = prnt/hpijs/PrinterProperties.cpp prnt/hpijs/PrinterProperties.h prnt/hpijs/bug.h
 @FULL_BUILD_TRUE@@HPLIP_BUILD_TRUE@hppgsz_CXXFLAGS = $(libapdk_la_CXXFLAGS)
 @FULL_BUILD_TRUE@@HPLIP_BUILD_TRUE@hppgsz_CFLAGS = $(libapdk_la_CFLAGS)
-@FULL_BUILD_TRUE@@HPLIP_BUILD_TRUE@hppgsz_LDADD = libapdk.la -ljpeg -ldl
+@FULL_BUILD_TRUE@@HPLIP_BUILD_TRUE@hppgsz_LDADD = libapdk.la -ljpeg
 
 # hplip.desktop
 @FULL_BUILD_TRUE@@HPLIP_BUILD_TRUE@hplip_desktopdir = $(icondir)
@@ -3925,8 +3925,8 @@ libapdk_la_CFLAGS = $(libapdk_la_CXXFLAGS) -Iprnt/hpij
 
 @HPIJS_INSTALL_TRUE@hpijs_CXXFLAGS = $(libapdk_la_CXXFLAGS)
 @HPIJS_INSTALL_TRUE@hpijs_CFLAGS = $(libapdk_la_CFLAGS)
-@HPIJS_INSTALL_TRUE@@HPLIP_BUILD_FALSE@hpijs_LDADD = libapdk.la -ljpeg -ldl
-@HPIJS_INSTALL_TRUE@@HPLIP_BUILD_TRUE@hpijs_LDADD = libapdk.la -ljpeg -ldl libhpip.la libhpmud.la $(DBUS_LIBS)
+@HPIJS_INSTALL_TRUE@@HPLIP_BUILD_FALSE@hpijs_LDADD = libapdk.la -ljpeg
+@HPIJS_INSTALL_TRUE@@HPLIP_BUILD_TRUE@hpijs_LDADD = libapdk.la -ljpeg libhpip.la libhpmud.la $(DBUS_LIBS)
 
 # hpcups
 #hpcupsdir = $(cupsfilterdir)
@@ -3948,12 +3948,12 @@ libapdk_la_CFLAGS = $(libapdk_la_CXXFLAGS) -Iprnt/hpij
 #	prnt/hpcups/BreakTables.cpp prnt/hpcups/PrinterCommands.h prnt/hpcups/Utils.cpp prnt/hpcups/Utils.h \
 #	prnt/hpcups/SystemServices.cpp prnt/hpcups/SystemServices.h
 #hpcups_CXXFLAGS = $(APDK_ENDIAN_FLAG)
-#hpcups_LDADD = -ljpeg -ldl libhpip.la libhpmud.la -lcups -lcupsimage
+#hpcups_LDADD = -ljpeg libhpip.la libhpmud.la -lcups -lcupsimage
 @HPCUPS_INSTALL_TRUE@@NEW_HPCUPS_FALSE@hpcupsdir = $(cupsfilterdir)
 @HPCUPS_INSTALL_TRUE@@NEW_HPCUPS_FALSE@hpcups_SOURCES = prnt/hpijs/hpcups.cpp prnt/hpijs/hpcups.h prnt/hpijs/services.cpp prnt/hpijs/services.h prnt/hpijs/hpiom.c prnt/hpijs/hpiom.h prnt/hpijs/bug.h prnt/hpijs/hpimage.cpp prnt/hpijs/hpimage.h
 @HPCUPS_INSTALL_TRUE@@NEW_HPCUPS_FALSE@hpcups_CXXFLAGS = $(libapdk_la_CXXFLAGS)
 @HPCUPS_INSTALL_TRUE@@NEW_HPCUPS_FALSE@hpcups_CFLAGS = $(libapdk_la_CFLAGS)
-@HPCUPS_INSTALL_TRUE@@NEW_HPCUPS_FALSE@hpcups_LDADD = libapdk.la -ljpeg -ldl libhpip.la libhpmud.la $(DBUS_LIBS) -lcups -lcupsimage
+@HPCUPS_INSTALL_TRUE@@NEW_HPCUPS_FALSE@hpcups_LDADD = libapdk.la -ljpeg libhpip.la libhpmud.la $(DBUS_LIBS) -lcups -lcupsimage
 # hpcupsfax
 @FAX_BUILD_TRUE@@HPCUPS_INSTALL_TRUE@hpcupsfaxdir = $(cupsfilterdir)
 @FAX_BUILD_TRUE@@HPCUPS_INSTALL_TRUE@hpcupsfax_SOURCES = prnt/hpijs/hpcupsfax.cpp prnt/hpijs/hpcupsfax.h
@@ -6817,7 +6817,7 @@ install-data-am: install-cupsdrv2DATA install-cupsdrvD
 	install-cupsextLTLIBRARIES install-dist_baseSCRIPTS \
 	install-dist_cacSCRIPTS install-dist_cmdSCRIPTS \
 	install-dist_copierSCRIPTS install-dist_faxSCRIPTS \
-	install-dist_halpreDATA install-dist_hpcupsfaxppdDATA \
+	install-dist_hpcupsfaxppdDATA \
 	install-dist_hpfaxSCRIPTS install-dist_hpijsfaxppdDATA \
 	install-dist_hplipSCRIPTS install-dist_hplip_stateDATA \
 	install-dist_images_128x128DATA install-dist_images_16x16DATA \
@@ -6832,7 +6832,7 @@ install-data-am: install-cupsdrv2DATA install-cupsdrvD
 	install-dist_policykit_dbus_shareDATA \
 	install-dist_policykit_policyDATA install-dist_postscriptDATA \
 	install-dist_ppdDATA install-dist_prntSCRIPTS \
-	install-dist_ripSCRIPTS install-dist_rulesDATA \
+	install-dist_ripSCRIPTS \
 	install-dist_scanSCRIPTS install-dist_ui4SCRIPTS \
 	install-dist_uiSCRIPTS install-dist_unrelDATA \
 	install-dist_www0DATA install-dist_www3DATA \
@@ -7013,17 +7013,6 @@ uninstall-am: uninstall-binPROGRAMS uninstall-cupsdrv2
 
 
 install-data-hook:
-#	   If scanner build, add hpaio entry to sane dll.conf.
-@HPLIP_BUILD_TRUE@	if [ "$(scan_build)" = "yes" ]; then \
-@HPLIP_BUILD_TRUE@	   $(mkinstalldirs) $(DESTDIR)/etc/sane.d; \
-@HPLIP_BUILD_TRUE@	   if [ ! -f $(DESTDIR)/etc/sane.d/dll.conf ]; then \
-@HPLIP_BUILD_TRUE@		  touch $(DESTDIR)/etc/sane.d/dll.conf; \
-@HPLIP_BUILD_TRUE@	   fi; \
-@HPLIP_BUILD_TRUE@	   if ! grep ^hpaio $(DESTDIR)/etc/sane.d/dll.conf >/dev/null 2>/dev/null ; then \
-@HPLIP_BUILD_TRUE@		  echo "Adding hpaio entry to /etc/sane.d/dll.conf." ; \
-@HPLIP_BUILD_TRUE@		  echo hpaio >>$(DESTDIR)/etc/sane.d/dll.conf ; \
-@HPLIP_BUILD_TRUE@	   fi \
-@HPLIP_BUILD_TRUE@	fi
 #	   Create hp-xxx commands in bindir.
 @FULL_BUILD_TRUE@@HPLIP_BUILD_TRUE@	$(mkinstalldirs) $(DESTDIR)$(bindir)
 @FULL_BUILD_TRUE@@HPLIP_BUILD_TRUE@	for i in $(dist_cmd_SCRIPTS); do \
