$OpenBSD: patch-includes_common_inc,v 1.1 2008/03/15 09:36:48 espie Exp $
--- includes/common.inc.orig	Tue Jan 22 10:36:49 2008
+++ includes/common.inc	Tue Mar 11 10:55:43 2008
@@ -1613,7 +1613,14 @@ function drupal_clear_css_cache() {
  */
 function drupal_add_js($data = NULL, $type = 'module', $scope = 'header', $defer = FALSE, $cache = TRUE) {
   if (!is_null($data)) {
-    _drupal_add_js('misc/jquery.js', 'core', 'header', FALSE, $cache);
+    if (module_exists('jquery_update')) {
+      $path = drupal_get_path('module', 'jquery_update');
+      _drupal_add_js($path .'/jquery.js', 'core', 'header', FALSE, $cache);
+      _drupal_add_js($path .'/compat-1.0.js', 'core', 'header', FALSE, $cache);
+      _drupal_add_js($path .'/collapse-fix.js', 'theme', 'header', FALSE, $cache);
+    } else {
+      _drupal_add_js('misc/jquery.js', 'core', 'header', FALSE, $cache);
+    }
     _drupal_add_js('misc/drupal.js', 'core', 'header', FALSE, $cache);
   }
   return _drupal_add_js($data, $type, $scope, $defer, $cache);
