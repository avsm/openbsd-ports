$OpenBSD: patch-gtk_gtktrayicon-x11_c,v 1.1 2011/08/29 09:26:49 ajacoutot Exp $

From 6754614ac1ce8f72c0d0ec2369408ac61e080dab Mon Sep 17 00:00:00 2001
From: Vincent Bernat <bernat@luffy.cx>
Date: Sat, 27 Aug 2011 18:06:26 +0000
Subject: trayicon-x11: Fix warnings when visual is not available.

--- gtk/gtktrayicon-x11.c.orig	Thu Jul 28 03:34:32 2011
+++ gtk/gtktrayicon-x11.c	Mon Aug 29 10:51:57 2011
@@ -501,9 +501,12 @@ gtk_tray_icon_get_visual_property (GtkTrayIcon *icon)
       visual = gdk_x11_screen_lookup_visual (screen, visual_id);
     }
 
-  gdk_visual_get_red_pixel_details (visual, NULL, NULL, &red_prec);
-  gdk_visual_get_green_pixel_details (visual, NULL, NULL, &green_prec);
-  gdk_visual_get_blue_pixel_details (visual, NULL, NULL, &blue_prec);
+  if (visual != NULL)
+    {
+      gdk_visual_get_red_pixel_details (visual, NULL, NULL, &red_prec);
+      gdk_visual_get_green_pixel_details (visual, NULL, NULL, &green_prec);
+      gdk_visual_get_blue_pixel_details (visual, NULL, NULL, &blue_prec);
+    }
 
   icon->priv->manager_visual = visual;
   icon->priv->manager_visual_rgba = visual != NULL &&
