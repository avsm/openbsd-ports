$OpenBSD: patch-configure_ac,v 1.3 2007/04/08 14:58:04 espie Exp $
--- configure.ac.orig	Sat Jan  6 18:43:43 2007
+++ configure.ac	Mon Feb  5 04:01:08 2007
@@ -796,10 +796,16 @@ if test x$use_qt = xyes ; then
 
     # GUESS plugins dir for immodule installation
     AC_MSG_CHECKING(for qt-immodule plugins dir)
-    if test ! -d "$QTDIR/plugins"; then
-      AC_MSG_RESULT(no)
+    if test ! -d "$QTDIR/plugins-31"; then
+	if test ! -d "$QTDIR/plugins"; then
+	  AC_MSG_RESULT(no)
+	else
+	  QT_PLUGINSDIR=$QTDIR/plugins
+	  AC_MSG_RESULT($QT_PLUGINSDIR)
+	  AC_SUBST(QT_PLUGINSDIR)
+	fi
     else
-      QT_PLUGINSDIR=$QTDIR/plugins
+      QT_PLUGINSDIR=$QTDIR/plugins-31
       AC_MSG_RESULT($QT_PLUGINSDIR)
       AC_SUBST(QT_PLUGINSDIR)
     fi
@@ -814,13 +820,10 @@ if test x$use_qt = xyes ; then
     LDFLAGS="$LDFLAGS $QT_LDFLAGS"
     AC_LANG_SAVE
     AC_LANG_CPLUSPLUS
-    AC_CHECK_LIB(qt, main, QT_LIB=-lqt,
-        AC_CHECK_LIB(qt-mt, main, QT_LIB=-lqt-mt,
-            AC_MSG_ERROR([Cannot find QT libraries.])))
+    AC_CHECK_LIB(qt-mt, main, QT_LIB='-pthread -lqt-mt',
+	AC_MSG_ERROR([Cannot find QT libraries.]), -pthread)
 
-    if test "$QT_LIB" = "-lqt-mt"; then
-      QT_CXXFLAGS="$QT_CXXFLAGS -DQT_THREAD_SUPPORT"
-    fi
+    QT_CXXFLAGS="$QT_CXXFLAGS -DQT_THREAD_SUPPORT"
 
     LDFLAGS=$_SAVE_LDFLAGS
     QT_LIBS="$X_LIBS $QT_LDFLAGS $QT_LIB -lXext -lX11"
