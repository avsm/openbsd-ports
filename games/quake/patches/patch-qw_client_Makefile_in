$OpenBSD: patch-qw_client_Makefile_in,v 1.2 2008/01/11 16:48:44 ajacoutot Exp $
--- qw_client/Makefile.in.orig	Fri Jan 11 17:46:13 2008
+++ qw_client/Makefile.in	Fri Jan 11 17:46:15 2008
@@ -17,9 +17,10 @@ mandir      = @mandir@
 
 BUILD_DIR    = ../targets/qw_client
 
-LDFLAGS = @LDFLAGS@ @SND_LIBS@ -lm -L/usr/local/v6/lib -linet6
+LDFLAGS = @LDFLAGS@ @SND_LIBS@ -lm
 LIBS = @LIBS@
 CC = @CC@
+CC_GL = @CC@ -pthread
 INTEL_ARCH = @INTEL_ARCH@
 
 ifneq ($(SRC_DIR),.)
@@ -77,7 +78,7 @@ RELEASE = @RELEASE@
 ifeq ($(RELEASE),yes)
 OPTFLAGS = @RELEASE_CFLAGS@
 else
-OPTFLAGS = -g
+OPTFLAGS =
 endif
 
 targets       = $(GGIQUAKE) $(SVGAQUAKE) $(GLQUAKE) $(TDFXQUAKE) $(X11QUAKE) $(SDLQUAKE)
@@ -130,6 +131,7 @@ SND_SRC = snd_alsa.c alsa.c
 endif
 ifeq ($(SND_STYLE),OSS)
 SND_SRC = snd_dma.c snd_oss.c
+LDFLAGS+=-lossaudio
 endif
 ifeq ($(SND_STYLE),Solaris)
 SND_SRC = snd_dma.c snd_sun.c
@@ -250,7 +252,7 @@ $(BUILD_DIR)/x11/%.o: $(SRC_DIR)/%.c
 
 $(BUILD_DIR)/x11/%.o: $(SRC_DIR)/%.s
 	$(MAKE_SURE_x11_DIR)
-	$(CC) $(CFLAGS) -DELF -x assembler-with-cpp -o $@ -c $<
+	$(CC) $(CFLAGS) -x assembler-with-cpp -o $@ -c $<
 
 $(BUILD_DIR)/x11/%.o: $(COMMON_DIR)/%.c
 	$(MAKE_SURE_x11_DIR)
@@ -264,7 +266,7 @@ endif
 
 $(BUILD_DIR)/x11/%.o: $(COMMON_DIR)/%.s
 	$(MAKE_SURE_x11_DIR)
-	$(CC) $(CFLAGS) -DELF -x assembler-with-cpp -o $@ -c $<
+	$(CC) $(CFLAGS) -x assembler-with-cpp -o $@ -c $<
 
 $(X11QUAKE): $(BUILD_DIR)/../$(X11QUAKE)
 
@@ -303,7 +305,7 @@ $(BUILD_DIR)/svga/%.o: $(SRC_DIR)/%.c
 
 $(BUILD_DIR)/svga/%.o: $(SRC_DIR)/%.s
 	$(MAKE_SURE_svga_DIR)
-	$(CC) $(CFLAGS) -DELF -x assembler-with-cpp -o $@ -c $<
+	$(CC) $(CFLAGS) -x assembler-with-cpp -o $@ -c $<
 
 $(BUILD_DIR)/svga/%.o: $(COMMON_DIR)/%.c
 	$(MAKE_SURE_svga_DIR)
@@ -317,7 +319,7 @@ endif
 
 $(BUILD_DIR)/svga/%.o: $(COMMON_DIR)/%.s
 	$(MAKE_SURE_svga_DIR)
-	$(CC) $(CFLAGS) -DELF -x assembler-with-cpp -o $@ -c $<
+	$(CC) $(CFLAGS) -x assembler-with-cpp -o $@ -c $<
 
 $(SVGAQUAKE): $(BUILD_DIR)/../$(SVGAQUAKE)
 
@@ -353,7 +355,7 @@ $(BUILD_DIR)/ggi/%.o: $(SRC_DIR)/%.c
 
 $(BUILD_DIR)/ggi/%.o: $(SRC_DIR)/%.s
 	$(MAKE_SURE_ggi_DIR)
-	$(CC) $(CFLAGS) -DELF -x assembler-with-cpp -o $@ -c $<
+	$(CC) $(CFLAGS) -x assembler-with-cpp -o $@ -c $<
 
 $(BUILD_DIR)/ggi/%.o: $(COMMON_DIR)/%.c
 	$(MAKE_SURE_ggi_DIR)
@@ -367,7 +369,7 @@ endif
 
 $(BUILD_DIR)/ggi/%.o: $(COMMON_DIR)/%.s
 	$(MAKE_SURE_ggi_DIR)
-	$(CC) $(CFLAGS) -DELF -x assembler-with-cpp -o $@ -c $<
+	$(CC) $(CFLAGS) -x assembler-with-cpp -o $@ -c $<
 
 $(GGIQUAKE): $(BUILD_DIR)/../$(GGIQUAKE)
 
@@ -398,30 +400,30 @@ MAKE_SURE_gl_DIR = @DIR=gl; $(MAKE_SURE_DIR)
 
 $(BUILD_DIR)/gl/%.o: $(SRC_DIR)/%.c
 	$(MAKE_SURE_gl_DIR)
-	$(CC) $(CFLAGS) $(GL_CFLAGS) -o $@ -c $<
+	$(CC_GL) $(CFLAGS) $(GL_CFLAGS) -o $@ -c $<
 
 $(BUILD_DIR)/gl/%.o: $(SRC_DIR)/%.s
 	$(MAKE_SURE_gl_DIR)
-	$(CC) $(CFLAGS) -DELF -x assembler-with-cpp -o $@ -c $<
+	$(CC_GL) $(CFLAGS) -x assembler-with-cpp -o $@ -c $<
 
 $(BUILD_DIR)/gl/%.o: $(COMMON_DIR)/%.c
 	$(MAKE_SURE_gl_DIR)
-	$(CC) $(CFLAGS) $(GL_CFLAGS) -o $@ -c $<
+	$(CC_GL) $(CFLAGS) $(GL_CFLAGS) -o $@ -c $<
 
 ifneq ($(QW_COMMON_DIR),)
 $(BUILD_DIR)/gl/%.o: $(QW_COMMON_DIR)/%.c
 	$(MAKE_SURE_gl_DIR)
-	$(CC) $(CFLAGS) $(GL_CFLAGS) -o $@ -c $<
+	$(CC_GL) $(CFLAGS) $(GL_CFLAGS) -o $@ -c $<
 endif
 
 $(BUILD_DIR)/gl/%.o: $(COMMON_DIR)/%.s
 	$(MAKE_SURE_gl_DIR)
-	$(CC) $(CFLAGS) -DELF -x assembler-with-cpp -o $@ -c $<
+	$(CC_GL) $(CFLAGS)  -x assembler-with-cpp -o $@ -c $<
 
 $(GLQUAKE): $(BUILD_DIR)/../$(GLQUAKE)
 
 $(BUILD_DIR)/../$(GLQUAKE): $(OBJSquake-gl)
-	$(CC) $(CFLAGS) $(OBJSquake-gl) $(GL_LDFLAGS) $(LDFLAGS) -o $(BUILD_DIR)/../$(GLQUAKE)
+	$(CC_GL) $(CFLAGS) $(OBJSquake-gl) $(GL_LDFLAGS) $(LDFLAGS) -o $(BUILD_DIR)/../$(GLQUAKE)
 
 # XXX - Can this be automated?
 clean-$(GLQUAKE):
@@ -450,7 +452,7 @@ $(BUILD_DIR)/3dfx/%.o: $(SRC_DIR)/%.c
 
 $(BUILD_DIR)/3dfx/%.o: $(SRC_DIR)/%.s
 	$(MAKE_SURE_3dfx_DIR)
-	$(CC) $(CFLAGS) -DELF -x assembler-with-cpp -o $@ -c $<
+	$(CC) $(CFLAGS) -x assembler-with-cpp -o $@ -c $<
 
 $(BUILD_DIR)/3dfx/%.o: $(COMMON_DIR)/%.c
 	$(MAKE_SURE_3dfx_DIR)
@@ -464,7 +466,7 @@ endif
 
 $(BUILD_DIR)/3dfx/%.o: $(COMMON_DIR)/%.s
 	$(MAKE_SURE_gl_DIR)
-	$(CC) $(CFLAGS) -DELF -x assembler-with-cpp -o $@ -c $<
+	$(CC) $(CFLAGS) -x assembler-with-cpp -o $@ -c $<
 
 $(TDFXQUAKE): $(BUILD_DIR)/../$(TDFXQUAKE)
 
@@ -500,7 +502,7 @@ $(BUILD_DIR)/sdl/%.o: $(SRC_DIR)/%.c
 
 $(BUILD_DIR)/sdl/%.o: $(SRC_DIR)/%.s
 	$(MAKE_SURE_sdl_DIR)
-	$(CC) $(CFLAGS) -DELF -x assembler-with-cpp -o $@ -c $<
+	$(CC) $(CFLAGS) -x assembler-with-cpp -o $@ -c $<
 
 $(BUILD_DIR)/sdl/%.o: $(COMMON_DIR)/%.c
 	$(MAKE_SURE_sdl_DIR)
@@ -514,7 +516,7 @@ endif
 
 $(BUILD_DIR)/sdl/%.o: $(COMMON_DIR)/%.s
 	$(MAKE_SURE_sdl_DIR)
-	$(CC) $(CFLAGS) -DELF -x assembler-with-cpp -o $@ -c $<
+	$(CC) $(CFLAGS) -x assembler-with-cpp -o $@ -c $<
 
 $(SDLQUAKE): $(BUILD_DIR)/../$(SDLQUAKE)
 
@@ -540,7 +542,7 @@ clean: $(CLEAN_TARGETS)
 install: $(targets)
 	$(PROJECT_DIR)/mkinstalldirs $(DESTDIR)$(prefix)$(bindir)
 	for i in $(targets); do \
-	   $(PROJECT_DIR)/install-sh -m 755 $(BUILD_DIR)/../$$i \
+	   $(PROJECT_DIR)/install-sh -s -m 755 $(BUILD_DIR)/../$$i \
 	     $(DESTDIR)$(prefix)$(bindir)/$$i; \
 	done
 
