$OpenBSD: patch-sys_sunaudio_gstsunaudiosrc_c,v 1.5 2009/11/29 09:17:38 ajacoutot Exp $
--- sys/sunaudio/gstsunaudiosrc.c.orig	Sat May 16 00:34:32 2009
+++ sys/sunaudio/gstsunaudiosrc.c	Mon Nov 23 18:28:12 2009
@@ -42,8 +42,6 @@
 #include <fcntl.h>
 #include <string.h>
 #include <unistd.h>
-#include <stropts.h>
-#include <sys/mixer.h>
 
 #include "gstsunaudiosrc.h"
 
@@ -266,12 +264,14 @@ gst_sunaudiosrc_open (GstAudioSrc * asrc)
       sunaudiosrc->info.monitor_gain);
   GST_DEBUG_OBJECT (sunaudiosrc, "output_muted %d",
       sunaudiosrc->info.output_muted);
+#ifndef __OpenBSD__
   GST_DEBUG_OBJECT (sunaudiosrc, "hw_features %08x",
       sunaudiosrc->info.hw_features);
   GST_DEBUG_OBJECT (sunaudiosrc, "sw_features %08x",
       sunaudiosrc->info.sw_features);
   GST_DEBUG_OBJECT (sunaudiosrc, "sw_features_enabled %08x",
       sunaudiosrc->info.sw_features_enabled);
+#endif
 
   if (!sunaudiosrc->mixer) {
     const char *audiodev;
@@ -358,7 +358,7 @@ gst_sunaudiosrc_prepare (GstAudioSrc * asrc, GstRingBu
   }
 
 
-  ioctl (sunaudiosrc->fd, I_FLUSH, FLUSHR);
+  ioctl (sunaudiosrc->fd, AUDIO_FLUSH);
 
   return TRUE;
 }
@@ -412,7 +412,7 @@ gst_sunaudiosrc_reset (GstAudioSrc * asrc)
   }
 
   /* Flush the audio */
-  ret = ioctl (sunaudiosrc->fd, I_FLUSH, FLUSHR);
+  ret = ioctl (sunaudiosrc->fd, AUDIO_FLUSH);
   if (ret == -1) {
     GST_ELEMENT_ERROR (sunaudiosrc, RESOURCE, SETTINGS, (NULL), ("%s",
             strerror (errno)));
