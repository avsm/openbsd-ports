$OpenBSD: patch-provider_libserver_ECStoreObjectTable_cpp,v 1.3 2011/03/03 13:16:05 ajacoutot Exp $
--- provider/libserver/ECStoreObjectTable.cpp.orig	Mon Jan 24 16:55:05 2011
+++ provider/libserver/ECStoreObjectTable.cpp	Tue Jan 25 12:56:18 2011
@@ -657,7 +657,9 @@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
 	unsigned int ulLastPos;
 	unsigned int ulColId = 0;
 	std::string strData;
+#ifndef __OpenBSD__
 	locale_t loc = createlocale(LC_NUMERIC, "C");
+#endif
 	
 	if(lpSession == NULL || lpsMapKey == NULL)
 	{
@@ -709,7 +711,11 @@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
 			break;
 		case PT_R4:
  			lpPropVal->__union = SOAP_UNION_propValData_flt;
+#ifndef __OpenBSD__
 			lpPropVal->Value.flt = (float)strtod_l(lpDBRow[ulColId], NULL, loc);
+#else
+			lpPropVal->Value.flt = (float)strtod(lpDBRow[ulColId], NULL);
+#endif
 			break;
 		case PT_BOOLEAN:
  			lpPropVal->__union = SOAP_UNION_propValData_b;
@@ -717,7 +723,11 @@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
 			break;
 		case PT_DOUBLE:
  			lpPropVal->__union = SOAP_UNION_propValData_dbl;
+#ifndef __OpenBSD__
 			lpPropVal->Value.dbl = strtod_l(lpDBRow[ulColId], NULL, loc);
+#else
+			lpPropVal->Value.dbl = strtod(lpDBRow[ulColId], NULL);
+#endif
 			break;
 		case PT_CURRENCY:
 			lpPropVal->Value.hilo = s_alloc<hiloLong>(soap);
@@ -727,7 +737,11 @@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
 			break;
 		case PT_APPTIME:
  			lpPropVal->__union = SOAP_UNION_propValData_dbl;
+#ifndef __OpenBSD__
 			lpPropVal->Value.dbl = strtod_l(lpDBRow[ulColId], NULL, loc);
+#else
+			lpPropVal->Value.dbl = strtod(lpDBRow[ulColId], NULL);
+#endif
 			break;
 		case PT_SYSTIME:
 			lpPropVal->Value.hilo = s_alloc<hiloLong>(soap);
@@ -820,7 +834,11 @@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
 			{
 				ParseMVProp(lpDBRow[ulColId], lpDBLen[ulColId], &ulLastPos, &strData);
 
+#ifndef __OpenBSD__
 				lpPropVal->Value.mvflt.__ptr[j] = (float)strtod_l(strData.c_str(), NULL, loc);
+#else
+				lpPropVal->Value.mvflt.__ptr[j] = (float)strtod(strData.c_str(), NULL);
+#endif
 			}
 			break;
 		case PT_MV_APPTIME:
@@ -840,7 +858,11 @@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
 			{
 				ParseMVProp(lpDBRow[ulColId], lpDBLen[ulColId], &ulLastPos, &strData);
 
+#ifndef __OpenBSD__
 				lpPropVal->Value.mvdbl.__ptr[j] = strtod_l(strData.c_str(), NULL, loc);
+#else
+				lpPropVal->Value.mvdbl.__ptr[j] = strtod(strData.c_str(), NULL);
+#endif
 			}
 			break;
 		case PT_MV_CURRENCY:
@@ -948,7 +970,9 @@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
 	} 
 
 exit:
+#ifndef __OpenBSD__
 	freelocale(loc);
+#endif
 	return er;
 }
 
