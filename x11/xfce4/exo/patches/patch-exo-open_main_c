$OpenBSD: patch-exo-open_main_c,v 1.3 2009/08/06 09:32:50 landry Exp $
--- exo-open/main.c.orig	Sat Apr 11 12:09:56 2009
+++ exo-open/main.c	Thu Aug  6 11:22:09 2009
@@ -36,7 +36,19 @@
 #include <exo/exo.h>
 
 
+/**
+ * For testing this code the following commands should work:
+ * 
+ * exo-open --launch WebBrowser http://xfce.org (bug #5461).
+ * exo-open http://xfce.org
+ * exo-open --launch TerminalEmulator ./script.sh 'something with a space' 'nospace' (bug #5132).
+ * exo-open --launch TerminalEmulator ssh -l username some.host.com
+ * xfterm4 -e ssh -l ssh -l username some.host.com (bug #5301, this generates line below)
+ *   exo-open --launch TerminalEmulator 'ssh -l username some.host.com'
+ **/
 
+
+
 static gboolean opt_help = FALSE;
 static gboolean opt_version = FALSE;
 static gchar   *opt_launch = NULL;
@@ -110,6 +122,7 @@ main (int argc, char **argv)
   g_option_context_set_help_enabled (context, FALSE);
   g_option_context_add_main_entries (context, entries, GETTEXT_PACKAGE);
   g_option_context_add_group (context, gtk_get_option_group (TRUE));
+  g_option_context_set_ignore_unknown_options (context, TRUE);
   if (!g_option_context_parse (context, &argc, &argv, &err))
     {
       g_fprintf (stderr, "exo-open: %s.\n", err->message);
@@ -142,6 +155,8 @@ main (int argc, char **argv)
     {
       if (argc > 1)
         {
+          /* NOTE: see the comment at the top of this document! */
+
           /* combine all specified parameters to one parameter string */
           join = g_string_new (NULL);
           for (i = 1; argv[i] != NULL; i++)
@@ -149,11 +164,20 @@ main (int argc, char **argv)
               /* separate the arguments */
               if (i > 1)
                 join = g_string_append_c (join, ' ');
-
-              /* append the quoted argument */
-              quoted = g_shell_quote (argv[i]);
-              join = g_string_append (join, quoted);
-              g_free (quoted);
+              
+              /* only quote arguments with spaces if there are multiple
+               * arguments to be merged, this is a bit of magic to make
+               * common cares work property, see sample above with xfrun4 */
+              if (argc > 2 && strchr (argv[i], ' ') != NULL)
+                {
+                  quoted = g_shell_quote (argv[i]);
+                  join = g_string_append (join, quoted);
+                  g_free (quoted);
+                }
+              else
+                {
+                  join = g_string_append (join, argv[i]);
+                }
             }
           parameter = g_string_free (join, FALSE);
         }
@@ -161,6 +185,10 @@ main (int argc, char **argv)
         {
           parameter = NULL;
         }
+
+#ifndef NDEBUG
+      g_message ("launch=%s, wd=%s, parameters (%d)=%s", opt_launch, opt_working_directory, argc, parameter);
+#endif
 
       /* run the preferred application */
       if (!exo_execute_preferred_application (opt_launch, parameter, opt_working_directory, NULL, &err))
