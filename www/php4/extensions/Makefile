# $OpenBSD: Makefile,v 1.4 2002/07/09 18:14:16 avsm Exp $

PKGNAME=	php4-gd-${V}

MULTI_PACKAGES=	-bz2 -curl -dba -dbase -filepro \
		-gmp -imap -ldap -mcrypt -mhash -mysql -ncurses \
		-odbc -pdf -pgsql -shmop -sybase_ct -xml -xslt
SUBPACKAGE?=

FLAVORS+=	no_x11
FLAVOR?= 

RUN_DEPENDS=	:php4-core-${V}:www/php4/core

CONFIGURE_ARGS+=	--with-apxs=/usr/sbin/apxs \
			--with-jpeg-dir=shared,${LOCALBASE} \
			--with-png-dir=shared,${LOCALBASE} \
			--with-tiff-dir=shared,${LOCALBASE}

JPEG_DEPENDS=		jpeg.62::graphics/jpeg
PNG_DEPENDS=		png.3::graphics/png 
TIFF_DEPENDS=		tiff.35::graphics/tiff
GD_DEPENDS=		gd.18::graphics/gd

LIB_DEPENDS+=		${GD_DEPENDS} ${JPEG_DEPENDS} ${PNG_DEPENDS} \
			${TIFF_DEPENDS}

.for i in ${MULTI_PACKAGES}
FULLPKGNAME${i}=	php4${i}-${V}
.endfor

# bz2
COMMENT-bz2=		"bzip2 compression extensions for php4"
CONFIGURE_ARGS+=	--with-bz2=shared,${LOCALBASE}
BZ2_DEPENDS=		bz2.10::archivers/bzip2

# curl
COMMENT-curl=		"curl URL library extensions for php4"
CONFIGURE_ARGS+=	--with-curl=shared,${LOCALBASE}
CURL_DEPENDS=		curl.2::net/curl

# dba
COMMENT-dba=		"dba GDBM access extensions for php4"
CONFIGURE_ARGS+=	--enable-dba=shared --with-gdbm=${LOCALBASE}
DBA_DEPENDS=		gdbm.2::databases/gdbm

# dbase
COMMENT-dbase=		"dBase database access extensions for php4"
CONFIGURE_ARGS+=	--enable-dbase=shared

# filepro
COMMENT-filepro=	"filepro database access extensions for php4"
CONFIGURE_ARGS+=	--enable-filepro=shared

# gd
COMMENT=		"image manipulation extensions for php4"
CONFIGURE_ARGS+=	--with-gd=shared,${LOCALBASE}
.if !${FLAVOR:L:Mno_x11}
USE_X11=		yes
CONFIGURE_ARGS+=	--with-xpm-dir=${X11BASE} --with-ttf=shared,${LOCALBASE} --without-freetype-dir
.else
CONFIGURE_ARGS+=	--without-xpm-dir --without-freetype-dir --without-ttf
.endif

# gmp
COMMENT-gmp=		"gmp math library support for php4"
CONFIGURE_ARGS+=	--with-gmp=shared,${LOCALBASE}
GMP_DEPENDS=		gmp.4::devel/gmp

# imap
COMMENT-imap=		"imap, pop3 and nntp extensions for php4"
CONFIGURE_ARGS+=	--with-imap=shared,${LOCALBASE} \
			--with-kerberos=/usr/lib --with-imap-ssl
IMAP_DEPENDS=		c-client.3::mail/c-client

# ldap
COMMENT-ldap=		"ldap protocol extensions for php4"
CONFIGURE_ARGS+=	--with-ldap=shared,${LOCALBASE}
LDAP_DEPENDS=		ldap.2,lber::databases/openldap

# mcrypt
COMMENT-mcrypt=		"mcrypt encryption/decryption extensions for php4"
CONFIGURE_ARGS+=	--with-mcrypt=shared,${LOCALBASE}
MCRYPT_DEPENDS=		mcrypt::security/libmcrypt

# mhash
COMMENT-mhash=		"mhash extensions for php4"
CONFIGURE_ARGS+=	--with-mhash=shared,${LOCALBASE}
MHASH_DEPENDS=		mhash.2::security/mhash

# mysql
COMMENT-mysql=		"mysql database access extensions for php4"
CONFIGURE_ARGS+=	--with-mysql=shared,${LOCALBASE}
MYSQL_DEPENDS=		lib/mysql/mysqlclient.10:mysql-client-3.23.*:databases/mysql

# ncurses
COMMENT-ncurses=	"ncurses extensions for php4"
CONFIGURE_ARGS+=	--with-ncurses=shared,${LOCALBASE}

# odbc
COMMENT-odbc=		"odbc database access extensions for php4"
CONFIGURE_ARGS+=        --with-iodbc=shared
ODBC_DEPENDS=		iodbc.2::databases/iodbc

# pdf
COMMENT-pdf=		"pdf viewing and creation extensions for php4"
CONFIGURE_ARGS+=	--with-pdflib=shared,${LOCALBASE}
PDF_DEPENDS=		pdf.2::print/pdflib ${JPEG_DEPENDS} \
			${PNG_DEPENDS} ${TIFF_DEPENDS}

# pgsql
COMMENT-pgsql=		"pgsql database access extensions for php4"
CONFIGURE_ARGS+=	--with-pgsql=shared,${LOCALBASE}
PGSQL_DEPENDS=		pq.2::databases/postgresql

# shmop
COMMENT-shmop=		"shared memory extensions for php4"
CONFIGURE_ARGS+=	--enable-shmop=shared

# snmp .. waiting for ssl ...
COMMENT-snmp=		"snmp protocol extensions for php4"
#-CONFIGURE_ARGS+=	--with-snmp=shared,${LOCALBASE} --enable-ucd-snmp-hack
#-LIB_DEPENDS+=		snmp.42::net/ucd-snmp

# sybase-ct
COMMENT-sybase_ct=	"sybase database access extensions for php4"
CONFIGURE_ARGS+=        --with-sybase-ct=shared,${LOCALBASE}
SYBASE_CT_DEPENDS=	tds.0,ct.0::databases/freetds

# wddx & xml
COMMENT-xml=		"xml parsing extensions for php4"
CONFIGURE_ARGS+=	--with-wddx=shared --with-xml=shared \
			--with-expat-dir=shared,${LOCALBASE}
XML_DEPENDS=		expat.2::textproc/expat

# xslt
COMMENT-xslt=		"xslt transformation extensions for php4"
CONFIGURE_ARGS+=	--enable-xslt=shared --with-xslt-sablot=shared=${LOCALBASE} \
			--with-expat-dir=shared,${LOCALBASE}
XSLT_DEPENDS=		sablot.90::textproc/sablotron expat.2::textproc/expat

.if defined(PACKAGING)
.if (empty(SUBPACKAGE))
MODULE_NAME=		gd
.else
MODULE_NAME=		${SUBPACKAGE:S/-//g}
.endif
LIB_DEPENDS=		${${MODULE_NAME:U}_DEPENDS}
MESSAGE=		${PKGDIR}/MESSAGE
SUBST_VARS=		MODULE_NAME PHP_CONFIG_FILE
.else
.for i in ${MULTI_PACKAGES}
LIB_DEPENDS+=		${${i:U:S/-//g}_DEPENDS}
.endfor
.endif

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/${MODULES_SUBDIR}
.for m in gd ${MULTI_PACKAGES:S/-//g}
	${INSTALL_DATA} ${WRKBUILD}/modules/${m}.so \
		${PREFIX}/${MODULES_SUBDIR}/${m}.so
.endfor


.include <bsd.port.mk>
