$OpenBSD: patch-modules_Makefile_in,v 1.17 2010/04/03 10:37:06 ajacoutot Exp $
--- modules/Makefile.in.orig	Tue Mar 30 21:13:50 2010
+++ modules/Makefile.in	Wed Mar 31 10:34:58 2010
@@ -643,21 +643,11 @@ uninstall-am: uninstall-local
 @CROSS_COMPILING_FALSE@all-local: pango.modules
 
 install-data-local: $(top_builddir)/pango/pango-querymodules$(EXEEXT)
-	@if $(RUN_QUERY_MODULES_TEST) && test -z "$(DESTDIR)" ; then 	\
-	  echo $(mkinstalldirs) $(DESTDIR)$(sysconfdir)/pango \&\& 	\
-	  $(top_builddir)/pango/pango-querymodules$(EXEEXT) 		\
-		\> $(DESTDIR)$(sysconfdir)/pango/pango.modules ;	\
-	  $(mkinstalldirs) $(DESTDIR)$(sysconfdir)/pango && 		\
-	  $(top_builddir)/pango/pango-querymodules$(EXEEXT) 		\
-		> $(DESTDIR)$(sysconfdir)/pango/pango.modules ;		\
-	else								\
-	  echo "***" ; 							\
-	  echo "*** Warning: $(sysconfdir)/pango/pango.modules" ; 	\
-	  echo "*** not created" ; 					\
-	  echo "*** Generate this file on the target system" ; 		\
-	  echo "*** using pango-querymodules" ; 			\
-	  echo "***" ; 							\
-	fi
+	$(mkinstalldirs) $(DESTDIR)$(sysconfdir)/pango &&	\
+	  LD_LIBRARY_PATH=$(top_builddir)/pango/.libs		\
+	  $(top_builddir)/pango/pango-querymodules		\
+	  `find $(DESTDIR)$(moduledir) -name '*.so'` | sed 's,$(DESTDIR),,' \
+	  > $(DESTDIR)$(sysconfdir)/pango/pango.modules
 
 uninstall-local:
 	$(RM) $(DESTDIR)$(sysconfdir)/pango/pango.modules
