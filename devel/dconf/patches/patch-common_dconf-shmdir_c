$OpenBSD: patch-common_dconf-shmdir_c,v 1.5 2011/06/24 14:13:27 ajacoutot Exp $

https://bugzilla.gnome.org/show_bug.cgi?id=653342

--- common/dconf-shmdir.c.orig	Tue Jan 18 06:48:15 2011
+++ common/dconf-shmdir.c	Fri Jun 24 16:01:53 2011
@@ -21,11 +21,15 @@
 
 #include "dconf-shmdir.h"
 
-#ifndef __FreeBSD__
+#if !defined (__FreeBSD__) && !defined (__OpenBSD__)
 #include <sys/statfs.h>
 #include <sys/vfs.h>
 #endif
 
+#ifdef __OpenBSD__
+#include <string.h>
+#endif
+
 #include <sys/param.h>
 #include <sys/mount.h>
 #include <errno.h>
@@ -53,7 +57,11 @@ is_local (const gchar *filename)
       while (s < 0 && errno == EINTR);
     }
 
+#ifndef __OpenBSD__
   return s == 0 && buf.f_type != NFS_SUPER_MAGIC;
+#else
+  return s == 0 && strncmp (buf.f_fstypename, MOUNT_NFS, MFSNAMELEN) != 0;
+#endif
 }
 
 gchar *
