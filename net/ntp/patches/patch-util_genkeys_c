$OpenBSD: patch-util_genkeys_c,v 1.1 2001/12/20 06:14:16 danh Exp $
--- util/genkeys.c.orig	Wed Sep 19 02:06:58 2001
+++ util/genkeys.c	Thu Dec 20 00:54:56 2001
@@ -8,6 +8,7 @@
 #endif
 #include <stdio.h>
 #include <stdlib.h>
+#include <string.h>
 #include <unistd.h>
 #include <sys/stat.h>
 #include <sys/time.h>
@@ -76,6 +77,7 @@ main(
 	u_char	seed[20];	/* seed for DSA parameters */
 	int	codes;		/* DH check codes */
 	char	pathbuf[PATH_MAX];
+	const char *p;
 #endif /* OPENSSL */
 	u_char	md5key[16];
 	FILE	*str;
@@ -116,11 +118,13 @@ main(
 	/*
 	 * Seed random number generator and grow weeds.
 	 */
-	if (RAND_file_name(pathbuf, PATH_MAX) == NULL) {
+	if ((p = RAND_file_name(pathbuf, PATH_MAX)) == NULL) {
 		printf("RAND_file_name %s\n",
 		    ERR_error_string(ERR_get_error(), NULL));
 		exit (-1);
 	}
+	if (p != pathbuf)
+		strlcpy(pathbuf, p, sizeof pathbuf);
 	temp = RAND_load_file(pathbuf, -1);
 	if (temp == 0) {
 		printf("RAND_load_file %s\n",
