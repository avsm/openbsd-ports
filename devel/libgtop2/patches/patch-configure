$OpenBSD: patch-configure,v 1.2 2007/01/18 19:31:34 jasper Exp $
--- configure.orig	Wed Jan 17 08:48:59 2007
+++ configure	Wed Jan 17 08:55:18 2007
@@ -6185,6 +6185,16 @@ freebsd* | dragonfly*)
   fi
   ;;
 
+openbsd*)
+  lt_cv_file_magic_cmd=/usr/bin/file
+  lt_cv_file_magic_test_file=`echo /usr/lib/libc.so.*`
+  if test -z "`echo __ELF__ | $CC -E - | grep __ELF__`" || test "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+    lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB shared object'
+  else
+    lt_cv_deplibs_check_method='file_magic OpenBSD.* shared library'
+  fi
+  ;;
+
 gnu*)
   lt_cv_deplibs_check_method=pass_all
   ;;
@@ -20874,7 +20884,6 @@ echo $ECHO_N "checking for libgtop sysde
 	  libgtop_sysdeps_dir=freebsd
 	  libgtop_use_machine_h=yes
 	  libgtop_need_server=yes
-	  libgtop_postinstall='chgrp kmem $(bindir)/libgtop_server && chmod 2755 $(bindir)/libgtop_server'
 	  ;;
 	solaris*)
 	  libgtop_sysdeps_dir=solaris
@@ -21382,6 +21391,7 @@ else
 	    for def in nothing KERNEL _KERNEL; do
 	      cat >conftest.$ac_ext <<_ACEOF
 #define $def
+#include <sys/types.h>
 #include <sys/ipc.h>
 #include <sys/msg.h>
 #include <stdio.h>
@@ -26161,7 +26171,7 @@ if test "${ac_cv_lib_intl_strftime+set}"
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-lintl  $LIBS"
+LIBS="-lintl -liconv $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -26221,7 +26231,7 @@ if test $ac_cv_lib_intl_strftime = yes; 
 #define HAVE_STRFTIME 1
 _ACEOF
 
-LIBS="-lintl $LIBS"
+LIBS="-lintl -liconv $LIBS"
 fi
 
 fi
@@ -27365,7 +27375,7 @@ if test "${ac_cv_lib_intl_bindtextdomain
   echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_check_lib_save_LIBS=$LIBS
-LIBS="-lintl  $LIBS"
+LIBS="-lintl  -liconv $LIBS"
 cat >conftest.$ac_ext <<_ACEOF
 /* confdefs.h.  */
 _ACEOF
@@ -27701,7 +27711,7 @@ fi
         #
         if test "$gt_cv_func_dgettext_libintl" = "yes" ; then
           glib_save_LIBS="$LIBS"
-          LIBS="$LIBS -lintl $libintl_extra_libs"
+          LIBS="$LIBS -lintl -liconv $libintl_extra_libs"
           unset ac_cv_func_bind_textdomain_codeset
 
 for ac_func in bind_textdomain_codeset
@@ -27816,7 +27826,7 @@ done
       fi
 
       if test "$gt_cv_func_dgettext_libintl" = "yes"; then
-        INTLLIBS="-lintl $libintl_extra_libs"
+        INTLLIBS="-lintl -liconv $libintl_extra_libs"
       fi
 
       if test "$gt_cv_have_gettext" = "yes"; then
