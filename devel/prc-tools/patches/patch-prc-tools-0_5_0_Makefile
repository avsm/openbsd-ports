--- Makefile.orig	Thu Jul 10 05:14:12 1997
+++ Makefile	Thu Aug 23 19:48:54 2001
@@ -2,8 +2,7 @@
 CFLAGS = -O2 -g
 # -g -DDEBUG
 
-PREFIX = /usr/local/gnu
-HOST = i386-slackware-linux
+#PREFIX = /usr/local/pilot
 TARGET-NAME = m68k-palmos-coff
 
 EXEEXT = 
@@ -15,15 +14,15 @@
 GCCDIR = ../gcc-2.7.2.2
 GDBDIR = ../gdb-4.16
 
-GNUARCH = /cdrom/gnu
+GNUARCH = /usr/ports/distfiles
 
-TTY = /dev/cua0
+TTY = /dev/pilot
 
 M68K_BFD = $(PREFIX)/lib/lib$(TARGET-NAME)-bfd.a
 
 LBFD = `if [ -f $(M68K_BFD) ]; \
 	then echo $(M68K_BFD); \
-	else echo "-L$(PREFIX)/lib -lbfd"; fi` -liberty
+	else echo "-L$(PREFIX)/lib -lbfd"; fi` -L$(PREFIX)/lib -liberty
 
 LIBCDIR = libc.0.1.2
 LIBMDIR = libmf.0.1.2
@@ -34,6 +33,8 @@
 # export doesn't work on make in gnuwin32 b18...
 MAKEEXPORTS = PREFIX=$(PREFIX) TOOLDIR=$(TOOLDIR) \
 	LIBCDIR=$(LIBCDIR) LIBMDIR=$(LIBMDIR) LIBGLIBDIR=$(LIBGLIBDIR)
+IEXPORTS = PREFIX=$(PREFIX) TOOLDIR=$(TOOLDIR) \
+	LIBCDIR=$(LIBCDIR) LIBMDIR=$(LIBMDIR) LIBGLIBDIR=$(LIBGLIBDIR)
 
 all: gdbpanel/gdbpanel.prc example/pilrctst.prc
 
@@ -61,27 +62,27 @@
 	make install
 
 install: all dummy install-man
-	cd $(LIBCDIR) ; make $(MAKEEXPORTS) install
-	cd $(LIBMDIR) ; make $(MAKEEXPORTS) install
-	cd $(LIBGLIBDIR) ; make $(MAKEEXPORTS) install
-	cp -f pilrc$(EXEEXT) $(PREFIX)/$(TARGET-NAME)/bin
-	cp -f txt2bitm$(EXEEXT) $(PREFIX)/$(TARGET-NAME)/bin
-	cp -f obj-res$(EXEEXT) $(PREFIX)/$(TARGET-NAME)/bin
-	cp -f build-prc$(EXEEXT) $(PREFIX)/$(TARGET-NAME)/bin
-	cp -f stubgen $(PREFIX)/$(TARGET-NAME)/bin
-	cp -f exportlist $(PREFIX)/$(TARGET-NAME)/bin
-	-cp -raf PalmOS1 $(PREFIX)/$(TARGET-NAME)/include
-	-cp -raf PalmOS2 $(PREFIX)/$(TARGET-NAME)/include
-	ln -snf $(PREFIX)/$(TARGET-NAME)/include/PalmOS2 $(PREFIX)/$(TARGET-NAME)/include/PalmOS
-	ln -sf $(PREFIX)/$(TARGET-NAME)/bin/pilrc$(EXEEXT) $(PREFIX)/bin/pilrc$(EXEEXT)
-	ln -sf $(PREFIX)/$(TARGET-NAME)/bin/txt2bitm$(EXEEXT) $(PREFIX)/bin/txt2bitm$(EXEEXT)
-	ln -sf $(PREFIX)/$(TARGET-NAME)/bin/obj-res$(EXEEXT) $(PREFIX)/bin/$(TARGET-NAME)-obj-res$(EXEEXT)
-	ln -sf $(PREFIX)/$(TARGET-NAME)/bin/exportlist $(PREFIX)/bin/$(TARGET-NAME)-exportlist
-	ln -sf $(PREFIX)/$(TARGET-NAME)/bin/build-prc$(EXEEXT) $(PREFIX)/bin/build-prc$(EXEEXT)
-	ln -sf $(PREFIX)/$(TARGET-NAME)/bin/stubgen $(PREFIX)/bin/$(TARGET-NAME)-stubgen
+	cd $(LIBCDIR) ; make $(IEXPORTS) install
+	cd $(LIBMDIR) ; make $(IEXPORTS) install
+	cd $(LIBGLIBDIR) ; make $(IEXPORTS) install
+	cp -f pilrc$(EXEEXT) $(PREFIX)/$(TARGET-NAME)/bin
+	cp -f txt2bitm$(EXEEXT) $(PREFIX)/$(TARGET-NAME)/bin
+	cp -f obj-res$(EXEEXT) $(PREFIX)/$(TARGET-NAME)/bin
+	cp -f build-prc$(EXEEXT) $(PREFIX)/$(TARGET-NAME)/bin
+	cp -f stubgen $(PREFIX)/$(TARGET-NAME)/bin
+	cp -f exportlist $(PREFIX)/$(TARGET-NAME)/bin
+	-cp -rf PalmOS1 $(PREFIX)/$(TARGET-NAME)/include
+	-cp -rf PalmOS2 $(PREFIX)/$(TARGET-NAME)/include
+	ln -sf $(PREFIX)/$(TARGET-NAME)/include/PalmOS2 $(PREFIX)/$(TARGET-NAME)/include/PalmOS
+	ln -sf $(PREFIX)/$(TARGET-NAME)/bin/pilrc$(EXEEXT) $(PREFIX)/bin/pilrc$(EXEEXT)
+	ln -sf $(PREFIX)/$(TARGET-NAME)/bin/txt2bitm$(EXEEXT) $(PREFIX)/bin/txt2bitm$(EXEEXT)
+	ln -sf $(PREFIX)/$(TARGET-NAME)/bin/obj-res$(EXEEXT) $(PREFIX)/bin/$(TARGET-NAME)-obj-res$(EXEEXT)
+	ln -sf $(PREFIX)/$(TARGET-NAME)/bin/exportlist $(PREFIX)/bin/$(TARGET-NAME)-exportlist
+	ln -sf $(PREFIX)/$(TARGET-NAME)/bin/build-prc$(EXEEXT) $(PREFIX)/bin/build-prc$(EXEEXT)
+	ln -sf $(PREFIX)/$(TARGET-NAME)/bin/stubgen $(PREFIX)/bin/$(TARGET-NAME)-stubgen
 
 install-man: dummy
-	cp man/* $(PREFIX)/man/man1
+	cp man/* $(PREFIX)/man/man1
 
 send: all
 	echo Hit the HotSync button on the Pilot connected to $(TTY)
@@ -156,21 +157,21 @@
 gnutools: stamp.binutils stamp.gcc stamp.gdb
 
 stamp.binutils:
-	cd $(BINUTILSDIR) ; ./configure --host=$(HOST) --prefix=$(PREFIX) --target=$(TARGET-NAME)
+	cd $(BINUTILSDIR) ; ./configure --prefix=$(PREFIX) --target=$(TARGET-NAME) -host=$(MACHINE_ARCH)-unknown-freebsd
 	cd $(BINUTILSDIR) ; make
-	cd $(BINUTILSDIR) ; make install
+	cd $(BINUTILSDIR) ; PREFIX=$(PREFIX) make install
 	touch $@
 
 stamp.gcc:
-	cd $(GCCDIR) ; ./configure --host=$(HOST) --prefix=$(PREFIX) --target=$(TARGET-NAME)
+	cd $(GCCDIR) ; ./configure --prefix=$(PREFIX) --target=$(TARGET-NAME) --host=$(MACHINE_ARCH)-unknown-freebsd
 	cd $(GCCDIR) ; make LANGUAGES=c
-	cd $(GCCDIR) ; make LANGUAGES=c install
+	cd $(GCCDIR) ; PREFIX=$(PREFIX) make LANGUAGES=c install
 	touch $@
 
 stamp.gdb:
-	cd $(GDBDIR) ; ./configure --host=$(HOST) --prefix=$(PREFIX) --target=$(TARGET-NAME)
+	cd $(GDBDIR) ; ./configure --prefix=$(PREFIX) --target=$(TARGET-NAME) --host=$(MACHINE_ARCH)-unknown-freebsd
 	cd $(GDBDIR) ; make
-	cd $(GDBDIR) ; make install
+	cd $(GDBDIR) ; PREFIX=$(PREFIX) make install
 	touch $@
 
 dummy:
