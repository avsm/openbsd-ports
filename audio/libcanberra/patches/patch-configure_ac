$OpenBSD: patch-configure_ac,v 1.2 2009/03/05 08:11:56 ajacoutot Exp $
--- configure.ac.orig	Wed Jan 21 21:59:28 2009
+++ configure.ac	Tue Mar  3 09:32:42 2009
@@ -19,14 +19,14 @@
 # License along with libcanberra. If not, see
 # <http://www.gnu.org/licenses/>.
 
-AC_PREREQ(2.63)
+AC_PREREQ(2.62)
 
 AC_INIT([libcanberra], 0.11, [mzyvopnaoreen (at) 0pointer (dot) de])
 AC_CONFIG_SRCDIR([src/common.c])
 AC_CONFIG_HEADERS([config.h])
 AC_CONFIG_MACRO_DIR(m4)
 
-AM_INIT_AUTOMAKE([foreign 1.10 -Wall])
+AM_INIT_AUTOMAKE([foreign 1.9 -Wall])
 
 AC_SUBST(PACKAGE_URL, [http://0pointer.de/lennart/projects/libcanberra/])
 
@@ -65,7 +65,6 @@ done
 
 #### libtool stuff ####
 LT_PREREQ(2.2)
-LT_CONFIG_LTDL_DIR([libltdl])
 LT_INIT([dlopen win32-dll disable-static])
 LTDL_INIT([convenience recursive])
 
@@ -230,6 +229,36 @@ else
     HAVE_OSS=0
 fi
 
+### SNDIO support (optional) ###
+
+AC_ARG_ENABLE([sndio],
+    AC_HELP_STRING([--disable-sndio], [Disable optional sndio support]),
+        [
+            case "${enableval}" in
+                yes) sndio=yes ;;
+                no) sndio=no ;;
+                *) AC_MSG_ERROR(bad value ${enableval} for --disable-sndio) ;;
+            esac
+        ],
+        [sndio=auto])
+
+if test "x${sndio}" != xno ; then
+    AC_CHECK_HEADERS(sndio.h)
+    if test "${ac_cv_header_sndio_h}" = "yes"; then
+	HAVE_SNDIO=1
+        AC_DEFINE([HAVE_SNDIO], 1, [Have sndio?])
+        SNDIO_LIBS='-lsndio'
+    else
+	HAVE_SNDIO=0
+        if test "x$sndio" = xyes ; then
+            AC_MSG_ERROR([*** sndio not found ***])
+        fi
+    fi
+else
+    HAVE_SNDIO=0
+fi
+AC_SUBST(SNDIO_LIBS)
+
 ### PulseAudio (optional) ####
 
 AC_ARG_ENABLE([pulse],
@@ -451,6 +480,7 @@ BUILTIN_DSO=0
 BUILTIN_PULSE=0
 BUILTIN_ALSA=0
 BUILTIN_OSS=0
+BUILTIN_SNDIO=0
 BUILTIN_GSTREAMER=0
 BUILTIN_NULL=0
 
@@ -463,6 +493,7 @@ case "x$with_builtin" in
         BUILTIN_PULSE=1
         HAVE_ALSA=0
 	HAVE_OSS=0
+	HAVE_SNDIO=0
 	HAVE_GSTREAMER=0
         HAVE_NULL=0
      ;;
@@ -474,6 +505,7 @@ case "x$with_builtin" in
 
         BUILTIN_ALSA=1
 	HAVE_OSS=0
+	HAVE_SNDIO=0
         HAVE_PULSE=0
 	HAVE_GSTREAMER=0
         HAVE_NULL=0
@@ -487,6 +519,7 @@ case "x$with_builtin" in
         BUILTIN_GSTREAMER=1
         HAVE_ALSA=0
 	HAVE_OSS=0
+	HAVE_SNDIO=0
         HAVE_PULSE=0
         HAVE_NULL=0
      ;;
@@ -498,18 +531,32 @@ case "x$with_builtin" in
 
 	BUILTIN_OSS=1
 	HAVE_ALSA=0
+	HAVE_SNDIO=0
 	HAVE_PULSE=0
 	HAVE_GSTREAMER=0
 	HAVE_NULL=0
      ;;
 
+     xsndio)
+        if test "x$HAV_SNDIO" != x1 ; then
+	        AC_MSG_ERROR([*** sndio selected for builtin driver, but not enabled. ***])
+	fi
+
+	BUILTIN_SNDIO=1
+	HAVE_ALSA=0
+	HAVE_OSS=0
+	HAVE_PULSE=0
+	HAVE_GSTREAMER=0
+	HAVE_NULL=0
+     ;;
+
      xnull)
         if test "x$HAVE_NULL" != x1 ; then
                 AC_MSG_ERROR([*** Null output selected for builtin driver, but not enabled. ***])
         fi
 
         BUILTIN_NULL=1
-        HAVE_PULSE=0
+	HAVE_SNDIO=0
         HAVE_ALSA=0
 	HAVE_OSS=0
 	HAVE_GSTREAMER=0
@@ -525,7 +572,7 @@ case "x$with_builtin" in
         AC_MSG_ERROR([*** Unknown driver $with_builtin selected for builtin ***])
 esac
 
-if test "x$HAVE_PULSE" != x1 -a "x$HAVE_ALSA" != x1 -a "x$HAVE_OSS" != x1 -a "x$HAVE_GSTREAMER" != x1 -a "x$HAVE_NULL" != x1 ; then
+if test "x$HAVE_PULSE" != x1 -a "x$HAVE_ALSA" != x1 -a "x$HAVE_OSS" != x1 -a "x$HAVE_SNDIO" != x1 -a "x$HAVE_GSTREAMER" != x1 -a "x$HAVE_NULL" != x1 ; then
    AC_MSG_ERROR([*** No backend enabled. ***])
 fi
 
@@ -533,23 +580,27 @@ AC_SUBST(HAVE_DSO)
 AC_SUBST(HAVE_PULSE)
 AC_SUBST(HAVE_ALSA)
 AC_SUBST(HAVE_OSS)
+AC_SUBST(HAVE_SNDIO)
 AC_SUBST(HAVE_GSTREAMER)
 AC_SUBST(HAVE_NULL)
 AC_SUBST(BUILTIN_DSO)
 AC_SUBST(BUILTIN_PULSE)
 AC_SUBST(BUILTIN_ALSA)
 AC_SUBST(BUILTIN_OSS)
+AC_SUBST(BUILTIN_SNDIO)
 AC_SUBST(BUILTIN_GSTREAMER)
 AC_SUBST(BUILTIN_NULL)
 AM_CONDITIONAL([HAVE_PULSE], [test "x$HAVE_PULSE" = x1])
 AM_CONDITIONAL([HAVE_ALSA], [test "x$HAVE_ALSA" = x1])
 AM_CONDITIONAL([HAVE_OSS], [test "x$HAVE_OSS" = x1])
+AM_CONDITIONAL([HAVE_SNDIO], [test "x$HAVE_SNDIO" = x1])
 AM_CONDITIONAL([HAVE_GSTREAMER], [test "x$HAVE_GSTREAMER" = x1])
 AM_CONDITIONAL([HAVE_NULL], [test "x$HAVE_NULL" = x1])
 AM_CONDITIONAL([BUILTIN_DSO], [test "x$BUILTIN_DSO" = x1])
 AM_CONDITIONAL([BUILTIN_PULSE], [test "x$BUILTIN_PULSE" = x1])
 AM_CONDITIONAL([BUILTIN_ALSA], [test "x$BUILTIN_ALSA" = x1])
 AM_CONDITIONAL([BUILTIN_OSS], [test "x$BUILTIN_OSS" = x1])
+AM_CONDITIONAL([BUILTIN_SNDIO], [test "x$BUILTIN_SNDIO" = x1])
 AM_CONDITIONAL([BUILTIN_GSTREAMER], [test "x$BUILTIN_GSTREAMER" = x1])
 AM_CONDITIONAL([BUILTIN_NULL], [test "x$BUILTIN_NULL" = x1])
 
@@ -604,6 +655,15 @@ if test "x$BUILTIN_OSS" = "x1" ; then
     ENABLE_BUILTIN_OSS=yes
 fi
 
+ENABLE_SNDIO=no
+if test "x$HAVE_SNDIO" = "x1" ; then
+    ENABLE_SNDIO=yes
+fi
+ENABLE_BUILTIN_SNDIO=no
+if test "x$BUILTIN_SNDIO" = "x1" ; then
+    ENABLE_BUILTIN_SNDIO=yes
+fi
+
 ENABLE_GSTREAMER=no
 if test "x$HAVE_GSTREAMER" = "x1" ; then
    ENABLE_GSTREAMER=yes
@@ -654,6 +714,8 @@ echo "
     Builtin ALSA:           ${ENABLE_BUILTIN_ALSA}
     Enable OSS:             ${ENABLE_OSS}
     Builtin OSS:            ${ENABLE_BUILTIN_OSS}
+    Enable SNDIO:           ${ENABLE_SNDIO}
+    Builtin SNDIO:          ${ENABLE_BUILTIN_SNDIO}
     Enable GStreamer:       ${ENABLE_GSTREAMER}
     Builtin GStreamer:      ${ENABLE_BUILTIN_GSTREAMER}
     Enable Null Output:     ${ENABLE_NULL}
