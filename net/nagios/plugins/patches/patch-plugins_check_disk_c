$OpenBSD: patch-plugins_check_disk_c,v 1.2 2006/07/19 06:24:00 sturm Exp $
--- plugins/check_disk.c.orig	Mon Mar 27 10:19:01 2006
+++ plugins/check_disk.c	Wed Jul 19 08:09:39 2006
@@ -230,7 +230,7 @@ main (int argc, char **argv)
     if (fsp.fsu_blocks && strcmp ("none", me->me_mountdir)) {
       usp = (double)(fsp.fsu_blocks - fsp.fsu_bavail) * 100 / fsp.fsu_blocks;
                         uisp = (double)(fsp.fsu_files - fsp.fsu_ffree) * 100 / fsp.fsu_files;
-      disk_result = check_disk (usp, fsp.fsu_bavail, uisp);
+      disk_result = check_disk (usp, fsp.fsu_bavail*fsp.fsu_blocksize/mult, uisp);
 
 
       result = max_state (disk_result, result);
@@ -462,6 +462,8 @@ process_arguments (int argc, char **argv
       se->c_df = c_df;
       se->w_dfp = w_dfp;
       se->c_dfp = c_dfp;
+      se->w_idfp = w_idfp;
+      se->c_idfp = c_idfp;
       se->found = 0;
       se->found_len = 0;
       *pathtail = se;
@@ -478,8 +480,10 @@ process_arguments (int argc, char **argv
                          */
                         se->w_df = 0;
                         se->c_df = 0;
-                        se->w_dfp = 0;
-                        se->c_dfp = 0;
+                        se->w_dfp = -1.0;
+                        se->c_dfp = -1.0;
+                        se->w_idfp = -1.0;
+                        se->c_idfp = -1.0;
       se->found = 0;
       se->found_len = 0;
       *dptail = se;
@@ -495,8 +499,10 @@ process_arguments (int argc, char **argv
                          */
                         se->w_df = 0;
                         se->c_df = 0;
-                        se->w_dfp = 0;
-                        se->c_dfp = 0;
+                        se->w_dfp = -1.0;
+                        se->c_dfp = -1.0;
+                        se->w_idfp = -1.0;
+                        se->c_idfp = -1.0;
       se->found = 0;
       se->found_len = 0;
       *fstail = se;
@@ -519,6 +525,8 @@ process_arguments (int argc, char **argv
       c_df = 0;
       w_dfp = -1.0;
       c_dfp = -1.0;
+      w_idfp = -1.0;
+      c_idfp = -1.0;
       break;
     case 'V':                 /* version */
       print_revision (progname, revision);
@@ -547,6 +555,8 @@ process_arguments (int argc, char **argv
     se->c_df = c_df;
     se->w_dfp = w_dfp;
     se->c_dfp = c_dfp;
+    se->w_idfp = w_idfp;
+    se->c_idfp = c_idfp;
     se->found =0;
     se->found_len = 0;
     *pathtail = se;
