$OpenBSD: patch-ltconfig,v 1.3 2001/02/20 21:38:54 danh Exp $
--- ltconfig.orig	Thu Sep 25 08:22:04 1997
+++ ltconfig	Tue Feb 20 16:28:56 2001
@@ -451,12 +451,13 @@ else
   esac
 fi
 
-case "$host_cpu" in
-rs6000 | powerpc | powerpcle)
-  # Yippee! All RS/6000 and PowerPC code is position-independent.
-  pic_flag=
-  ;;
-esac
+# Bogus
+#case "$host_cpu" in
+#rs6000 | powerpc | powerpcle)
+#  # Yippee! All RS/6000 and PowerPC code is position-independent.
+#  pic_flag=
+#  ;;
+#esac
 
 if test -n "$pic_flag"; then
   echo $ac_t "$pic_flag" 1>&6
@@ -575,6 +576,12 @@ hardcode_runpath_var=no
 hardcode_shlibpath_var=unsupported
 runpath_var=
 
+case "$host_os" in
+openbsd*)
+   with_gnu_ld=no
+   ;;
+esac
+
 ld_shlibs=yes
 if test "$with_gnu_ld" = yes; then
   # See if GNU ld supports shared libraries.
@@ -666,7 +673,7 @@ else
     hardcode_libdir_flag_spec='${wl}-rpath ${wl}$libdir'
     ;;
 
-  netbsd* | openbsd*)
+  netbsd*)
     # Tested with NetBSD 1.2 ld
     archive_cmds='$LD -Bshareable -o $lib$libobjs$deplibs'
     hardcode_libdir_flag_spec='-R$libdir'
@@ -674,6 +681,24 @@ else
     hardcode_shlibpath_var=no
     ;;
 
+   openbsd*)
+    hardcode_direct=yes
+    hardcode_shlibpath_var=no
+    case "$host_os" in
+      openbsd[01].* | openbsd2.[0-7] | openbsd2.[0-7].*)
+       archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linkopts'
+       hardcode_libdir_flag_spec='-R$libdir'
+      ;;
+      *)
+       archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $linkopts'
+       hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
+       if [ "`/usr/bin/file /usr/lib/libc.so.* | grep ELF`" != "" ]; then
+         export_dynamic_flag_spec='${wl}-E'
+       fi
+      ;;
+    esac
+    ;;
+
   osf3* | osf4*)
     allow_undefined_flag=' -expect_unresolved'
     archive_cmds='$LD -shared${allow_undefined_flag} -o $lib -soname $soname -set_version $verstring$libobjs -lc$deplibs'
@@ -827,6 +852,7 @@ netbsd* | openbsd*)
   library_names_spec='$libname.so.$versuffix'
   finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
   shlibpath_var=LD_LIBRARY_PATH
+  deplibs_check_method='pass_all'
   ;;
 
 osf3* | osf4*)
@@ -946,6 +972,9 @@ host="$host"
 
 # The archiver.
 AR='$AR'
+
+# The default C compiler.
+CC=$CC
 
 # The linker used to build libraries.
 LD='$LD'
