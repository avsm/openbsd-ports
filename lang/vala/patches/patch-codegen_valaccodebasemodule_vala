$OpenBSD: patch-codegen_valaccodebasemodule_vala,v 1.1 2011/04/05 18:40:44 ajacoutot Exp $

From 5d29984bff7d5c2ac32372470b8de439a477ecd4 Mon Sep 17 00:00:00 2001
From: JÃ¼rg Billeter <j@bitron.ch>
Date: Tue, 05 Apr 2011 17:23:00 +0000
Subject: codegen: Fix initializer lists for structs with array fields

--- codegen/valaccodebasemodule.vala.orig	Sat Apr  2 23:24:19 2011
+++ codegen/valaccodebasemodule.vala	Tue Apr  5 19:36:06 2011
@@ -2134,6 +2134,13 @@ public abstract class Vala.CCodeBaseModule : CodeGener
 					}
 
 					clist.append (cexpr);
+
+					var array_type = field.variable_type as ArrayType;
+					if (array_type != null && !field.no_array_length && !field.array_null_terminated) {
+						for (int dim = 1; dim <= array_type.rank; dim++) {
+							clist.append (get_array_length_cvalue (expr.target_value, dim));
+						}
+					}
 				}
 
 				set_cvalue (list, clist);
