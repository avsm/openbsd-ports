$OpenBSD: patch-sql_sql_parse_cc,v 1.7 2010/12/26 08:23:17 ajacoutot Exp $
--- sql/sql_parse.cc.orig	Mon Nov 29 05:37:59 2010
+++ sql/sql_parse.cc	Tue Dec 14 20:37:51 2010
@@ -1001,19 +1001,6 @@ bool dispatch_command(enum enum_server_command command
   thd->enable_slow_log= TRUE;
   thd->lex->sql_command= SQLCOM_END; /* to avoid confusing VIEW detectors */
   thd->set_time();
-  if (!thd->is_valid_time())
-  {
-    /*
-     If the time has got past 2038 we need to shut this server down
-     We do this by making sure every command is a shutdown and we 
-     have enough privileges to shut the server down
-
-     TODO: remove this when we have full 64 bit my_time_t support
-    */
-    thd->security_ctx->master_access|= SHUTDOWN_ACL;
-    command= COM_SHUTDOWN;
-  }
-
   VOID(pthread_mutex_lock(&LOCK_thread_count));
   thd->query_id= global_query_id;
 
@@ -1517,11 +1504,8 @@ bool dispatch_command(enum enum_server_command command
       SHUTDOWN_DEFAULT is 0. If client is >= 4.1.3, the shutdown level is in
       packet[0].
     */
-    enum mysql_enum_shutdown_level level;
-    if (!thd->is_valid_time())
-      level= SHUTDOWN_DEFAULT;
-    else
-      level= (enum mysql_enum_shutdown_level) (uchar) packet[0];
+    enum mysql_enum_shutdown_level level=
+      (enum mysql_enum_shutdown_level) (uchar) packet[0];
     if (level == SHUTDOWN_DEFAULT)
       level= SHUTDOWN_WAIT_ALL_BUFFERS; // soon default will be configurable
     else if (level != SHUTDOWN_WAIT_ALL_BUFFERS)
