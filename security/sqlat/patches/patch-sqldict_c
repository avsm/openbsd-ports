$OpenBSD: patch-sqldict_c,v 1.3 2003/06/03 01:26:50 margarida Exp $
--- sqldict.c.orig	Mon Dec  3 19:51:11 2001
+++ sqldict.c	Tue Jun  3 01:44:05 2003
@@ -21,7 +21,6 @@
 #include "sqldict.h"
 #include "constants.h"
 #include "util.h"
-#include <getopt.h>
 
 /*
   Set a few default values
@@ -73,7 +72,9 @@ void initArguments(ARGS *pArgs) {
 int doHack(const ARGS *pArgs) {
   
   TDSLOGIN *login;
-  TDSSOCKET *tds;  
+  TDSSOCKET *tds;
+  TDSCONTEXT *context = NULL;
+  TDSCONNECTINFO *connect_info;
   char user[64];
   char pass[64];
   char ip[16];
@@ -100,8 +101,12 @@ int doHack(const ARGS *pArgs) {
 	tds_set_server(login, ip);
 	tds_set_passwd(login, pass);
         tds_set_user(login, user);
-      
-	if( (tds = tds_connect(login)) !=NULL ) {
+     
+	context = tds_alloc_context();
+	tds = tds_alloc_socket(context, 512);
+	tds_set_parent(tds, NULL);
+	connect_info = tds_read_config_info(NULL, login, context->locale);
+	if (!connect_info || tds_connect(tds, connect_info) != TDS_FAIL) {
 	  fprintf(stdout, "IP: %-15s User: %-14s Pass: %-14s\n", 
 		  ip, user, pass);
 	  
