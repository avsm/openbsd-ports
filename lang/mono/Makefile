# $OpenBSD: Makefile,v 1.4 2008/10/16 21:47:10 jasper Exp $

ONLY_FOR_ARCHS=	amd64 i386

COMMENT=	cross platform, open source .NET developement framework

DISTNAME=	mono-2.0
PKGNAME=	${DISTNAME}p0
CATEGORIES=	lang devel
SHARED_LIBS=	mono-profiler-aot	0.0 \
		mono-profiler-cov	0.0 \
		mono			0.0

HOMEPAGE=	http://www.mono-project.com/

MAINTAINER=	Aleksander Piotrowski <alek@openbsd.org>

# GPLv2, LGPL, MIT X11, MPL
PERMIT_PACKAGE_FTP=	Yes
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes

WANTLIB=	c glib-2.0 gmodule-2.0 gthread-2.0 intl \
		m pcre pthread z

MASTER_SITES=	ftp://ftp.novell.com/pub/mono/sources/mono/
EXTRACT_SUFX=	.tar.bz2

USE_LIBTOOL=	Yes
USE_GMAKE=	Yes

MODULES=	converters/libiconv lang/mono
BUILD_DEPENDS=	:bison-*:devel/bison \
		${RUN_DEPENDS}
RUN_DEPENDS=	::x11/libgdiplus
LIB_DEPENDS=	gc::devel/boehm-gc


CONFIGURE_STYLE=gnu
CONFIGURE_ENV=	LDFLAGS="-L${LOCALBASE}/lib" \
		CPPFLAGS="${CFLAGS} -I${LOCALBASE}/include" \
		CFLAGS="${CFLAGS} -I${LOCALBASE}/include"
CONFIGURE_ARGS=	--with-gc=boehm --with-glib=system --with-tls=pthread \
		--with-jit=yes --with-interp=no --with-sigaltstack=no \
		--with-libgdiplus=installed

REGRESS_TARGET=check

DLLMAP_FILES=	mcs/class/Managed.Windows.Forms/System.Windows.Forms/MimeIcon.cs \
		mcs/tools/mono-shlib-cop/mono-shlib-cop.exe.config

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/mono
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/mono/net_1_1
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/mono/net_2_0

	${INSTALL_DATA} ${WRKSRC}/data/config \
		${WRKSRC}/data/browscap.ini \
		${PREFIX}/share/examples/mono/

	${INSTALL_DATA} ${WRKSRC}/data/net_1_1/DefaultWsdlHelpGenerator.aspx \
		${WRKSRC}/data/net_1_1/machine.config \
		${PREFIX}/share/examples/mono/net_1_1/

	${INSTALL_DATA} ${WRKSRC}/data/net_2_0/DefaultWsdlHelpGenerator.aspx \
		${WRKSRC}/data/net_2_0/machine.config \
		${PREFIX}/share/examples/mono/net_2_0/

.include <bsd.port.mk>
