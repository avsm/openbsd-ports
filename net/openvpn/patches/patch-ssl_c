$OpenBSD: patch-ssl_c,v 1.1 2009/03/08 15:56:52 martin Exp $
--- ssl.c.orig	Fri Mar  6 13:38:02 2009
+++ ssl.c	Fri Mar  6 13:46:09 2009
@@ -3398,14 +3398,17 @@ key_method_2_read (struct buffer *buf, struct tls_mult
 	    
 	  if ((session->opt->ssl_flags & SSLF_USERNAME_AS_COMMON_NAME))
 	    set_common_name (session, up->username);
-	  msg (D_HANDSHAKE, "TLS: Username/Password authentication %s for username '%s' %s",
 #ifdef ENABLE_DEF_AUTH
-	       ks->auth_deferred ? "deferred" : "succeeded",
+	  msg (D_HANDSHAKE,
+	    "TLS: Username/Password authentication %s for username '%s' %s",
+	    ks->auth_deferred ? "deferred" : "succeeded", up->username,
+	    (session->opt->ssl_flags & SSLF_USERNAME_AS_COMMON_NAME) ? "[CN SET]" : "");
 #else
-	       "succeeded",
+	  msg (D_HANDSHAKE,
+	    "TLS: Username/Password authentication %s for username '%s' %s",
+	    "succeeded", up->username,
+	    (session->opt->ssl_flags & SSLF_USERNAME_AS_COMMON_NAME) ? "[CN SET]" : "");
 #endif
-	       up->username,
-	       (session->opt->ssl_flags & SSLF_USERNAME_AS_COMMON_NAME) ? "[CN SET]" : "");
 	}
       else
 	{
