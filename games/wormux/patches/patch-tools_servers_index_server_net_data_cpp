$OpenBSD: patch-tools_servers_index_server_net_data_cpp,v 1.2 2010/03/21 12:19:00 landry Exp $
We don't #define MSG_NOSIGNAL
--- tools/servers/index_server/net_data.cpp.orig	Tue Jan 26 20:55:28 2010
+++ tools/servers/index_server/net_data.cpp	Wed Jan 27 21:58:09 2010
@@ -248,7 +248,7 @@ bool NetData::SendInt(const int &nbr)
   unsigned int u_nbr = *((unsigned int*)&nbr);
   packet = htonl(u_nbr);
 
-  if ( send(fd, &packet, sizeof(packet), MSG_NOSIGNAL) != sizeof(packet) ) {
+  if ( send(fd, &packet, sizeof(packet), 0) != sizeof(packet) ) {
     PRINT_ERROR;
     return false;
   }
@@ -263,7 +263,7 @@ bool NetData::SendStr(const std::string &full_str)
   if (!SendInt((int)full_str.size()))
     return false;
 
-  if ( send(fd, full_str.c_str(), full_str.size(), MSG_NOSIGNAL) != ssize_t(full_str.size()) ) {
+  if ( send(fd, full_str.c_str(), full_str.size(), 0) != ssize_t(full_str.size()) ) {
     PRINT_ERROR;
     return false;
   }
