$OpenBSD: patch-src_global_bounce_c,v 1.1 2004/06/11 07:47:31 brad Exp $
--- src/global/bounce.c.orig	2003-09-20 17:39:39.000000000 -0400
+++ src/global/bounce.c	2004-06-10 00:13:49.000000000 -0400
@@ -257,10 +257,11 @@ int     vbounce_append(int flags, const 
 			     ATTR_TYPE_STR, MAIL_ATTR_WHY, vstring_str(why),
 				ATTR_TYPE_END) == 0
 	    && ((flags & DEL_REQ_FLAG_RECORD) == 0
-		|| vtrace_append(flags, id, orig_rcpt, recipient, relay,
-			      entry, dsn_code, dsn_action, fmt, ap) == 0)) {
-	    vlog_adhoc(id, orig_rcpt, recipient, relay,
-		       entry, log_status, fmt, ap);
+		|| trace_append(flags, id, orig_rcpt, recipient, relay,
+				entry, dsn_code, dsn_action,
+				"%s", vstring_str(why)) == 0)) {
+	    log_adhoc(id, orig_rcpt, recipient, relay,
+		      entry, log_status, "%s", vstring_str(why));
 	    status = (var_soft_bounce ? -1 : 0);
 	} else if ((flags & BOUNCE_FLAG_CLEAN) == 0) {
 	    status = defer_append(flags, id, orig_rcpt, recipient, offset,
@@ -384,10 +385,11 @@ int     vbounce_one(int flags, const cha
 			     ATTR_TYPE_STR, MAIL_ATTR_WHY, vstring_str(why),
 				ATTR_TYPE_END) == 0
 	    && ((flags & DEL_REQ_FLAG_RECORD) == 0
-		|| vtrace_append(flags, id, orig_rcpt, recipient, relay,
-				 entry, "5.0.0", "failed", fmt, ap) == 0)) {
-	    vlog_adhoc(id, orig_rcpt, recipient, relay,
-		       entry, "bounced", fmt, ap);
+		|| trace_append(flags, id, orig_rcpt, recipient, relay,
+				entry, "5.0.0", "failed",
+				 "%s", vstring_str(why)) == 0)) {
+	    log_adhoc(id, orig_rcpt, recipient, relay,
+		       entry, "bounced", "%s", vstring_str(why));
 	    status = 0;
 	} else if ((flags & BOUNCE_FLAG_CLEAN) == 0) {
 	    status = defer_append(flags, id, orig_rcpt, recipient, offset,
