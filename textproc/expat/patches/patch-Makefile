--- Makefile.orig	Tue May  9 23:21:56 2000
+++ Makefile	Thu Dec 14 10:47:28 2000
@@ -13,25 +13,36 @@
 LIBOBJS=xmltok/xmltok.o \
   xmltok/xmlrole.o \
   xmlparse/xmlparse.o
+SHLIBOBJS=$(LIBOBJS:.o=.so)
 
 OBJS=xmlwf/xmlwf.o \
   xmlwf/xmlfile.o \
   xmlwf/codepage.o \
   $(FILEMAP_OBJ)
-LIB=xmlparse/libexpat.a
+LIB=libexpat.a
 EXE=
 XMLWF=xmlwf/xmlwf$(EXE)
 
-all: $(XMLWF)
+PICFLAG= -fpic
 
+.if defined(NO_SHARED_LIBS) && ${NO_SHARED_LIBS:L} == "yes"
+all: $(XMLWF)
 $(XMLWF): $(OBJS) $(LIB)
-	$(CC) $(CFLAGS) -o $@ $(OBJS) $(LIB)
+.else
+all: $(XMLWF) $(SHLIB)
+$(XMLWF): $(OBJS) $(LIB) $(SHLIB)
+.endif
+	$(CC) $(CFLAGS) -o $@ $(OBJS) -L. -lexpat
 
 $(LIB): $(LIBOBJS)
 	$(AR) rc $(LIB) $(LIBOBJS)
+	@ranlib $(LIB)
+
+$(SHLIB): $(SHLIBOBJS)
+	$(CC) -shared $(PICFLAG) -o $(SHLIB) $(SHLIBOBJS)
 
 clean:
-	rm -f $(OBJS) $(LIBOBJS) $(LIB) $(XMLWF)
+	rm -f $(OBJS) $(LIBOBJS) $(LIB) $(SHLIB) $(XMLWF)
 
 xmltok/nametab.h: gennmtab/gennmtab$(EXE)
 	rm -f $@
@@ -42,5 +53,10 @@
 
 xmltok/xmltok.o: xmltok/nametab.h
 
+.SUFFIXES: .o .so
+
 .c.o:
 	$(CC) $(CFLAGS) -c -o $@ $<
+
+.c.so:
+	$(CC) $(CFLAGS) $(PICFLAG) -DPIC -c -o $@ $<
