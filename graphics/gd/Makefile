# $OpenBSD: Makefile,v 1.17 2000/06/22 03:48:45 brad Exp $
# $FreeBSD: Makefile,v 1.5 1998/06/25 03:13:16 vanilla Exp $

DISTNAME=	gd-1.8.3
CATEGORIES=	graphics
NEED_VERSION=	1.301
MASTER_SITES=	http://www.boutell.com/gd/http/ \
		ftp://ftp.boutell.com/pub/boutell/gd/

HOMEPAGE=	http://www.boutell.com/gd/

LIB_DEPENDS=	jpeg.62::graphics/jpeg \
		png.1.6::graphics/png
.if !defined(FLAVOR)
LIB_DEPENDS+=	ttf.1.3::print/freetype
.endif

MAINTAINER=	brad@openbsd.org

PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

MAKE_FLAGS=	COMPILER="${CC}"

FLAVORS=	no_x11

.if defined(FLAVOR) && ${FLAVOR:L} == "no_x11"
MAKE_FLAGS+=	CFLAGS="${CFLAGS} -DHAVE_JPEG" \
		LIBS="-lm -lgd -lpng -ljpeg -lz" \
		INCLUDEDIRS="-I. -I/usr/local/include" \
		LIBDIRS="-L. -L/usr/local/lib"
.else
MAKE_FLAGS+=	CFLAGS="${CFLAGS} -DHAVE_XPM -DHAVE_JPEG -DHAVE_LIBTTF" \
		LIBS="-lm -lgd -lpng -lz -ljpeg -lttf -lXpm -lX11" \
		INCLUDEDIRS="-I. -I/usr/local/include -I/usr/X11R6/include -I/usr/X11R6/include/X11" \
		LIBDIRS="-L. -L/usr/local/lib -L/usr/X11R6/lib"
.endif

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/gd
	${INSTALL_DATA} ${WRKSRC}/demoin.png ${PREFIX}/share/examples/gd
	${INSTALL_DATA} ${WRKSRC}/demoout.png ${PREFIX}/share/examples/gd
	${INSTALL_DATA} ${WRKSRC}/index.html ${PREFIX}/share/examples/gd

.include <bsd.port.mk>

.if defined(NO_SHARED_LIBS) && ${NO_SHARED_LIBS:U} == YES
MAKE_ENV=	NO_SHARED_LIBS=	Yes
.endif
