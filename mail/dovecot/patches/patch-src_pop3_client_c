$OpenBSD: patch-src_pop3_client_c,v 1.5 2008/05/22 07:55:08 sthen Exp $
--- src/pop3/client.c.orig	Sun May 18 22:37:55 2008
+++ src/pop3/client.c	Sun May 18 22:38:38 2008
@@ -231,11 +231,20 @@ static const char *client_stats(struct client *client)
 	return str_c(str);
 }
 
+static const char *client_get_disconnect_reason(struct client *client)
+{
+	errno = client->input->stream_errno != 0 ?
+		client->input->stream_errno :
+		client->output->stream_errno;
+	return errno == 0 || errno == EPIPE ? "Connection closed" :
+		t_strdup_printf("Connection closed: %m");
+}
+
 void client_destroy(struct client *client, const char *reason)
 {
 	if (!client->disconnected) {
 		if (reason == NULL)
-			reason = "Disconnected";
+			reason = client_get_disconnect_reason(client);
 		i_info("%s %s", reason, client_stats(client));
 	}
 
