# $OpenBSD: Makefile,v 1.9 2006/02/21 09:49:02 espie Exp $

COMMENT='e-donkey client'
CATEGORIES=net

MAINTAINER=Marc Espie <espie@openbsd.org>

# GPL
PERMIT_PACKAGE_FTP=	Yes
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
WANTLIB=		X11 Xext Xi c glib gmodule iconv intl m z pthread \
			freetype png jpeg charset
CONFIGURE_STYLE=	autoconf no-autoheader
AUTOCONF_DIR=		${WRKSRC}/config
AUTOCONF_VERSION=	2.59
#CONFIGURE_ARGS+=	--enable-ocamlver=3.07
MODGNU_CONFIG_GUESS_DIRS=${WRKSRC}/config

HOMEPAGE=http://savannah.nongnu.org/projects/mldonkey/

MASTER_SITES=http://savannah.nongnu.org/download/mldonkey/
DISTNAME=mldonkey-2.6.3
PKGNAME=${DISTNAME}p1
EXTRACT_SUFX=.tar.bz2

CONFIGURE_ARGS+=--enable-gui=newgui1
CONFIGURE_ENV+=CPPFLAGS='-I${LOCALBASE}/include -I${X11BASE}/include'
CONFIGURE_ENV+=LDFLAGS='-L${LOCALBASE}/lib -L${X11BASE}/lib'

USE_GMAKE=Yes
MODULES=lang/ocaml
BUILD_DEPENDS=::x11/lablgtk
LIB_DEPENDS=gdk.1,gtk.1::x11/gtk+ \
		bz2::archivers/bzip2 \
		gd::graphics/gd
FAKE_FLAGS=prefix=${DESTDIR}${PREFIX} MODOCAML_NATIVE=${MODOCAML_NATIVE}
NO_REGRESS=Yes

post-install:
	mkdir -p ${PREFIX}/share/mldonkey
	cp -R ${WRKDIST}/distrib ${PREFIX}/share/mldonkey
	@${strip_binaries}

.include <bsd.port.mk>

.if ${MODOCAML_NATIVE:L} == "yes"
strip_binaries=cd ${PREFIX}/bin && strip mlnet mlgui mlnet+gui mlim
.else
strip_binaries=:
.endif
