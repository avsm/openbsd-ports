$OpenBSD: patch-get_iplayer,v 1.38 2010/06/01 15:05:39 sthen Exp $
--- get_iplayer.orig	Fri May 28 15:24:50 2010
+++ get_iplayer	Tue Jun  1 16:03:59 2010
@@ -294,6 +294,7 @@ $opt->{verbose} = 1 if $opt_pre->{verbose};
 $opt->{quiet} = 1 if $opt_pre->{quiet};
 $opt->{pvr} = 1 if $opt_pre->{pvr};
 $opt->{stdout} = 1 if $opt_pre->{stdout} || $opt_pre->{stream};
+$opt->{packagemanager}= 'pkg_add';
 
 # show version and exit
 if ( $opt_pre->{showver} ) {
@@ -330,7 +331,7 @@ mkpath $profile_dir if ! -d $profile_dir;
 
 
 # get list of additional user plugins and load plugin
-my $plugin_dir_system = '/usr/share/get_iplayer/plugins';
+my $plugin_dir_system = '${TRUEPREFIX}/share/get_iplayer/plugins';
 my $plugin_dir_user = "$profile_dir/plugins";
 for my $plugin_dir ( ( $plugin_dir_user, $plugin_dir_system ) ) {
 	if ( opendir( DIR, $plugin_dir ) ) {
@@ -658,7 +659,7 @@ sub init_search {
 	delete $binopts->{vlc};
 	push @{ $binopts->{vlc} }, '-vv' if $opt->{debug};
 
-	$bin->{id3v2}		= $opt->{id3v2} || 'id3v2';
+	$bin->{id3v2}		= $opt->{id3v2} || 'id3tag';
 	$bin->{atomicparsley}	= $opt->{atomicparsley} || 'AtomicParsley';
 
 	$bin->{tee}		= 'tee';
@@ -1986,7 +1987,7 @@ sub update_script {
 		} elsif ( $opt->{packagemanager} =~ /disable/i ) {
 			logger "ERROR: get_iplayer should only be updated using your local package management system, for more information see http://linuxcentre.net/installation\n";
 		} else {
-			logger "ERROR: get_iplayer was installed using '$opt->{packagemanager}' package manager please refer to the update documentation at http://linuxcentre.net/getiplayer/installation/\n";
+			logger "ERROR: Please update get_iplayer using the '$opt->{packagemanager}' package manager\n";
 		}
 		exit 1;
 	} 
@@ -4251,7 +4252,7 @@ sub tag_file {
 		my ( $id3_name, $id3_episode, $id3_desc, $id3_channel ) = ( $prog->{name}, $prog->{episode}, $prog->{desc}, $prog->{channel} );
 		s|"|\\"|g for ($id3_name, $id3_episode, $id3_desc, $id3_channel);
 		# Only tag if the required tool exists
-		if ( main::exists_in_path('id3v2') ) {
+		if ( main::exists_in_path('id3tag') ) {
 			main::logger "INFO: id3 tagging $prog->{ext} file\n";
 			my @cmd = (
 				$bin->{id3v2}, 
@@ -5860,7 +5861,7 @@ sub get_stream_data_cdn {
 
 				if ( $cattribs->{authString} !~ /&slist=/ ) {
 					$cattribs->{identifier} =~ s/^mp[34]://;
-					$cattribs->{authString} .= "&slist=&cattribs->{identifier}";
+					$cattribs->{authString} .= "&slist=$cattribs->{identifier}";
 				}
 
 				### ??? live and Live TV, Live EMP Video or Non-public EMP video:
