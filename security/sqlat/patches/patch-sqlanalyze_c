$OpenBSD: patch-sqlanalyze_c,v 1.3 2003/06/03 01:26:50 margarida Exp $
--- sqlanalyze.c.orig	Mon Dec  3 18:08:30 2001
+++ sqlanalyze.c	Tue Jun  3 01:51:57 2003
@@ -23,7 +23,6 @@
 #include "constants.h"
 #include "sqlanlz.h"
 #include "html.h"
-#include <getopt.h>
 
 /*
   Set a few default values
@@ -52,12 +51,17 @@ void doHaxxor(TDSLOGIN *pLogin) {
   EXTENDEDSP *pExtendedSP = NULL;
   SQLTABLE *pTable = NULL;
   TDSSOCKET *pTds = NULL;
+  TDSCONTEXT *context = NULL;
+  TDSCONNECTINFO *connect_info;
   char tmp[256];
   time_t t;
 
   /* connect to the SQL server */
-  if( (pTds = tds_connect(pLogin)) !=NULL ) {
-
+  context = tds_alloc_context();
+  pTds = tds_alloc_socket(context, 512);
+  tds_set_parent(pTds, NULL);
+  connect_info = tds_read_config_info(NULL, pLogin, context->locale);
+  if (!connect_info || tds_connect(pTds, connect_info) != TDS_FAIL) {
     time(&t);
 
     htmlHead(stdout, "SQLServer PenTest");
