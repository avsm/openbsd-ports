$OpenBSD: patch-libavcodec_Makefile,v 1.19 2011/03/29 20:01:43 edd Exp $
--- libavcodec/Makefile.orig	Sun Mar  6 23:03:48 2011
+++ libavcodec/Makefile	Mon Mar  7 00:17:28 2011
@@ -667,6 +667,25 @@ CLEANFILES = sin_tables.c cos_tables.c *_tables.h *_ta
 
 include $(SUBDIR)../subdir.mak
 
+ifdef ARCH_X86_32
+ifeq (,$(findstring -O,$(CFLAGS)))
+libavcodec/x86/cavsdsp_mmx.o: CFLAGS += -O
+libavcodec/x86/dsputil_mmx.o: CFLAGS += -O
+libavcodec/x86/mpegvideo_mmx.o: CFLAGS += -O
+libavcodec/x86/snowdsp_mmx.o: CFLAGS += -O
+libavcodec/x86/vc1dsp_mmx.o: CFLAGS += -O
+libavcodec/x86/vp3dsp_mmx.o: CFLAGS += -O
+libavcodec/x86/mpegaudiodec_mmx.o: CFLAGS += -O
+endif
+libavcodec/x86/cavsdsp_mmx.o: CFLAGS += -fomit-frame-pointer
+libavcodec/x86/dsputil_mmx.o: CFLAGS += -fomit-frame-pointer
+libavcodec/x86/mpegvideo_mmx.o: CFLAGS += -fomit-frame-pointer
+libavcodec/x86/snowdsp_mmx.o: CFLAGS += -fomit-frame-pointer
+libavcodec/x86/vc1dsp_mmx.o: CFLAGS += -fomit-frame-pointer
+libavcodec/x86/vp3dsp_mmx.o: CFLAGS += -fomit-frame-pointer
+libavcodec/x86/mpegaudiodec_mmx.o: CFLAGS += -fomit-frame-pointer
+endif
+
 $(SUBDIR)dct-test$(EXESUF): $(SUBDIR)dctref.o
 
 $(SUBDIR)cos_tables.c: $(SUBDIR)costablegen$(HOSTEXESUF)
