$OpenBSD: patch-panel-plugin_battmon_c,v 1.2 2005/11/10 22:57:39 jolan Exp $
--- panel-plugin/battmon.c.orig	Sat Aug  6 04:30:51 2005
+++ panel-plugin/battmon.c	Thu Nov 10 15:39:52 2005
@@ -35,8 +35,9 @@
 #ifdef __FreeBSD__
 #include <machine/apm_bios.h>
 #elif __OpenBSD__
-#include <sys/param.h>
+#include <sys/ioctl.h>
 #include <machine/apmvar.h>
+#define APMDEVICE "/dev/apm"
 #elif __linux__
 #include <apm.h>
 #endif
@@ -272,11 +273,14 @@ update_apm_status(t_battmon *battmon)
   	battmon->method = BM_BROKEN;
   	fd = open(APMDEVICE, O_RDONLY);
   	if (fd == -1) return TRUE;
-  	if (ioctl(fd, APM_IOC_GETPOWER, &apminfo) == -1)
+  	if (ioctl(fd, APM_IOC_GETPOWER, &apm) == -1)
     		return TRUE;
   	close(fd);
   	charge = apm.battery_life;
   	time_remaining = apm.minutes_left;
+	if ((time_remaining / 60) > 99)
+	    time_remaining = 0;
+
   	acline = apm.ac_state ? TRUE : FALSE;
 	
 #else
@@ -415,8 +419,7 @@ battmon.c:241: for each function it appe
 		     g_snprintf(buffer, sizeof(buffer), _("AC off-line"));
 	}
 	add_tooltip(battmon->ebox, buffer);
-
-	if(battmon->options.display_power){
+	if(0) {
 	  gtk_widget_show((GtkWidget *)battmon->acfan);
 	  gtk_widget_show((GtkWidget *)battmon->temp);
 	  fan=get_fan_status();
@@ -1214,10 +1217,6 @@ battmon_create_options(Control *ctrl, Gt
 	gtk_widget_show(dialog->cb_disp_tooltip_time);
 	gtk_box_pack_start(GTK_BOX(vbox2), dialog->cb_disp_tooltip_time, FALSE, FALSE, 0);
 	
-	dialog->cb_disp_power = gtk_check_button_new_with_mnemonic(_("Display power"));
-	gtk_widget_show(dialog->cb_disp_power);
-	gtk_box_pack_start(GTK_BOX(vbox2), dialog->cb_disp_power, FALSE, FALSE, 0);
-
 	dialog->cb_disp_icon = gtk_check_button_new_with_mnemonic(_("Display icon"));
 	gtk_widget_show(dialog->cb_disp_icon);
 	gtk_box_pack_start(GTK_BOX(vbox2), dialog->cb_disp_icon, FALSE, FALSE, 0);
