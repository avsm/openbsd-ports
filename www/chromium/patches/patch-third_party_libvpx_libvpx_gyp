$OpenBSD: patch-third_party_libvpx_libvpx_gyp,v 1.4 2011/09/19 08:55:26 robert Exp $
--- third_party/libvpx/libvpx.gyp.orig	Fri Sep 16 18:27:55 2011
+++ third_party/libvpx/libvpx.gyp	Sat Sep 17 13:09:02 2011
@@ -4,7 +4,7 @@
 {
   'variables': {
     'conditions': [
-      ['OS=="mac" or OS=="linux"', {
+      ['OS=="mac" or OS=="linux" or OS=="openbsd"', {
         'asm_obj_extension': 'o',
       }],
       ['OS=="win"', {
@@ -13,7 +13,7 @@
     ],
   },
   'conditions': [
-    [ '(OS=="linux" or OS=="mac" or OS=="win") and target_arch!="arm" and target_arch!="arm-neon"', {
+    [ '(OS=="linux" or OS=="mac" or OS=="win" or OS=="openbsd") and target_arch!="arm" and target_arch!="arm-neon"', {
       'targets': [
         {
           # This libvpx target contains both encoder and decoder.
@@ -23,8 +23,24 @@
           'variables': {
             'shared_generated_dir':
               '<(SHARED_INTERMEDIATE_DIR)/third_party/libvpx',
-            'yasm_path': '<(PRODUCT_DIR)/yasm',
+            'yasm_path': '/usr/local/bin/yasm',
             'conditions': [
+              [ 'OS=="openbsd" and target_arch=="ia32"', {
+                'yasm_flags': [
+                  '-felf32',
+                  '-m', 'x86',
+                  '-I', 'source/config/linux/ia32',
+                  '-I', 'source/libvpx',
+                ],
+              }],
+              [ 'OS=="openbsd" and target_arch=="x64"', {
+                'yasm_flags': [
+                  '-felf64',
+                  '-m', 'amd64',
+                  '-I', 'source/config/linux/x64',
+                  '-I', 'source/libvpx',
+                ],
+              }],
               [ 'OS=="linux" and target_arch=="ia32"', {
                 'yasm_flags': [
                   '-felf32',
@@ -61,10 +77,9 @@
             ],
           },
           'dependencies': [
-            '../yasm/yasm.gyp:yasm#host',
           ],
           'include_dirs': [
-            'source/config/<(OS)/<(target_arch)',
+            'source/config/linux/<(target_arch)',
             'source/libvpx',
             'source/libvpx/vp8/common',
             'source/libvpx/vp8/decoder',
@@ -225,7 +240,7 @@
             'source/libvpx/vp8/encoder/x86/sad_mmx.asm',
             'source/libvpx/vp8/encoder/x86/variance_impl_mmx.asm',
             # Generated by ./source/configure and checked in.
-            'source/config/<(OS)/<(target_arch)/vpx_config.c',
+            'source/config/linux/<(target_arch)/vpx_config.c',
           ]
         }
       ]
@@ -245,6 +260,16 @@
       'conditions': [
         # This section specifies the folder for looking for libvpx.a.
         #
+        ['OS=="openbsd" and target_arch=="ia32"', {
+          'variables': {
+            'libvpx_path': 'lib/linux/ia32',
+          },
+        }],
+        ['OS=="openbsd" and target_arch=="x64"', {
+          'variables': {
+            'libvpx_path': 'lib/linux/x64',
+          },
+        }],
         ['OS=="linux" and target_arch=="ia32"', {
           'variables': {
             'libvpx_path': 'lib/linux/ia32',
