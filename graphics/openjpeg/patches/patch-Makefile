$OpenBSD: patch-Makefile,v 1.1.1.1 2007/02/08 00:29:22 todd Exp $
--- Makefile.orig	Wed Feb  1 15:25:11 2006
+++ Makefile	Mon Jan  8 18:26:27 2007
@@ -1,7 +1,7 @@
 # Linux makefile for OpenJPEG
 
-VER_MAJOR = 1
-VER_MINOR = 0.0
+VER_MAJOR ?= 1
+VER_MINOR ?= 0.0
 
 SRCS = ./libopenjpeg/bio.c ./libopenjpeg/cio.c ./libopenjpeg/dwt.c ./libopenjpeg/event.c ./libopenjpeg/image.c ./libopenjpeg/j2k.c ./libopenjpeg/j2k_lib.c ./libopenjpeg/jp2.c ./libopenjpeg/jpt.c ./libopenjpeg/mct.c ./libopenjpeg/mqc.c ./libopenjpeg/openjpeg.c ./libopenjpeg/pi.c ./libopenjpeg/raw.c ./libopenjpeg/t1.c ./libopenjpeg/t2.c ./libopenjpeg/tcd.c ./libopenjpeg/tgt.c
 INCLS = ./libopenjpeg/bio.h ./libopenjpeg/cio.h ./libopenjpeg/dwt.h ./libopenjpeg/event.h ./libopenjpeg/fix.h ./libopenjpeg/image.h ./libopenjpeg/int.h ./libopenjpeg/j2k.h ./libopenjpeg/j2k_lib.h ./libopenjpeg/jp2.h ./libopenjpeg/jpt.h ./libopenjpeg/mct.h ./libopenjpeg/mqc.h ./libopenjpeg/openjpeg.h ./libopenjpeg/pi.h ./libopenjpeg/raw.h ./libopenjpeg/t1.h ./libopenjpeg/t2.h ./libopenjpeg/tcd.h ./libopenjpeg/tgt.h ./libopenjpeg/opj_includes.h
@@ -11,7 +11,7 @@ INCLUDE = -Ilibopenjpeg
 CC = gcc
 AR = ar
 
-INSTALLDIR = /usr/lib
+INSTALLDIR = ${PREFIX}/lib
 
 # Converts cr/lf to just lf
 DOS2UNIX = dos2unix
@@ -24,7 +24,7 @@ CFLAGS = $(COMPILERFLAGS) $(INCLUDE)
 
 TARGET  = openjpeg
 STATICLIB = lib$(TARGET).a
-SHAREDLIB = lib$(TARGET)-$(VER_MAJOR).$(VER_MINOR).so
+SHAREDLIB = lib$(TARGET).so.$(LIBopenjpeg_VERSION)
 LIBNAME = lib$(TARGET).so.$(VER_MAJOR)
 
 
@@ -34,9 +34,9 @@ default: all
 all: dist
 
 dist: OpenJPEG
-	mkdir dist
+	mkdir -p dist
 	cp *.a dist/
-	cp *.so dist/
+	cp *.so.* dist/
 	cp libopenjpeg/openjpeg.h dist/
 
 dos2unix:
@@ -51,13 +51,12 @@ $(STATICLIB): $(MODULES)
 	$(AR) r $@ $(MODULES)
 
 $(SHAREDLIB): $(MODULES)
-	$(CC) -s -shared -Wl,-soname,$(LIBNAME) -o $@ $(MODULES) $(LIBRARIES)
+	$(CC) -s -shared -o $@ $(MODULES) $(LIBRARIES)
 
 install:
-	install -m 644 -o root -g root $(STATICLIB) $(INSTALLDIR)
-	install -m 755 -o root -g root $(SHAREDLIB) $(INSTALLDIR)
-	ln -sf $(SHAREDLIB) $(INSTALLDIR)/$(LIBNAME)
-	ldconfig
+	${BSD_INSTALL_DATA} $(STATICLIB) $(INSTALLDIR)
+	${BSD_INSTALL_DATA} $(SHAREDLIB) $(INSTALLDIR)
+	${BSD_INSTALL_DATA} dist/openjpeg.h ${PREFIX}/include
 
 clean:
 	rm -rf core dist/ u2dtmp* $(MODULES) $(STATICLIB) $(SHAREDLIB) $(LIBNAME)
