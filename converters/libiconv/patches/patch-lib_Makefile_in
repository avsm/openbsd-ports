$OpenBSD: patch-lib_Makefile_in,v 1.9 2005/12/24 16:11:52 espie Exp $
--- lib/Makefile.in.orig	Sun May 18 16:19:16 2003
+++ lib/Makefile.in	Sat Dec 24 17:04:04 2005
@@ -26,7 +26,7 @@ LIBTOOL_COMPILE = $(LIBTOOL) --mode=comp
 LIBTOOL_LINK = $(LIBTOOL) --mode=link
 LIBTOOL_INSTALL = $(LIBTOOL) --mode=install
 LIBTOOL_UNINSTALL = $(LIBTOOL) --mode=uninstall
-CP = cp
+CP = @CP@
 MV = mv
 LN = @LN@
 LN_S = @LN_S@
@@ -55,8 +55,10 @@ OBJECTS = iconv.lo localcharset.lo reloc
 
 all : @PLUGLIB@ libiconv.la
 
+libiconv_la_LDFLAGS=-version-info $(LIBICONV_VERSION_INFO) -no-undefined
+
 libiconv.la : $(OBJECTS)
-	$(LIBTOOL_LINK) $(CC) $(LDFLAGS) -o libiconv.la -rpath $(libdir) -version-info $(LIBICONV_VERSION_INFO) -no-undefined $(OBJECTS)
+	$(LIBTOOL_LINK) $(CC) $(LDFLAGS) -o libiconv.la -rpath $(libdir) $(libiconv_la_LDFLAGS) $(OBJECTS)
 
 libiconv_plug.so : libiconv_plug_@OS@.so
 	$(RM) libiconv_plug.so
@@ -89,19 +91,19 @@ libiconv_plug_osf.so : $(SOURCES)
 	fi
 
 iconv.lo : $(srcdir)/iconv.c $(srcdir)/converters.h $(srcdir)/encodings.def $(srcdir)/encodings_aix.def $(srcdir)/encodings_osf1.def $(srcdir)/encodings_dos.def $(srcdir)/encodings_local.def $(srcdir)/aliases.h $(srcdir)/aliases_aix.h $(srcdir)/aliases_osf1.h $(srcdir)/aliases_dos.h $(srcdir)/flags.h
-	$(LIBTOOL_COMPILE) $(CC) $(INCLUDES) $(CPPFLAGS) $(CFLAGS) $(DEFS) -c $(srcdir)/iconv.c
+	$(LIBTOOL_COMPILE) $(CC) $(INCLUDES) $(CPPFLAGS) $(CFLAGS) $(DEFS) $(LIBTOOL_FLAGS) -c $(srcdir)/iconv.c
 
 localcharset.lo : $(srcdir)/../libcharset/lib/localcharset.c $(srcdir)/relocatable.h
-	$(LIBTOOL_COMPILE) $(CC) $(INCLUDES) $(CPPFLAGS) $(CFLAGS) $(DEFS) -c $(srcdir)/../libcharset/lib/localcharset.c
+	$(LIBTOOL_COMPILE) $(CC) $(INCLUDES) $(CPPFLAGS) $(CFLAGS) $(DEFS) $(LIBTOOL_FLAGS) -c $(srcdir)/../libcharset/lib/localcharset.c
 
 relocatable.lo : $(srcdir)/relocatable.c $(srcdir)/relocatable.h
-	$(LIBTOOL_COMPILE) $(CC) $(INCLUDES) $(CPPFLAGS) $(CFLAGS) $(DEFS) -c $(srcdir)/relocatable.c
+	$(LIBTOOL_COMPILE) $(CC) $(INCLUDES) $(CPPFLAGS) $(CFLAGS) $(DEFS) $(LIBTOOL_FLAGS) -c $(srcdir)/relocatable.c
 
 # Installs the library and include files only. Typically called with only
 # $(libdir) and $(includedir) - don't use $(prefix) and $(exec_prefix) here.
 install-lib : all force
 	if [ ! -d $(libdir) ] ; then $(mkinstalldirs) $(libdir) ; fi
-	$(LIBTOOL_INSTALL) $(INSTALL_DATA) libiconv.la $(libdir)/libiconv.la
+	$(LIBTOOL_INSTALL) $(CP) libiconv.la $(libdir)/libiconv.la
 
 install : all force
 	if [ ! -d $(DESTDIR)$(prefix) ] ; then $(mkinstalldirs) $(DESTDIR)$(prefix) ; fi
