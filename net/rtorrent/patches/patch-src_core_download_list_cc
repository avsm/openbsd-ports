$OpenBSD: patch-src_core_download_list_cc,v 1.1 2006/12/23 19:39:47 naddy Exp $
--- src/core/download_list.cc.orig	Sat Dec 23 18:16:03 2006
+++ src/core/download_list.cc	Sat Dec 23 18:18:24 2006
@@ -95,10 +95,17 @@ DownloadList::create(std::istream* str, 
   try {
     *str >> *object;
     
-    // Catch, delete.
-    if (str->fail())
-      throw torrent::input_error("Could not create download, the input is not a valid torrent.");
+    // Don't throw input_error from here as gcc-3.3.5 produces bad
+    // code.
+    if (str->fail()) {
+      delete object;
 
+      if (printLog)
+        control->core()->push_log("Could not create download, the input is not a valid torrent.");
+
+      return NULL;
+    }
+
     download = torrent::download_add(object);
 
   } catch (torrent::local_error& e) {
@@ -389,9 +396,6 @@ DownloadList::check_hash(Download* downl
 void
 DownloadList::hash_done(Download* download) {
   check_contains(download);
-
-  if (!download->is_open())
-    throw torrent::internal_error("DownloadList::hash_done(...) !download->is_open().");
 
   if (download->is_hash_checking() || download->is_active())
     throw torrent::internal_error("DownloadList::hash_done(...) download in invalid state.");
