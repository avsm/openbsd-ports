$OpenBSD: patch-kdvi_dviwin_cpp,v 1.1.2.1 2003/04/10 18:59:40 brad Exp $
--- kdvi/dviwin.cpp.orig	Sun Dec 15 21:54:29 2002
+++ kdvi/dviwin.cpp	Thu Apr 10 02:05:05 2003
@@ -37,7 +37,7 @@
 #include <klocale.h>
 #include <kprinter.h>
 #include <kprocess.h>
-
+#include <kstandarddirs.h>
 
 
 #include "dviwin.h"
@@ -498,6 +498,28 @@ bool dviWindow::setFile(QString fname, Q
   // specials in PostScriptDirectory, and the headers in the
   // PostScriptHeaderString.
   PS_interface->clear();
+
+  // Files that reside under "tmp" or under the "data" resource are most
+  // likely remote files. We limit the files they are able to read to
+  // the directory they are in in order to limit the possibilities of a 
+  // denial of service attack.
+  bool restrictIncludePath = true;
+  QString tmp = KGlobal::dirs()->saveLocation("tmp", QString::null);
+  if (!filename.startsWith(tmp))
+  {
+     tmp = KGlobal::dirs()->saveLocation("data", QString::null);
+     if (!filename.startsWith(tmp))
+        restrictIncludePath = false;
+  }
+  
+  QString includePath;
+  if (restrictIncludePath)
+  {
+     includePath = filename;
+     includePath.truncate(includePath.findRev('/'));
+  }
+
+  PS_interface->setIncludePath(includePath);     
   
   // We will also generate a list of hyperlink-anchors in the
   // document. So declare the existing list empty.
