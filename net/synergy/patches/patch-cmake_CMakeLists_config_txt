$OpenBSD: patch-cmake_CMakeLists_config_txt,v 1.1 2011/04/18 18:37:48 jasper Exp $
--- cmake/CMakeLists_config.txt.orig	Sun Jan 23 06:53:37 2011
+++ cmake/CMakeLists_config.txt	Mon Apr 18 14:45:20 2011
@@ -41,7 +41,7 @@ IF(UNIX)
 	CHECK_INCLUDE_FILES(strings.h HAVE_STRINGS_H)
 	CHECK_INCLUDE_FILES(string.h HAVE_STRING_H)
 	CHECK_INCLUDE_FILES(sys/select.h HAVE_SYS_SELECT_H)
-	CHECK_INCLUDE_FILES(sys/socket.h HAVE_SYS_SOCKET_H)
+	CHECK_INCLUDE_FILES("sys/types.h;sys/socket.h" HAVE_SYS_SOCKET_H)
 	CHECK_INCLUDE_FILES(sys/stat.h HAVE_SYS_STAT_H)
 	CHECK_INCLUDE_FILES(sys/time.h HAVE_SYS_TIME_H)
 	CHECK_INCLUDE_FILES(sys/utsname.h HAVE_SYS_UTSNAME_H)
@@ -52,7 +52,6 @@ IF(UNIX)
 	CHECK_FUNCTION_EXISTS(gmtime_r HAVE_GMTIME_R)
 	CHECK_FUNCTION_EXISTS(nanosleep HAVE_NANOSLEEP)
 	CHECK_FUNCTION_EXISTS(poll HAVE_POLL)
-	CHECK_FUNCTION_EXISTS(sigwait HAVE_POSIX_SIGWAIT)
 	CHECK_FUNCTION_EXISTS(strftime HAVE_STRFTIME)
 	CHECK_FUNCTION_EXISTS(vsnprintf HAVE_VSNPRINTF)
 	CHECK_FUNCTION_EXISTS(inet_aton HAVE_INET_ATON)
@@ -88,13 +87,17 @@ IF(UNIX)
 	CHECK_TYPE_SIZE(short SIZEOF_SHORT)
 
 	# pthread is used on both Linux and Mac
-	CHECK_LIBRARY_EXISTS("pthread" pthread_create "" HAVE_PTHREAD)
+	CHECK_LIBRARY_EXISTS("-pthread" pthread_create "" HAVE_PTHREAD)
 	IF(HAVE_PTHREAD)
-		LIST(APPEND libs pthread)
+		LIST(APPEND libs "-pthread")
 	ELSE(HAVE_PTHREAD)
 		MESSAGE(FATAL_ERROR "Missing library: pthread")
 	ENDIF(HAVE_PTHREAD)
 	
+	SET(CMAKE_REQUIRED_LIBRARIES "-pthread")
+	CHECK_FUNCTION_EXISTS(sigwait HAVE_POSIX_SIGWAIT)
+	SET(CMAKE_REQUIRED_LIBRARIES)
+
 	IF(APPLE)
 
 		# build mac os x universal
@@ -125,6 +128,7 @@ IF(UNIX)
 
 	ELSE(APPLE)
 
+		SET(CMAKE_REQUIRED_INCLUDES "${OPENBSD_X11BASE}/include")
 		SET(XKBlib "X11/XKBlib.h")
 		CHECK_INCLUDE_FILES("${XKBlib};X11/extensions/dpms.h" HAVE_X11_EXTENSIONS_DPMS_H)
 		CHECK_INCLUDE_FILES("X11/extensions/Xinerama.h" HAVE_X11_EXTENSIONS_XINERAMA_H)
@@ -142,10 +146,10 @@ IF(UNIX)
 			MESSAGE(FATAL_ERROR "Missing header: " ${XKBlib})
 		ENDIF(NOT HAVE_X11_XKBLIB_H)
 
-		CHECK_LIBRARY_EXISTS("SM;ICE" IceConnectionNumber "" HAVE_ICE)
-		CHECK_LIBRARY_EXISTS("X11;Xext" DPMSQueryExtension "" HAVE_Xext)
-		CHECK_LIBRARY_EXISTS("X11;Xext;Xtst" XTestQueryExtension "" HAVE_Xtst)
-		CHECK_LIBRARY_EXISTS("Xinerama" XineramaQueryExtension "" HAVE_Xinerama)
+		CHECK_LIBRARY_EXISTS("SM;ICE" IceConnectionNumber "${OPENBSD_X11BASE}/lib" HAVE_ICE)
+		CHECK_LIBRARY_EXISTS("X11;Xext" DPMSQueryExtension "${OPENBSD_X11BASE}/lib" HAVE_Xext)
+		CHECK_LIBRARY_EXISTS("X11;Xext;Xtst" XTestQueryExtension "${OPENBSD_X11BASE}/lib" HAVE_Xtst)
+		CHECK_LIBRARY_EXISTS("Xinerama" XineramaQueryExtension "${OPENBSD_X11BASE}/lib" HAVE_Xinerama)
 
 		IF(HAVE_ICE)
 
