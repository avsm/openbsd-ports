$OpenBSD: patch-ffmpeg_libavcodec_Makefile,v 1.1 2010/11/08 21:25:44 edd Exp $
--- ffmpeg/libavcodec/Makefile.orig	Sat Oct  2 10:51:26 2010
+++ ffmpeg/libavcodec/Makefile	Sun Oct 24 13:08:08 2010
@@ -692,3 +692,31 @@ $(SUBDIR)motionpixels.o: $(SUBDIR)motionpixels_tables.
 $(SUBDIR)pcm.o: $(SUBDIR)pcm_tables.h
 $(SUBDIR)qdm2.o: $(SUBDIR)qdm2_tables.h
 endif
+
+ifdef ARCH_X86_32
+ifeq (,$(findstring -O,$(CFLAGS)))
+x86/dsputil_mmx.o: CFLAGS += -O
+x86/flacdsp_mmx.o: CFLAGS += -O
+x86/fft_3dn.o: CFLAGS += -O
+x86/fft_3dn2.o: CFLAGS += -O
+x86/mlpdsp.o: CFLAGS += -O
+x86/snowdsp_mmx.o: CFLAGS += -O
+h264.o: CFLAGS += -O
+h264_cabac.o: CFLAGS += -O
+h264_parser.o: CFLAGS += -O
+cabac.o: CFLAGS += -O
+endif
+# OpenBSD -- otherwise we run out of registers, eg:
+# "cabac.h:527: error: can't find a register in class..."
+x86/dsputil_mmx.o: CFLAGS += -fomit-frame-pointer
+x86/flacdsp_mmx.o: CFLAGS += -fomit-frame-pointer
+x86/fft_3dn.o: CFLAGS += -fomit-frame-pointer
+x86/fft_3dn2.o: CFLAGS += -fomit-frame-pointer
+x86/mlpdsp.o: CFLAGS += -fomit-frame-pointer
+x86/snowdsp_mmx.o: CFLAGS += -fomit-frame-pointer
+h264.o: CFLAGS += -fomit-frame-pointer
+h264_cabac.o: CFLAGS += -fomit-frame-pointer
+h264_parser.o: CFLAGS += -fomit-frame-pointer
+cabac.o: CFLAGS += -fomit-frame-pointer
+endif
+
