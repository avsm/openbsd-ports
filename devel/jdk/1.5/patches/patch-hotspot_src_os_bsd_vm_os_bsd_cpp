$OpenBSD: patch-hotspot_src_os_bsd_vm_os_bsd_cpp,v 1.10 2007/04/08 12:43:06 kurt Exp $
--- hotspot/src/os/bsd/vm/os_bsd.cpp.orig	Fri Apr  6 09:08:49 2007
+++ hotspot/src/os/bsd/vm/os_bsd.cpp	Fri Apr  6 10:37:25 2007
@@ -293,11 +293,7 @@ julong os::physical_memory() {
 
 julong os::allocatable_physical_memory(julong size) {
 #ifdef __OpenBSD__
-#ifdef _LP64
-   julong reasonable_size = (julong)650*M - 2 * LargePageSizeInBytes;
-#else
-   julong reasonable_size = (julong)900*M - 2 * LargePageSizeInBytes;
-#endif
+   julong reasonable_size = (julong)875*M - 2 * LargePageSizeInBytes;
    return MIN2(size, reasonable_size);
 #else
 #ifdef _LP64
@@ -356,6 +352,16 @@ void os::Bsd::initialize_system_info() {
 	_physical_memory = mem_val;
   else
 	_physical_memory = 256*1024*1024;	// fallback (XXXBSD?)
+
+#ifdef __OpenBSD__
+  {
+	// limit _physical_memory memory view on OpenBSD since
+	// datasize maximum limits us anyway.
+	struct rlimit limits;
+	getrlimit(RLIMIT_DATA, &limits);
+	_physical_memory = MIN2(_physical_memory, (julong)limits.rlim_max);
+  }
+#endif
 }
 
 int os::processor_count() {
@@ -451,7 +457,9 @@ void os::init_system_properties_values() {
 #define malloc(n) (char*)NEW_C_HEAP_ARRAY(char, (n))
 #define getenv(n) ::getenv(n)
 
+#ifndef DEFAULT_LD_LIBRARY_PATH
 #define DEFAULT_LD_LIBRARY_PATH "/usr/lib" /* See ld.so.1(1) */
+#endif
 #define EXTENSIONS_DIR "/lib/ext"
 #define ENDORSED_DIR "/lib/endorsed"
 
