$OpenBSD: patch-makefile_Linux,v 1.3 2005/04/19 15:14:38 pedro Exp $
--- makefile.Linux.orig	Sat Jan 15 20:52:38 2005
+++ makefile.Linux	Sat Apr 16 17:23:40 2005
@@ -5,42 +5,26 @@ COMPAT=compat-5.1r2
 
 LUAC=luac
 BIN2C=bin2c
-CC=gcc
-OPT=-O2 $(INC) 
-DEF = -DLUASOCKET_DEBUG #-Dsocklen_t=int
 
-LOBJS= \
-	luasocket.o \
-	timeout.o \
-	buffer.o \
-	io.o \
-	auxiliar.o \
-	except.o \
-	select.o \
-	options.o \
-	inet.o \
-	tcp.o \
-	udp.o \
-	usocket.o \
-	$(COMPAT)/compat-5.1.o 
+LOBJS= luasocket.o timeout.o buffer.o io.o auxiliar.o except.o select.o\
+       options.o inet.o tcp.o udp.o usocket.o
 
-MOBJS= \
-	mime.o \
-	$(COMPAT)/compat-5.1.o 
+MOBJS= mime.o
 
-CFLAGS=-I../../include -I$(COMPAT) $(PROF) $(OPT) $(DBG) $(DEF) -pedantic -W -Wall 
+CFLAGS+= -I$(LOCALBASE)/include -fPIC -DPIC
+LDFLAGS+= -L$(LOCALBASE)/lib -lluacompat
 
-LDYN=lsocket.so
+LDYN=luasocket.so.$(LV)
 
-MDYN=lmime.so
+MDYN=luamime.so.$(LV)
 
 all: $(LDYN) $(MDYN)
 
 $(LDYN): $(LOBJS)
-	gcc -shared -o $(LDYN) $(LOBJS)
+	$(CC) -shared $(LDFLAGS) -fPIC -o $(LDYN) $(LOBJS)
 
 $(MDYN): $(MOBJS)
-	gcc -shared -o $(MDYN) $(MOBJS)
+	$(CC) -shared $(LDFLAGS) -fPIC -o $(MDYN) $(MOBJS)
 
 auxiliar.o: auxiliar.c auxiliar.h
 buffer.o: buffer.c buffer.h io.h timeout.h
