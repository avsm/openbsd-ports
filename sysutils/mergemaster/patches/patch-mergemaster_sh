$OpenBSD: patch-mergemaster_sh,v 1.2 2002/01/22 23:19:50 naddy Exp $
--- mergemaster.sh.orig	Thu Sep 27 16:20:58 2001
+++ mergemaster.sh	Tue Jan 22 23:59:13 2002
@@ -351,7 +351,7 @@ SOURCEDIR=${SOURCEDIR:-/usr/src/etc}
 
 # Define what CVS $Id tag to look for to aid portability.
 #
-CVS_ID_TAG=FreeBSD
+CVS_ID_TAG=OpenBSD
 
 case "${RERUN}" in
 '')
@@ -447,10 +447,7 @@ case "${RERUN}" in
       make DESTDIR=${DESTDIR} distrib-dirs
       ;;
     esac
-    make DESTDIR=${TEMPROOT} distrib-dirs &&
-    make MAKEOBJDIRPREFIX=${TEMPROOT}/usr/obj obj &&
-    make MAKEOBJDIRPREFIX=${TEMPROOT}/usr/obj DESTDIR=${TEMPROOT} \
-        -DNO_MAKEDEV_RUN distribution;} ||
+    make DESTDIR=${TEMPROOT} -DNOMAKEDEV distribution-etc-root-var;} ||
   { echo '';
     echo "  *** FATAL ERROR: Cannot 'cd' to ${SOURCEDIR} and install files to";
     echo "      the temproot environment";
@@ -488,11 +485,6 @@ case "${RERUN}" in
      ;;
   esac
 
-  # Avoid trying to update MAKEDEV if /dev is on a devfs
-  if /sbin/sysctl vfs.devfs.generation > /dev/null 2>&1 ; then
-    rm ${TEMPROOT}/dev/MAKEDEV ${TEMPROOT}/dev/MAKEDEV.local
-  fi
-
   ;; # End of the "RERUN" test
 esac
 
@@ -503,6 +495,7 @@ esac
 [ -f "${TEMPROOT}/etc/spwd.db" ] && rm "${TEMPROOT}/etc/spwd.db"
 [ -f "${TEMPROOT}/etc/passwd" ]  && rm "${TEMPROOT}/etc/passwd"
 [ -f "${TEMPROOT}/etc/pwd.db" ]  && rm "${TEMPROOT}/etc/pwd.db"
+[ -f "${TEMPROOT}/etc/mail/aliases.db" ] && rm "${TEMPROOT}/etc/mail/aliases.db"
 
 # Get ready to start comparing files
 
@@ -730,8 +723,8 @@ for COMPFILE in `find . -type f -size +0
     # If the files have the same $Id, delete the one in temproot so the
     # user will have less to wade through if files are left to merge by hand.
     #
-    CVSID1=`grep "[$]${CVS_ID_TAG}:" ${DESTDIR}${COMPFILE#.} 2>/dev/null`
-    CVSID2=`grep "[$]${CVS_ID_TAG}:" ${COMPFILE} 2>/dev/null`
+    CVSID1=`grep "[$]${CVS_ID_TAG}:" ${DESTDIR}${COMPFILE#.} 2>/dev/null` &&
+    CVSID2=`grep "[$]${CVS_ID_TAG}:" ${COMPFILE} 2>/dev/null` || CVSID1=no
 
     case "${CVSID2}" in
     "${CVSID1}")
