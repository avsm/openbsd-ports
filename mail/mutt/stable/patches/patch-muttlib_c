$OpenBSD: patch-muttlib_c,v 1.2 2007/05/04 09:09:31 kili Exp $
--- muttlib.c.orig	Mon Mar 25 06:29:32 2002
+++ muttlib.c	Thu May  3 14:11:50 2007
@@ -513,7 +513,9 @@ char *mutt_gecos_name (char *dest, size_t destlen, str
   {
     if (dest[idx] == '&')
     {
-      memmove (&dest[idx + pwnl], &dest[idx + 1],
+      /* Don't move if destination is outside buffer. */
+      if (idx + pwnl < destlen)
+        memmove (&dest[idx + pwnl], &dest[idx + 1],
 	       MAX(destlen - idx - pwnl - 1, 0));
       memcpy (&dest[idx], pw->pw_name, MIN(destlen - idx - 1, pwnl));
       dest[idx] = toupper (dest[idx]);
@@ -809,8 +811,8 @@ void mutt_expand_fmt (char *dest, size_t destlen, cons
     }
     else if (p[1] == '%')
       p++;
-
-    p++;
+    else
+      p++;
   }
 
   if (found)
