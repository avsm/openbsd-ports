$OpenBSD: patch-jdk_src_solaris_native_sun_net_spi_DefaultProxySelector_c,v 1.3 2011/01/11 15:47:50 kurt Exp $
--- jdk/src/solaris/native/sun/net/spi/DefaultProxySelector.c.orig	Fri Aug 13 03:22:14 2010
+++ jdk/src/solaris/native/sun/net/spi/DefaultProxySelector.c	Mon Oct 25 18:15:59 2010
@@ -26,11 +26,12 @@
 #include "jni.h"
 #include "jni_util.h"
 #include "jvm.h"
+#include "jvm_md.h"
 #include "jlong.h"
 #include "sun_net_spi_DefaultProxySelector.h"
 #include <dlfcn.h>
 #include <stdio.h>
-#ifdef __linux__
+#if defined(__linux__) || defined(_ALLBSD_SOURCE)
 #include <string.h>
 #else
 #include <strings.h>
@@ -110,8 +111,9 @@ Java_sun_net_spi_DefaultProxySelector_init(JNIEnv *env
   /**
    * Let's try to load le GConf-2 library
    */
-  if (dlopen("libgconf-2.so", RTLD_GLOBAL | RTLD_LAZY) != NULL ||
-      dlopen("libgconf-2.so.4", RTLD_GLOBAL | RTLD_LAZY) != NULL) {
+  if (dlopen(JNI_LIB_NAME("gconf-2"), RTLD_GLOBAL | RTLD_LAZY) != NULL ||
+      dlopen(VERSIONED_JNI_LIB_NAME("gconf-2", "4"),
+             RTLD_GLOBAL | RTLD_LAZY) != NULL) {
     gconf_ver = 2;
   }
   if (gconf_ver > 0) {
