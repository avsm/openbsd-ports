$OpenBSD: patch-j2sdk1_3_1_src_share_native_java_util_zip_zlib-1_1_3_infblock_c,v 1.1 2005/08/10 22:36:27 kurt Exp $
--- j2sdk1.3.1/src/share/native/java/util/zip/zlib-1.1.3/infblock.c.orig	Sun May  6 08:20:27 2001
+++ j2sdk1.3.1/src/share/native/java/util/zip/zlib-1.1.3/infblock.c	Tue Aug  9 18:20:33 2005
@@ -249,10 +249,13 @@ int r;
                              &s->sub.trees.tb, s->hufts, z);
       if (t != Z_OK)
       {
-        ZFREE(z, s->sub.trees.blens);
+
         r = t;
         if (r == Z_DATA_ERROR)
+        {
+          ZFREE(z, s->sub.trees.blens);
           s->mode = BAD;
+        }
         LEAVE
       }
       s->sub.trees.index = 0;
@@ -313,11 +316,14 @@ int r;
         t = inflate_trees_dynamic(257 + (t & 0x1f), 1 + ((t >> 5) & 0x1f),
                                   s->sub.trees.blens, &bl, &bd, &tl, &td,
                                   s->hufts, z);
-        ZFREE(z, s->sub.trees.blens);
+
         if (t != Z_OK)
         {
           if (t == (uInt)Z_DATA_ERROR)
-            s->mode = BAD;
+          {
+              ZFREE(z, s->sub.trees.blens);
+              s->mode = BAD;
+          }
           r = t;
           LEAVE
         }
@@ -329,6 +335,7 @@ int r;
         }
         s->sub.decode.codes = c;
       }
+      ZFREE(z, s->sub.trees.blens);
       s->mode = CODES;
     case CODES:
       UPDATE
