$OpenBSD: patch-server_Makefile,v 1.7 2007/10/25 07:34:29 ajacoutot Exp $
--- server/Makefile.orig	Wed Oct 24 18:53:41 2007
+++ server/Makefile	Wed Oct 24 18:56:37 2007
@@ -2,23 +2,20 @@ PACKAGE_D ?= gkrellmd
 PKG_CONFIG ?= pkg-config
 BINMODE ?= 755
 
-INSTALLROOT ?= $(DESTDIR)$(PREFIX)
-ifeq ($(INSTALLROOT),)
-	INSTALLROOT = /usr/local
-endif
+INSTALLROOT ?= $(PREFIX)
 
-SINSTALLDIR ?= $(INSTALLROOT)/bin
+SINSTALLDIR ?= $(INSTALLROOT)/sbin
 INSTALLDIRMODE ?= 755
 
 INCLUDEDIR ?= $(INSTALLROOT)/include
 INCLUDEMODE ?= 644
 INCLUDEDIRMODE ?= 755
 
-SMANDIR ?= $(INSTALLROOT)/share/man/man1
+SMANDIR ?= $(INSTALLROOT)/man/man1
 MANMODE ?= 644
 MANDIRMODE ?= 755
 INSTALL ?= install
-LINK_FLAGS ?= -Wl,-E
+LINK_FLAGS ?= -Wl
 
 
 ifeq ($(without-libsensors),yes)
@@ -47,23 +44,23 @@ PKG_LIB = `$(PKG_CONFIG) --libs glib-2.0 gmodule-2.0 g
 GLIB12_INCLUDE = `glib-config --cflags`
 GLIB12_LIB = `glib-config --libs glib gmodule`
 
-FLAGS = -O2 -I.. $(PKG_INCLUDE) $(GTOP_INCLUDE)
+FLAGS = -I.. $(PKG_INCLUDE) $(GTOP_INCLUDE)
 ifeq ($(glib12),1)
-FLAGS = -O2 -I.. $(GLIB12_INCLUDE) $(GTOP_INCLUDE)
+FLAGS = -I.. $(GLIB12_INCLUDE) $(GTOP_INCLUDE)
 endif
 ifeq ($(glib12),yes)
-FLAGS = -O2 -I.. $(GLIB12_INCLUDE) $(GTOP_INCLUDE)
+FLAGS = -I.. $(GLIB12_INCLUDE) $(GTOP_INCLUDE)
 endif
 
 FLAGS+= $(PTHREAD_INC)
 
-LIBS = $(PKG_LIB) $(GTOP_LIBS_D) $(SYS_LIBS) $(SENSORS_LIBS)
+LIBS += $(PKG_LIB) $(GTOP_LIBS_D) $(SYS_LIBS) $(SENSORS_LIBS)
 
 ifeq ($(glib12),1)
-LIBS = $(GLIB12_LIB) $(GTOP_LIBS_D) $(SYS_LIBS) $(SENSORS_LIBS)
+LIBS += $(GLIB12_LIB) $(GTOP_LIBS_D) $(SYS_LIBS) $(SENSORS_LIBS)
 endif
 ifeq ($(glib12),yes)
-LIBS = $(GLIB12_LIB) $(GTOP_LIBS_D) $(SYS_LIBS) $(SENSORS_LIBS)
+LIBS += $(GLIB12_LIB) $(GTOP_LIBS_D) $(SYS_LIBS) $(SENSORS_LIBS)
 endif
 
 ifeq ($(debug),1)
@@ -96,7 +93,7 @@ ifeq ($(HAVE_GETADDRINFO),1)
 endif
 
 
-override CC += -Wall $(FLAGS)
+CFLAGS += $(FLAGS)
 
 OS_NAME=$(shell uname -s)
 OS_RELEASE=$(shell uname -r)
