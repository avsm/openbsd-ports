--- scripts/makefile.std.orig	Wed Dec  8 18:44:40 1999
+++ scripts/makefile.std	Thu Sep 14 05:32:12 2000
@@ -8,12 +8,11 @@
 # Where the zlib library and include files are located
 #ZLIBLIB=/usr/local/lib
 #ZLIBINC=/usr/local/include
-ZLIBLIB=../zlib
-ZLIBINC=../zlib
 
 CC=cc
 CFLAGS=-I$(ZLIBINC) -O # -g -DPNG_DEBUG=5
 LDFLAGS=-L. -L$(ZLIBLIB) -lpng -lz -lm
+LIBTOOL=libtool --quiet
 
 #RANLIB=echo
 RANLIB=ranlib
@@ -22,30 +21,29 @@
 	pngread.o pngrio.o pngwio.o pngwrite.o pngrtran.o \
 	pngwtran.o pngmem.o pngerror.o pngpread.o
 
+.c.o:
+	$(LIBTOOL) --mode=compile $(CC) $(CFLAGS) -c $(.IMPSRC)
+
 all: libpng.a pngtest
 
 libpng.a: $(OBJS)
-	ar rc $@  $(OBJS)
-	$(RANLIB) $@
+	$(LIBTOOL) --mode=link $(CC) $(CFLAGS) -o libpng.la $(OBJS:.o=.lo) \
+		-version-info 1:8:0 -rpath $(prefix)/lib
 
 pngtest: pngtest.o libpng.a
-	$(CC) -o pngtest $(CFLAGS) pngtest.o $(LDFLAGS)
+	$(LIBTOOL) --mode=link $(CC) -o pngtest $(CFLAGS) pngtest.lo $(LDFLAGS)
 
 test: pngtest
 	./pngtest
 
 install: libpng.a
-	-@mkdir $(prefix)/include
-	-@mkdir $(prefix)/lib
-	cp png.h $(prefix)/include
-	cp pngconf.h $(prefix)/include
-	chmod 644 $(prefix)/include/png.h
-	chmod 644 $(prefix)/include/pngconf.h
-	cp libpng.a $(prefix)/lib
-	chmod 644 $(prefix)/lib/libpng.a
+	${BSD_INSTALL_DATA_DIR} $(DESTDIR)$(prefix)/include
+	${BSD_INSTALL_DATA_DIR} $(DESTDIR)$(prefix)/lib
+	${BSD_INSTALL_DATA} png.h pngconf.h $(DESTDIR)$(prefix)/include
+	$(LIBTOOL) --mode=install ${BSD_INSTALL_DATA} libpng.la $(DESTDIR)$(prefix)/lib
 
 clean:
-	rm -f *.o libpng.a pngtest pngout.png
+	rm -f *.o *.lo libpng.a libpng.so.* pngtest pngout.png
 
 DOCS = ANNOUNCE CHANGES INSTALL KNOWNBUG LICENSE README TODO Y2KINFO
 writelock:
