# $OpenBSD: Makefile,v 1.44 2010/11/15 23:22:08 espie Exp $


# XXX  This port is not finished and does not work.


SHARED_ONLY =		Yes
ONLY_FOR_ARCHS =	i386 amd64

COMMENT =		wine enables you to run windows binaries

DISTNAME =		wine-1.1.21
REVISION =		1

SHARED_LIBS =		wine 0.0

CATEGORIES =		x11 emulators

HOMEPAGE =		http://winehq.org/

MAINTAINER =		Ariane van der Steldt <ariane@stack.nl>

# LGPLv2.1+
PERMIT_PACKAGE_CDROM =	Yes
PERMIT_PACKAGE_FTP =	Yes
PERMIT_DISTFILES_CDROM =Yes
PERMIT_DISTFILES_FTP =	Yes

WANTLIB += c m z pthread ssl GL GLU crypto ossaudio ncurses
WANTLIB += ICE SM X11 Xext Xpm Xxf86dga Xxf86vm gphoto2
WANTLIB += gphoto2_port jpeg lcms png sane xslt iconv drm
WANTLIB += pthread-stubs xcb jpeg png gphoto2 gphoto2_port
WANTLIB += sane lcms iconv

MASTER_SITES =		http://ibiblio.org/pub/linux/system/emulators/wine/ \
			http://prdownloads.sourceforge.net/wine/
EXTRACT_SUFX =		.tar.bz2

BUILD_DEPENDS =		devel/bison
LIB_DEPENDS =		textproc/libxslt \
			graphics/jpeg \
			graphics/png \
			graphics/libgphoto2 \
			graphics/sane-backends \
			graphics/lcms \
			converters/libiconv
RUN_DEPENDS =		devel/desktop-file-utils

USE_GMAKE =		Yes
USE_LIBTOOL =		Yes
USE_GROFF =		Yes
CONFIGURE_STYLE =	gnu autoconf

CPPFLAGS =		-I${LOCALBASE}/include \
			-I${LOCALBASE}/include/libpng \
			-I${X11BASE}/include

LDFLAGS =		-L${LOCALBASE}/lib \
			-L${X11BASE}/lib \
			-lz -lm -lcrypto -liconv -pthread

X_EXTRA_LIBS =		-L${X11BASE}/lib \
			-lXau -lXdmcp -ldrm -lGL -lGLU -lXxf86vm -lXdamage

CONFIGURE_ENV =		CPPFLAGS="${CPPFLAGS}" \
			LDFLAGS="${LDFLAGS}" \
			X_EXTRA_LIBS="${X_EXTRA_LIBS}"

# User configuration dir for regress.
MAKE_ENV =		WINEPREFIX="${WRKBUILD}/.wine"

CONFIGURE_ARGS +=	--without-alsa \
			--without-audioio \
			--without-capi \
			--without-coreaudio \
			--without-cups \
			--without-gnutls \
			--without-hal \
			--without-jack \
			--without-ldap \
			--without-nas \
			--without-xml

AUTOCONF_VERSION =	2.62

FLAVORS =		cups esd
FLAVOR ?=
.if ${FLAVOR:L:Mcups}
CONFIGURE_ARGS +=	--with-cups
.else
CONFIGURE_ARGS +=	--without-cups
.endif
.if ${FLAVOR:L:Mesd}
CONFIGURE_ARGS +=	--with-esd
LIB_DEPENDS =		sound/esound
WANTLIB +=		esd>=2
.else
CONFIGURE_ARGS +=	--without-esd
.endif

.if ${MACHINE_ARCH} == "amd64"
CONFIGURE_ARGS	+=	--enable-win64
.endif

post-configure:
	cd ${WRKSRC} && ${MAKE} depend

.include <bsd.port.mk>
