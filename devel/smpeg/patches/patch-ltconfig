$OpenBSD: patch-ltconfig,v 1.3 2001/08/07 05:35:45 pvalchev Exp $
--- ltconfig.orig	Tue May 22 15:43:04 2001
+++ ltconfig	Mon Aug  6 23:25:38 2001
@@ -1449,9 +1449,9 @@ else
       *)
 	archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $linkopts'
 	hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
-	 if [ "`/usr/bin/file /usr/lib/libc.so.* | grep ELF`" != "" ]; then
-	   export_dynamic_flag_spec='${wl}-E'
-	 fi
+	if test "`echo __ELF__ | $CC -E - | grep __ELF__`" = "" -o "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+	  export_dynamic_flag_spec='${wl}-E'
+	fi
       ;;
     esac
     ;;
@@ -2077,6 +2077,17 @@ netbsd*)
 
 openbsd*)
   version_type=sunos
+  need_lib_prefix=no
+  need_version=no
+  file_magic_cmd=/usr/bin/file
+  file_magic_test_file=`echo /usr/lib/libc.so.*`
+  if test "`echo __ELF__ | $CC -E - | grep __ELF__`" = "" -o "$host_os-$host_cpu" = "openbsd2.8-powerpc"; then
+    deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB shared object'
+    shlibpath_overrides_runpath=no
+  else
+    deplibs_check_method='file_magic OpenBSD.* shared library'
+    shlibpath_overrides_runpath=yes
+  fi
   library_names_spec='${libname}${release}.so$versuffix ${libname}.so$versuffix'
   finish_cmds='PATH="\$PATH:/sbin" ldconfig -m $libdir'
   shlibpath_var=LD_LIBRARY_PATH
