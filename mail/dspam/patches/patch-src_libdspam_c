$OpenBSD: patch-src_libdspam_c,v 1.1 2005/10/26 06:18:39 jakob Exp $
--- src/libdspam.c.orig	Mon Oct 17 02:48:46 2005
+++ src/libdspam.c	Mon Oct 17 14:48:42 2005
@@ -594,9 +594,9 @@ dspam_process (DSPAM_CTX * CTX, const ch
 
   if (CTX->class[0] == 0) {
     if (CTX->result == DSR_ISSPAM)
-      strcpy(CTX->class, LANG_CLASS_SPAM);
+      strlcpy(CTX->class, LANG_CLASS_SPAM, sizeof (CTX->class));
     else if (CTX->result == DSR_ISINNOCENT)
-      strcpy(CTX->class, LANG_CLASS_INNOCENT);
+      strlcpy(CTX->class, LANG_CLASS_INNOCENT, sizeof (CTX->class));
   }
 
   if (is_toe)
@@ -768,9 +768,9 @@ _ds_operate (DSPAM_CTX * CTX, char *head
       goto bail;
     }
 
-    strcpy(CTX->signature->data, headers);
-    strcat(CTX->signature->data, "\001");
-    strcat(CTX->signature->data, body);
+    strlcpy(CTX->signature->data, headers, CTX->signature->length);
+    strlcat(CTX->signature->data, "\001", CTX->signature->length);
+    strlcat(CTX->signature->data, body, CTX->signature->length);
   }
 
   if (!diction)
@@ -962,7 +962,7 @@ _ds_operate (DSPAM_CTX * CTX, char *head
   if (CTX->flags & DSF_WHITELIST && do_whitelist) {
     LOGDEBUG("auto-whitelisting this message");
     CTX->result = DSR_ISINNOCENT;
-    strcpy(CTX->class, LANG_CLASS_WHITELISTED);
+    strlcpy(CTX->class, LANG_CLASS_WHITELISTED, sizeof (CTX->class));
   }
 
   /* Update Totals */
@@ -2282,7 +2282,7 @@ int _ds_instantiate_bnr(
       previous_bnr_probs[i] = previous_bnr_probs[i+1];
 
     previous_bnr_probs[BNR_SIZE-1] = _ds_round(ds_term->s.probability);
-    sprintf(bnr_token, "bnr.%c|", identifier);
+    snprintf(bnr_token, sizeof (bnr_token), "bnr.%c|", identifier);
     for(i=0;i<BNR_SIZE;i++) {
       char x[6];
       snprintf(x, 6, "%01.2f_", previous_bnr_probs[i]);
