$OpenBSD: patch-jdk_src_solaris_native_java_lang_ProcessEnvironment_md_c,v 1.1 2008/03/19 18:05:46 kurt Exp $
--- jdk/src/solaris/native/java/lang/ProcessEnvironment_md.c.orig	Tue Dec  4 04:05:20 2007
+++ jdk/src/solaris/native/java/lang/ProcessEnvironment_md.c	Wed Dec  5 17:42:02 2007
@@ -46,7 +46,7 @@ Java_java_lang_ProcessEnvironment_environ(JNIEnv *env,
 
     for (i = 0; environ[i]; i++) {
         /* Ignore corrupted environment variables */
-        if (strchr(environ[i], '=') != NULL)
+        if (strchr(environ[i], '=') != NULL && *environ[i] != '=')
             count++;
     }
 
@@ -56,7 +56,7 @@ Java_java_lang_ProcessEnvironment_environ(JNIEnv *env,
     for (i = 0, j = 0; environ[i]; i++) {
         const char * varEnd = strchr(environ[i], '=');
         /* Ignore corrupted environment variables */
-        if (varEnd != NULL) {
+        if (varEnd != NULL && varEnd != environ[i]) {
             jbyteArray var, val;
             const char * valBeg = varEnd + 1;
             jsize varLength = varEnd - environ[i];
