$OpenBSD: patch-Modules_FindQt4_cmake,v 1.9 2010/11/15 11:39:09 dcoppa Exp $
--- Modules/FindQt4.cmake.orig	Mon Jun 28 17:15:57 2010
+++ Modules/FindQt4.cmake	Mon Jul  5 11:23:18 2010
@@ -461,13 +461,20 @@ GET_FILENAME_COMPONENT(qt_install_version "[HKEY_CURRE
 # check for qmake
 # Debian uses qmake-qt4
 # macports' Qt uses qmake-mac
-FIND_PROGRAM(QT_QMAKE_EXECUTABLE NAMES qmake qmake4 qmake-qt4 qmake-mac PATHS
-  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\4.0.0;InstallDir]/bin"
-  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Versions\\4.0.0;InstallDir]/bin"
-  "[HKEY_CURRENT_USER\\Software\\Trolltech\\Versions\\${qt_install_version};InstallDir]/bin"
-  $ENV{QTDIR}/bin
-  DOC "The qmake executable for the Qt installation to use"
-)
+IF(CMAKE_SYSTEM MATCHES "OpenBSD*")
+  FIND_PROGRAM(QT_QMAKE_EXECUTABLE NAMES qmake4 PATHS
+    $ENV{QTDIR}/bin
+    DOC "The qmake executable for the Qt installation to use"
+  )
+ELSE(CMAKE_SYSTEM MATCHES "OpenBSD*")
+  FIND_PROGRAM(QT_QMAKE_EXECUTABLE NAMES qmake qmake4 qmake-qt4 qmake-mac PATHS
+    "[HKEY_CURRENT_USER\\Software\\Trolltech\\Qt3Versions\\4.0.0;InstallDir]/bin"
+    "[HKEY_CURRENT_USER\\Software\\Trolltech\\Versions\\4.0.0;InstallDir]/bin"
+    "[HKEY_CURRENT_USER\\Software\\Trolltech\\Versions\\${qt_install_version};InstallDir]/bin"
+    $ENV{QTDIR}/bin
+    DOC "The qmake executable for the Qt installation to use"
+  )
+ENDIF(CMAKE_SYSTEM MATCHES "OpenBSD*")
 
 IF (QT_QMAKE_EXECUTABLE)
 
@@ -964,6 +971,12 @@ IF (QT4_QMAKE_FOUND)
     _QT4_ADJUST_LIB_VARS(QAxContainer)
   ENDIF(Q_WS_WIN)
 
+  # Qt4 on OpenBSD needs to be linked with -pthread
+  IF(CMAKE_SYSTEM MATCHES "OpenBSD*")
+    FIND_PACKAGE(Threads)
+    SET(QT_QTCORE_LIBRARY ${QT_QTCORE_LIBRARY}
+              ${CMAKE_THREAD_LIBS_INIT})
+  ENDIF(CMAKE_SYSTEM MATCHES "OpenBSD*")
 
   #######################################
   #
@@ -988,13 +1001,13 @@ IF (QT4_QMAKE_FOUND)
   ENDIF(QT_QMAKE_CHANGED)
   
   FIND_PROGRAM(QT_MOC_EXECUTABLE
-    NAMES moc-qt4 moc
+    NAMES moc4 moc-qt4 moc
     PATHS ${QT_BINARY_DIR}
     NO_DEFAULT_PATH
     )
 
   FIND_PROGRAM(QT_UIC_EXECUTABLE
-    NAMES uic-qt4 uic
+    NAMES uic4 uic-qt4 uic
     PATHS ${QT_BINARY_DIR}
     NO_DEFAULT_PATH
     )
