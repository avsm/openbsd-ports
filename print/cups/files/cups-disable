#!/bin/sh
#
# $OpenBSD: cups-disable,v 1.4 2010/10/12 12:53:15 ajacoutot Exp $
#
# This script disables CUPS by removing links created by cups-enable.

_PREFIX=${TRUEPREFIX}
_BINDIR=/usr/bin
_SBINDIR=/usr/sbin

if [ "`id -u`" -ne 0 ]; then
	echo "You must be root to run this script."
	exit 1
fi

echo "This script will remove CUPS links from ${_BINDIR} and ${_SBINDIR}"
echo ""
echo -n "Are you sure you want to do this (y/[n])? "

read answer
echo ""

case "${answer}" in
	y|Y)
		;;
	*)
		echo "Exiting..."
		exit 1
		;;
esac

if [ ! -L /usr/sbin/lpc ]; then
	echo "CUPS not enabled, exiting..."
	exit 0
fi

echo "Removing CUPS links:"

for link in lpq lpr lprm; do
	if [ -L ${_BINDIR}/${link} ]; then
		echo " ${link}"
	fi
	rm -f ${_BINDIR}/${link}
done

for link in lpc; do
	if [ -L ${_SBINDIR}/${link} ]; then
		echo " ${link}"
	fi
	rm -f ${_SBINDIR}/${link}
done

echo done.

if [ ! -e /usr/sbin/lpd.pre-cups ]; then
	echo "Couldn't find saved lpd files, saved files not restored."
else
	echo "Trying to restore lpd files:"

	for file in \
		/usr/bin/lpq \
		/usr/bin/lpr \
		/usr/bin/lprm \
		/usr/sbin/lpc \
		/usr/sbin/lpd \
		/usr/share/man/cat1/lpq.0 \
		/usr/share/man/cat1/lpr.0 \
		/usr/share/man/cat1/lprm.0 \
		/usr/share/man/cat8/lpc.0 \
		/usr/share/man/cat8/lpd.0 \
		/etc/printcap
	do
	if [ -e ${file}.pre-cups ]; then
		echo " ${file}"
		mv ${file}.pre-cups ${file}
	fi
	done

	echo done.
	echo ""
fi
