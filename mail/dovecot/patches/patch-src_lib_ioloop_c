$OpenBSD: patch-src_lib_ioloop_c,v 1.1 2006/01/23 20:33:40 brad Exp $
--- src/lib/ioloop.c.orig	Sat Jan 14 12:42:22 2006
+++ src/lib/ioloop.c	Mon Jan 23 15:11:11 2006
@@ -279,6 +279,8 @@ void io_loop_destroy(struct ioloop **_io
 
 	*_ioloop = NULL;
 
+	io_loop_notify_handler_deinit(ioloop);
+
 	while (ioloop->ios != NULL) {
 		struct io *io = ioloop->ios;
 
@@ -295,8 +297,7 @@ void io_loop_destroy(struct ioloop **_io
 		}
                 timeout_destroy(ioloop, &ioloop->timeouts);
 	}
-
-	io_loop_notify_handler_deinit(ioloop);
+	
         io_loop_handler_deinit(ioloop);
 
         /* ->prev won't work unless loops are destroyed in create order */
