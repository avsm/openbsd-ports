$OpenBSD: patch-libktorrent_util_fileops_cpp,v 1.2 2008/01/30 12:18:59 sthen Exp $
--- libktorrent/util/fileops.cpp.orig	Sun Jan 27 12:06:02 2008
+++ libktorrent/util/fileops.cpp	Tue Jan 29 20:36:58 2008
@@ -29,6 +29,8 @@
 #include <kio/netaccess.h>
 #include <sys/stat.h>
 #include <sys/types.h>
+#include <sys/param.h>
+#include <sys/mount.h>
 #include <fcntl.h>
 #include <qdir.h>
 #include <qfile.h>
@@ -62,7 +64,6 @@ typedef	int64_t		__s64;
 #endif
 
 				 
-#include <sys/statvfs.h>
 
 
 namespace bt
@@ -445,7 +446,19 @@ namespace bt
 			return false;
 		}
 #else
-		return false;
+		struct statfs stfs;
+		if (statfs(path.local8Bit(), &stfs) == 0)
+		{
+			bytes_free = ((Uint64)stfs.f_bavail) * ((Uint64)stfs.f_bsize);
+			return true;
+		}
+		else
+		{
+			Out(SYS_GEN|LOG_DEBUG) << "Error : statfs for " << path << " failed :  "
+						<< QString(strerror(errno)) << endl;
+
+			return false;
+		}
 #endif
 	}
 }
