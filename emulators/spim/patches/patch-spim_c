$OpenBSD: patch-spim_c,v 1.2 2005/01/31 06:18:23 kevlo Exp $
--- spim.c.orig	Mon Jan  3 00:03:50 2005
+++ spim.c	Mon Jan 31 13:40:55 2005
@@ -32,6 +32,7 @@
 #include <ctype.h>
 #include <setjmp.h>
 #include <signal.h>
+#include <netinet/in.h>
 #include <arpa/inet.h>
 #include <sys/ioctl.h>
 
@@ -1016,7 +1017,8 @@ console_to_program ()
 #ifdef USE_TERMIOS
       struct termios params;
 
-      ioctl (console_in.i, TCGETA, (char *) &saved_console_state);
+      tcgetattr(console_in.i, &saved_console_state);
+
       params = saved_console_state;
       params.c_iflag &= ~(ISTRIP|IUCLC|INLCR|ICRNL|IGNCR|IXON|IXOFF|IXANY|INPCK|BRKINT|PARMRK);
 
@@ -1027,7 +1029,7 @@ console_to_program ()
       params.c_lflag = 0;
       params.c_cc[VMIN] = 1;
       params.c_cc[VTIME] = 1;
-      ioctl ((int)console_in.i, TCSETA, (char *) &params);
+      tcsetattr(console_in.i, TCSANOW, &params);
 #else
       int flags;
       ioctl ((int) console_in.i, TIOCGETP, (char *) &saved_console_state);
@@ -1048,7 +1050,7 @@ console_to_spim ()
 {
   if (mapped_io && console_state_saved)
 #ifdef USE_TERMIOS
-    ioctl ((int) console_in.i, TCSETA, (char *) &saved_console_state);
+    tcsetattr(console_in.i, TCSANOW, &saved_console_state);
 #else
     ioctl ((int) console_in.i, TIOCSETP, (char *) &saved_console_state);
 #endif
