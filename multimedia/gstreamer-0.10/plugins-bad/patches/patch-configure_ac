$OpenBSD: patch-configure_ac,v 1.10 2010/12/06 19:15:55 ajacoutot Exp $
--- configure.ac.orig	Thu Sep  2 17:30:40 2010
+++ configure.ac	Sun Dec  5 22:54:01 2010
@@ -733,7 +733,7 @@ return 0;
 dnl *** resindvd ***
 translit(dnm, m, l) AM_CONDITIONAL(USE_RESINDVD, true)
 AG_GST_CHECK_FEATURE(RESINDVD, [resindvd plugin], resindvd, [
-  PKG_CHECK_MODULES(DVDNAV, dvdnav >= 4.1.2 dvdread >= 4.1.2, HAVE_RESINDVD="yes", [
+  PKG_CHECK_MODULES(DVDNAV, dvdnav >= 4.1.2, HAVE_RESINDVD="yes", [
     HAVE_RESINDVD="no"
     AC_MSG_RESULT(no)
   ])
@@ -756,10 +756,10 @@ AG_GST_CHECK_FEATURE(METADATA, [METADATA muxer and dem
   PKG_CHECK_MODULES(IPTC, libiptcdata >= 1.0.2, HAVE_IPTC="yes", [
     HAVE_IPTC="no"
   ])
-  PKG_CHECK_MODULES(XMP, exempi-2.0, HAVE_XMP="yes", [
+dnl  PKG_CHECK_MODULES(XMP, exempi-2.0, HAVE_XMP="yes", [
     HAVE_XMP="no"
-  ])
-  PKG_CHECK_MODULES(XMP_1_99_5, exempi-2.0 >= 1.99.5, XMP_CFLAGS="-DXMP_1_99_5 $XMP_CFLAGS", AC_MSG_RESULT(no))
+dnl  ])
+dnl  PKG_CHECK_MODULES(XMP_1_99_5, exempi-2.0 >= 1.99.5, XMP_CFLAGS="-DXMP_1_99_5 $XMP_CFLAGS", AC_MSG_RESULT(no))
   if test x$HAVE_EXIF = xyes; then
     METADATA_CFLAGS="$EXIF_CFLAGS $METADATA_CFLAGS"
     METADATA_LIBS="$EXIF_LIBS $METADATA_LIBS -lm"
@@ -994,7 +994,7 @@ PKG_CHECK_EXISTS(mjpegtools >= 1.6.1.93 mjpegtools < 1
       OLD_CFLAGS="$CFLAGS"
       OLD_LIBS="$LIBS"
       CFLAGS="$MJPEG_CFLAGS"
-      LIBS="$LIBS $MJPEG_LIBS -lmjpegutils -lm -lpthread"
+      LIBS="$LIBS $MJPEG_LIBS -lmjpegutils -lm -pthread"
       AC_CHECK_FUNC(mjpeg_loglev_t, [
         mjpegtools_api=10903
         ], [
@@ -1031,7 +1031,7 @@ AG_GST_CHECK_FEATURE(MPEG2ENC, [mpeg2enc], mpeg2enc, [
       dnl check headers
       mpeg2enc_headers_ok=no
       AC_CHECK_HEADER([mpeg2encoder.hh], [
-        MPEG2ENC_LIBS="$MPEG2ENC_LIBS -lmpeg2encpp -lm -lpthread"
+        MPEG2ENC_LIBS="$MPEG2ENC_LIBS -lmpeg2encpp -lm -pthread"
         OLD_LIBS="$LIBS"
         LIBS="$LIBS $MPEG2ENC_LIBS"
         AC_MSG_CHECKING([for valid mpeg2enc objects])
@@ -1395,7 +1395,7 @@ AG_GST_CHECK_FEATURE(XVID, [xvid plugins], xvid, [
   HAVE_XVID=no
   AC_CHECK_HEADER(xvid.h, [
     OLD_LIBS="$LIBS"
-    LIBS="-lm"
+    LIBS="-lm -pthread"
     AC_CHECK_LIB(xvidcore, xvid_encore, [
       AC_CHECK_LIB(xvidcore, xvid_decore, [
         AC_CHECK_LIB(xvidcore, xvid_global, [
@@ -1405,7 +1405,7 @@ AG_GST_CHECK_FEATURE(XVID, [xvid plugins], xvid, [
               #error "Incompatible XviD API version"
               #endif
           ],[ AC_MSG_RESULT(yes)
-            XVID_LIBS="-lxvidcore -lm"
+            XVID_LIBS="-lxvidcore -lm -pthread"
             AC_SUBST(XVID_LIBS)
             HAVE_XVID=yes
           ], AC_MSG_RESULT(no) )
@@ -1503,6 +1503,8 @@ AG_GST_CHECK_FEATURE(ZBAR, [ZBar barcode detector], zb
 
 dnl *** vp8 ***
 translit(dnm, m, l) AM_CONDITIONAL(USE_VP8, vp8)
+OLD_LIBS="$LIBS"
+LIBS="$LIBS -lm -pthread"
 AG_GST_CHECK_FEATURE(VP8, [VP8 decoder], vp8, [
   VPX_LIBS=""
   AG_GST_CHECK_LIBHEADER(VPX, vpx,
@@ -1511,8 +1513,6 @@ AG_GST_CHECK_FEATURE(VP8, [VP8 decoder], vp8, [
     HAVE_VP8_ENCODER=no
     HAVE_VP8_DECODER=no
 
-    OLD_LIBS="$LIBS"
-    LIBS="$LIBS -lm -lpthread"
     AC_CHECK_LIB(vpx, vpx_codec_vp8_cx_algo, [
       HAVE_VP8=yes
       AC_DEFINE(HAVE_VP8_ENCODER, 1, [Defined if the VP8 encoder is available])
@@ -1523,10 +1523,10 @@ AG_GST_CHECK_FEATURE(VP8, [VP8 decoder], vp8, [
       AC_DEFINE(HAVE_VP8_DECODER, 1, [Defined if the VP8 decoder is available])
       VPX_LIBS="-lvpx"
     ])
-    LIBS="$OLD_LIBS"
   ])
   AC_SUBST(VPX_LIBS)
 ])
+LIBS="$LIBS"
 
 dnl *** rtmp ***
 translit(dnm, m, l) AM_CONDITIONAL(USE_RTMP, true)
