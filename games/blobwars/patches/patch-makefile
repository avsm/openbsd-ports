$OpenBSD: patch-makefile,v 1.3 2011/03/31 16:25:27 kili Exp $
--- makefile.orig	Sun Feb 13 18:22:20 2011
+++ makefile	Wed Mar 30 22:06:25 2011
@@ -1,15 +1,14 @@
 PROG = blobwars
 PAKNAME = blobwars.pak
-DOCS = doc/*
+DOCS = doc/*.{gif,png,html}
 ICONS = icons/
 
 VERSION = 1.18
 RELEASE = 1
-USEPAK = 0
+USEPAK = 1
 
-PREFIX=$(DESTDIR)/usr
-BINDIR = $(PREFIX)/games/
-DATADIR = $(PREFIX)/share/games/blobwars/
+BINDIR = $(PREFIX)/bin/
+DATADIR = $(PREFIX)/share/$(PROG)/data/
 DOCDIR = $(PREFIX)/share/doc/$(PROG)/
 ICONDIR = $(PREFIX)/share/icons/hicolor/
 DESKTOPDIR = $(PREFIX)/share/applications/
@@ -21,7 +20,7 @@ CXXFLAGS += `sdl-config --cflags` -DVERSION=$(VERSION)
 CXXFLAGS += -DPAKNAME=\"$(PAKNAME)\" -DPAKLOCATION=\"$(DATADIR)\" -DUNIX -DGAMEPLAYMANUAL=\"$(DOCDIR)index.html\" -Wall
 CXXFLAGS += -DLOCALEDIR=\"$(LOCALEDIR)\" -DMEDAL_SERVER_HOST=\"$(MEDAL_SERVER_HOST)\" -DMEDAL_SERVER_PORT=$(MEDAL_SERVER_PORT)
 CXXFLAGS += $(CFLAGS) -Werror
-LIBS = `sdl-config --libs` -lSDL_mixer -lSDL_image -lSDL_ttf -lSDL_net -lz
+LIBS = `sdl-config --libs` -lSDL_mixer -lSDL_image -lSDL_ttf -lSDL_net -lz -lintl -liconv
 
 OBJS += CAudio.o
 OBJS += CBoss.o
@@ -68,7 +67,7 @@ PAKOBJS = CFileData.o pak.o
 LOCALE_MO = $(patsubst %.po,%.mo,$(wildcard locale/*.po))
 
 # top-level rule to create the program.
-all: $(PROG) pak $(LOCALE_MO)
+all: $(PROG) buildpak $(LOCALE_MO)
 
 # compiling other source files.
 %.o: src/%.cpp src/%.h src/defs.h src/defines.h src/headers.h
@@ -96,30 +95,27 @@ buildpak: pak
 
 # install
 install:
+	$(BSD_INSTALL_PROGRAM_DIR) $(BINDIR)
+	$(BSD_INSTALL_DATA_DIR) $(DATADIR)
+	$(BSD_INSTALL_DATA_DIR) $(DOCDIR)
+	$(BSD_INSTALL_DATA_DIR) $(ICONDIR)16x16/apps
+	$(BSD_INSTALL_DATA_DIR) $(ICONDIR)32x32/apps
+	$(BSD_INSTALL_DATA_DIR) $(ICONDIR)64x64/apps
+	$(BSD_INSTALL_DATA_DIR) $(DESKTOPDIR)
+	$(BSD_INSTALL_PROGRAM) $(PROG) $(BINDIR)
+	$(BSD_INSTALL_DATA) $(PAKNAME) $(DATADIR)
+	$(BSD_INSTALL_DATA) $(DOCS) $(DOCDIR)
+	$(BSD_INSTALL_DATA) $(ICONS)$(PROG).png $(ICONDIR)32x32/apps
+	$(BSD_INSTALL_DATA) $(ICONS)$(PROG)-mini.png \
+		$(ICONDIR)16x16/apps/$(PROG).png
+	$(BSD_INSTALL_DATA) $(ICONS)$(PROG)-large.png \
+		$(ICONDIR)64x64/apps/$(PROG).png
+	$(BSD_INSTALL_DATA) $(ICONS)$(PROG).desktop $(DESKTOPDIR)
 
-	./pak data gfx music sound $(PAKNAME)
-
-	mkdir -p $(BINDIR)
-	mkdir -p $(DATADIR)
-	mkdir -p $(DOCDIR)
-	mkdir -p $(ICONDIR)16x16/apps
-	mkdir -p $(ICONDIR)32x32/apps
-	mkdir -p $(ICONDIR)64x64/apps
-	mkdir -p $(DESKTOPDIR)
-
-	install -o root -g games -m 755 $(PROG) $(BINDIR)$(PROG)
-	install -o root -g games -m 644 $(PAKNAME) $(DATADIR)$(PAKNAME)
-	install -o root -g games -m 644 $(DOCS) $(DOCDIR)
-	cp $(ICONS)$(PROG).png $(ICONDIR)32x32/apps/
-	cp $(ICONS)$(PROG)-mini.png $(ICONDIR)16x16/apps/$(PROG).png
-	cp $(ICONS)$(PROG)-large.png $(ICONDIR)64x64/apps/$(PROG).png
-	cp $(ICONS)$(PROG).desktop $(DESKTOPDIR)
-
 	@for f in $(LOCALE_MO); do \
 		lang=`echo $$f | sed -e 's/^locale\///;s/\.mo$$//'`; \
-		mkdir -p $(LOCALEDIR)$$lang/LC_MESSAGES; \
-		echo "cp $$f $(LOCALEDIR)$$lang/LC_MESSAGES/$(PROG).mo"; \
-		cp $$f $(LOCALEDIR)$$lang/LC_MESSAGES/$(PROG).mo; \
+		$(BSD_INSTALL_DATA_DIR) $(LOCALEDIR)$$lang/LC_MESSAGES; \
+		$(BSD_INSTALL_DATA) $$f $(LOCALEDIR)$$lang/LC_MESSAGES/$(PROG).mo; \
 	done
 
 uninstall:
