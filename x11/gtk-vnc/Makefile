# $OpenBSD: Makefile,v 1.26 2011/03/07 19:31:10 ajacoutot Exp $

COMMENT-main=		VNC viewer widget for GTK
COMMENT-plugin=		gtk-vnc browser plugin

GNOME_PROJECT=		gtk-vnc
GNOME_VERSION=		0.4.3

PKGNAME-main=		${DISTNAME}
PKGNAME-plugin=		gtk-vnc-plugin-${GNOME_VERSION}

SHARED_LIBS +=	gtk-vnc-1.0          2.0 # .0.1
SHARED_LIBS +=  gvnc-1.0             0.0 # 0.1

CATEGORIES=		x11 net

HOMEPAGE=		http://live.gnome.org/gtk-vnc

# LGPLv2.1
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM= Yes
PERMIT_DISTFILES_FTP=	Yes

MODULES=		devel/gettext \
			lang/python \
			x11/gnome

WANTLIB=	X11 Xau Xcomposite Xcursor Xdamage Xdmcp Xext Xfixes \
		Xi Xinerama Xrandr Xrender atk-1.0 cairo expat fontconfig \
		freetype gcrypt gdk-x11-2.0 gdk_pixbuf-2.0 gio-2.0 \
		glib-2.0 gmodule-2.0 gobject-2.0 gpg-error gthread-2.0 \
		gtk-x11-2.0 m pango-1.0 pangocairo-1.0 pangoft2-1.0 \
		pcre pixman-1 png tasn1 z pthread-stubs xcb xcb-render \
		GL Xxf86vm drm xcb-shm

MULTI_PACKAGES=		-main -plugin

BUILD_DEPENDS=		${RUN_DEPENDS-main} \
			devel/xulrunner/1.9,-devel>=1.9.1

LIB_DEPENDS=		security/gnutls \
			security/cyrus-sasl2

RUN_DEPENDS-main=	x11/py-gtk2
WANTLIB-main += ${WANTLIB} c ffi pthread gnutls>=13 sasl2>=2

LIB_DEPENDS-plugin=	${LIB_DEPENDS} \
			${BASE_PKGPATH}
WANTLIB-plugin += ${WANTLIB} gvnc-1.0 gtk-vnc-1.0 gnutls sasl2

CONFIGURE_STYLE=	gnu
CONFIGURE_ARGS=		${CONFIGURE_SHARED} \
			--disable-introspection \
			--with-examples \
			--with-python \
			--with-sasl \
			--without-libview \
			--enable-plugin=yes \
			--with-gtk=2.0
CONFIGURE_ENV+=		CPPFLAGS="-I${LOCALBASE}/include" \
			LDFLAGS="-L${LOCALBASE}/lib" \
			MOZILLA_PLUGIN_CFLAGS="-I${LOCALBASE}/xulrunner1.9/include/ \
				-I${LOCALBASE}/include/nspr" \
			MOZILLA_PLUGIN_LIBS="-L${LOCALBASE}/xulrunner1.9"

USE_GROFF =		Yes

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/gtk-vnc
	${INSTALL_DATA} ${WRKSRC}/plugin/README \
		${PREFIX}/share/examples/gtk-vnc/README.plugin

.include <bsd.port.mk>
