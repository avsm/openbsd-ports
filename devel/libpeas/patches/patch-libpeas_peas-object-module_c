$OpenBSD: patch-libpeas_peas-object-module_c,v 1.1 2011/09/26 20:37:06 jasper Exp $

From 4b676359b6450c5c00941d94f3db5b371fb2784c Mon Sep 17 00:00:00 2001
From: Garrett Regier <garrettregier@gmail.com>
Date: Thu, 22 Sep 2011 12:53:26 +0000
Subject: Bind plugin module symbols globally

--- libpeas/peas-object-module.c.orig	Wed Sep 21 13:23:39 2011
+++ libpeas/peas-object-module.c	Mon Sep 26 22:30:58 2011
@@ -89,7 +89,10 @@ peas_object_module_load (GTypeModule *gmodule)
   if (G_MODULE_SUFFIX[0] != '\0' && g_str_has_suffix (path, "." G_MODULE_SUFFIX))
     path[strlen (path) - strlen (G_MODULE_SUFFIX) - 1] = '\0';
 
-  module->priv->library = g_module_open (path, G_MODULE_BIND_LOCAL);
+  /* Bind symbols globally and immediately,
+   * binding locally broke the Python plugin loader.
+   */
+  module->priv->library = g_module_open (path, 0);
   g_free (path);
 
   if (module->priv->library == NULL)
