$OpenBSD: patch-libavcodec_Makefile,v 1.16 2008/01/26 01:56:02 jakemsr Exp $
--- libavcodec/Makefile.orig	Fri Jan 18 01:21:38 2008
+++ libavcodec/Makefile	Mon Jan 21 14:19:24 2008
@@ -431,6 +431,9 @@ ALTIVEC-OBJS-$(CONFIG_WMV3_DECODER)    += ppc/vc1dsp_a
 # -maltivec is needed in order to build AltiVec code.
 $(ALTIVEC-OBJS-yes): CFLAGS += -maltivec -mabi=altivec
 
+# compiler optimizations cause problems
+ppc/mpegvideo_altivec.o: CFLAGS += -O
+
 # check_altivec must be built without -maltivec
 OBJS-$(HAVE_ALTIVEC)                   += $(ALTIVEC-OBJS-yes)       \
                                           ppc/check_altivec.o
@@ -444,10 +447,11 @@ ASM_OBJS-$(ARCH_BFIN)                  += bfin/pixels_
                                           bfin/idct_bfin.o   \
                                           bfin/vp3_idct_bfin.o   \
 
-EXTRALIBS := -L$(BUILD_ROOT)/libavutil -lavutil$(BUILDSUF) $(EXTRALIBS)
+#EXTRALIBS := -L$(BUILD_ROOT)/libavutil -lavutil$(BUILDSUF) $(EXTRALIBS)
+EXTRALIBS=${LIBavcodec_EXTRALIBS}
 
 NAME=avcodec
-LIBVERSION=$(LAVCVERSION)
+LIBVERSION=$(LIBavcodec_VERSION)
 LIBMAJOR=$(LAVCMAJOR)
 
 include ../common.mak
@@ -482,7 +486,7 @@ dct-test: dct-test.o fdctref.o $(LIBNAME)
 fft-test: fft-test.o $(LIBNAME)
 
 imgresample-test: imgresample.c $(LIBNAME)
-	$(CC) $(CFLAGS) -DTEST -o $@ $^ $(EXTRALIBS)
+	$(CC) $(CFLAGS) -DTEST -o $@ $^ $(LIBavcodec_EXTRALIBS)
 
 motion-test: motion-test.o $(LIBNAME)
 
