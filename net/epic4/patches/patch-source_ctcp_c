$OpenBSD: patch-source_ctcp_c,v 1.1 2003/11/13 21:11:11 margarida Exp $
--- source/ctcp.c.orig	2000-12-05 00:11:56.000000000 +0000
+++ source/ctcp.c	2003-11-13 17:30:10.000000000 +0000
@@ -897,7 +897,8 @@ void	send_ctcp (int type, char *to, int 
 	int	len;
 
 	/* Make sure that the final \001 doesnt get truncated */
-	len = IRCD_BUFFER_SIZE - (12 + strlen(to));
+	if ((len = IRCD_BUFFER_SIZE - (12 + strlen(to))) < 0)
+		return;
 	putbuf2 = alloca(len);
 
 	if (format)
