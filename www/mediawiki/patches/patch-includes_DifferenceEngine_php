$OpenBSD: patch-includes_DifferenceEngine_php,v 1.1 2007/12/19 10:29:49 winiger Exp $
--- includes/DifferenceEngine.php.orig	Wed Dec 19 10:32:01 2007
+++ includes/DifferenceEngine.php	Wed Dec 19 10:32:50 2007
@@ -164,11 +164,12 @@ CONTROL;
 				$rcid = $this->mRcidMarkPatrolled;
 			} else {
 				// Look for an unpatrolled change corresponding to this diff
+				$db = wfGetDB( DB_SLAVE );
 				$change = RecentChange::newFromConds(
 					array(
 						// Add redundant timestamp condition so we can use the
 						// existing index
-						'rc_timestamp' => $this->mNewRev->getTimestamp(),
+						'rc_timestamp' => $db->timestamp( $this->mNewRev->getTimestamp() ),
 						'rc_this_oldid' => $this->mNewid,
 						'rc_last_oldid' => $this->mOldid,
 						'rc_patrolled' => 0,
