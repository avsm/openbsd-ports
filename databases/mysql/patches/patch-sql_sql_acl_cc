$OpenBSD: patch-sql_sql_acl_cc,v 1.3 2004/10/20 07:36:04 brad Exp $
--- sql/sql_acl.cc.orig	Thu May 13 20:53:35 2004
+++ sql/sql_acl.cc	Wed Oct 20 00:50:19 2004
@@ -834,7 +834,7 @@ static void acl_insert_db(const char *us
 */
 
 ulong acl_get(const char *host, const char *ip, const char *bin_ip,
-	     const char *user, const char *db)
+	     const char *user, const char *db, my_bool db_is_pattern)
 {
   ulong host_access,db_access;
   uint i,key_length;
@@ -868,7 +868,7 @@ ulong acl_get(const char *host, const ch
     {
       if (compare_hostname(&acl_db->host,host,ip))
       {
-	if (!acl_db->db || !wild_compare(db,acl_db->db))
+	if (!acl_db->db || !wild_compare(db,acl_db->db,db_is_pattern))
 	{
 	  db_access=acl_db->access;
 	  if (acl_db->host.hostname)
@@ -890,7 +890,7 @@ ulong acl_get(const char *host, const ch
     ACL_HOST *acl_host=dynamic_element(&acl_hosts,i,ACL_HOST*);
     if (compare_hostname(&acl_host->host,host,ip))
     {
-      if (!acl_host->db || !wild_compare(db,acl_host->db))
+      if (!acl_host->db || !wild_compare(db,acl_host->db,0))
       {
 	host_access=acl_host->access;		// Fully specified. Take it
 	break;
@@ -1222,7 +1222,7 @@ static bool compare_hostname(const acl_h
   }
   return (!host->hostname ||
 	  (hostname && !wild_case_compare(hostname,host->hostname)) ||
-	  (ip && !wild_compare(ip,host->hostname)));
+	  (ip && !wild_compare(ip,host->hostname,0)));
 }
 
 
@@ -1300,7 +1300,7 @@ static bool test_if_create_new_users(THD
     tl.db=	   (char*) "mysql";
     tl.real_name=  (char*) "user";
     db_access=acl_get(thd->host, thd->ip, (char*) &thd->remote.sin_addr,
-		      thd->priv_user, tl.db);
+		      thd->priv_user, tl.db, 0);
     if (!(db_access & INSERT_ACL))
     {
       if (check_grant(thd,INSERT_ACL,&tl,0,1))
