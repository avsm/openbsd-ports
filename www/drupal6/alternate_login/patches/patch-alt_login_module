$OpenBSD: patch-alt_login_module,v 1.1 2009/07/27 13:23:28 espie Exp $
--- alt_login.module.orig	Mon Jul 27 15:20:34 2009
+++ alt_login.module	Mon Jul 27 15:22:08 2009
@@ -111,7 +111,7 @@ function _alt_login_validate($uid, $edit) {
   $alt_login = isset($edit['alt_login']) ? $edit['alt_login'] : NULL;
 
   // Make sure user can't set their username to an exiting alt_login name.
-  if (db_result(db_query("SELECT alt_login FROM {alt_login} WHERE alt_login = '%s'", $edit['name']))) {
+  if (db_result(db_query("SELECT alt_login FROM {alt_login} WHERE alt_login = '%s' and  uid != %d", $edit['name'], $uid))) {
     form_set_error('name', t('The name %name is already in use.', array('%name' => $edit['name'])));
   }
 
@@ -122,7 +122,7 @@ function _alt_login_validate($uid, $edit) {
     }
 
     // Make sure the name isn't already taken as either another alt login or username.
-    if (db_result(db_query("SELECT uid FROM {alt_login} WHERE alt_login = '%s' AND uid != %d", $alt_login, $uid)) || db_result(db_query("SELECT uid FROM {users} WHERE name = '%s'", $alt_login))) {
+    if (db_result(db_query("SELECT uid FROM {alt_login} WHERE alt_login = '%s' AND uid != %d", $alt_login, $uid)) || db_result(db_query("SELECT uid FROM {users} WHERE name = '%s' and uid != %d", $alt_login, $uid))) {
       form_set_error('alt_login', t('The name %name is already in use.', array('%name' => $alt_login)));
     }
 
@@ -247,4 +247,4 @@ function _alt_login_register_submit($uid, &$edit) {
     db_query("INSERT INTO {alt_login} (uid, alt_login) VALUES (%d, '%s')", $uid, $alt_login);
   }
   unset($edit['alt_login']);
-}
\ No newline at end of file
+}
