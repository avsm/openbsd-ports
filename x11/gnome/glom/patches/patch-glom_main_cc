$OpenBSD: patch-glom_main_cc,v 1.2 2011/09/29 20:57:45 jasper Exp $

From bf111b2f3d39fa8aa27a6b3e6778ae8f987cad8f Mon Sep 17 00:00:00 2001
From: Jasper Lievisse Adriaanse <jasper@humppa.nl>
Date: Thu, 29 Sep 2011 20:54:56 +0000
Subject: Hide __libc_freeres on system which don't have glibc.

https://bugzilla.gnome.org/show_bug.cgi?id=660496

--- glom/main.cc.orig	Thu Sep 29 14:32:56 2011
+++ glom/main.cc	Thu Sep 29 14:33:56 2011
@@ -373,18 +373,19 @@ bool check_pygda_is_available_with_warning()
 
 } //namespace Glom
 
-#ifndef G_OS_WIN32
+#ifdef __linux__
 extern "C" void __libc_freeres(void);
 #endif
 
 int
 main(int argc, char* argv[])
 {
-#ifndef G_OS_WIN32
+#ifdef __linux__
   //Force some cleanup at exit,
   //to help valgrind to detect memory leaks:
   atexit(__libc_freeres);
 #else
+#  ifdef G_OS_WIN32
   WSADATA data;
   int errcode = WSAStartup(MAKEWORD(2, 0), &data);
   if(errcode != 0)
@@ -396,6 +397,7 @@ main(int argc, char* argv[])
   gchar* installation_dir_c = g_win32_get_package_installation_directory_of_module(0);
   const std::string installation_dir(installation_dir_c);
   g_free(installation_dir_c);
+#  endif
 #endif
 
   // TODO: I am not sure why, but this does not work. PYTHONPATH is set
