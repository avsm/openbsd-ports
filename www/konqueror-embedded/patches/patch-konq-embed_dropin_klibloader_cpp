$OpenBSD: patch-konq-embed_dropin_klibloader_cpp,v 1.2 2002/03/18 03:24:34 espie Exp $
--- konq-embed/dropin/klibloader.cpp.orig	Fri Oct 12 01:03:53 2001
+++ konq-embed/dropin/klibloader.cpp	Mon Mar 18 04:14:44 2002
@@ -25,6 +25,8 @@
 
 #include "klibloader.h"
 
+#include <stdlib.h>
+#include <string.h>
 #include <assert.h>
 
 #if defined(HAVE_DLFCN)
@@ -85,6 +87,17 @@ KDLOpenLibrary::~KDLOpenLibrary()
 void *KDLOpenLibrary::symbol( const char *name )
 {
     void *res = dlsym( m_handle, name );
+#ifdef __OpenBSD__
+    if ( !res ) {
+    	char *name2 = (char *)malloc(strlen(name)+2);
+	if (name2) {
+	    name2[0] = '_';
+	    strcpy(name2+1, name);
+	    res = dlsym( m_handle, name2);
+	    free(name2);
+	}
+    }
+#endif
     if ( !res )
         res = KLibrary::symbol( name );
     return res;
@@ -119,6 +132,9 @@ KLibrary *KLibLoader::library( const cha
 
 KLibrary *KLibLoader::globalLibrary( const char *name )
 {
+#ifndef RTLD_GLOBAL
+# define RTLD_GLOBAL 0
+#endif 
 #if defined(HAVE_DLFCN)
     void *handle = dlopen( name, RTLD_LAZY | RTLD_GLOBAL );
     if ( !handle )
