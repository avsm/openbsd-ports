$OpenBSD: patch-src_trackerd_tracker-monitor_c,v 1.2 2010/03/21 10:41:37 ajacoutot Exp $

Fix a segfault where there is no monitor running.

--- src/trackerd/tracker-monitor.c.orig	Thu Feb  4 11:25:44 2010
+++ src/trackerd/tracker-monitor.c	Thu Feb  4 14:09:19 2010
@@ -216,6 +216,7 @@ tracker_monitor_init (TrackerMonitor *object)
 	GFileMonitor	      *monitor;
 	GList		      *all_modules, *l;
 	const gchar	      *name;
+	GError	    	      *error = NULL;
 
 	object->private = TRACKER_MONITOR_GET_PRIVATE (object);
 
@@ -284,7 +285,17 @@ tracker_monitor_init (TrackerMonitor *object)
 	monitor = g_file_monitor_directory (file,
 					    G_FILE_MONITOR_WATCH_MOUNTS,
 					    NULL,
-					    NULL);
+					    &error);
+
+	/* Directory monitoring is missing, error out, don't crash. */
+	if (error) {
+		g_critical ("Could not obtain monitor: %s", error->message);
+		g_error_free (error);
+
+		exit (EXIT_FAILURE);
+		return FALSE;
+	}
+		
 
 	priv->monitor_backend = G_OBJECT_TYPE (monitor);
 
