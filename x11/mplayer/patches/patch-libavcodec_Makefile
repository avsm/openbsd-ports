$OpenBSD: patch-libavcodec_Makefile,v 1.8 2009/10/11 13:36:23 edd Exp $
--- libavcodec/Makefile.orig	Tue Jul  7 02:33:53 2009
+++ libavcodec/Makefile	Mon Jul 20 17:53:46 2009
@@ -575,4 +575,27 @@ DIRS = alpha arm bfin mlib ppc ps2 sh4 sparc x86
 
 include $(SUBDIR)../subdir.mak
 
+ifdef ARCH_X86_32
+ifeq (,$(findstring -O,$(CFLAGS)))
+x86/dsputil_mmx.o: CFLAGS += -O
+x86/flacdsp_mmx.o: CFLAGS += -O
+x86/fft_3dn.o: CFLAGS += -O
+x86/fft_3dn2.o: CFLAGS += -O
+x86/mlpdsp.o: CFLAGS += -O
+x86/snowdsp_mmx.o: CFLAGS += -O
+h264.o: CFLAGS += -O
+h264_parser.o: CFLAGS += -O
+cabac.o: CFLAGS += -O
+endif
+x86/dsputil_mmx.o: CFLAGS += -fomit-frame-pointer
+x86/flacdsp_mmx.o: CFLAGS += -fomit-frame-pointer
+x86/fft_3dn.o: CFLAGS += -fomit-frame-pointer
+x86/fft_3dn2.o: CFLAGS += -fomit-frame-pointer
+x86/mlpdsp.o: CFLAGS += -fomit-frame-pointer
+x86/snowdsp_mmx.o: CFLAGS += -fomit-frame-pointer
+h264.o: CFLAGS += -fomit-frame-pointer
+h264_parser.o: CFLAGS += -fomit-frame-pointer
+cabac.o: CFLAGS += -fomit-frame-pointer
+endif
+
 $(SUBDIR)dct-test$(EXESUF): $(SUBDIR)dctref.o
