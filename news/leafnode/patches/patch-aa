--- Makefile.orig	Fri Jan  8 22:27:53 1999
+++ Makefile	Wed Jan 13 20:14:31 1999
@@ -6,7 +6,7 @@
 CFLAGS = $(DEBUG)
 LIBS =
 # LIBS = -lnsl -lsocket		# for Solaris 2.6
-PREFIX_USR = /usr/local
+PREFIX_USR = $(PREFIX)
 PREFIX_VAR = /var
 USRDIR = $(PREFIX_USR)/bin
 BINDIR = $(PREFIX_USR)/sbin
@@ -18,11 +18,13 @@
 #
 # this is the directory where the configuration and group information is
 # kept.  It should preferably not be on the same partition as spooldir
-LIBDIR = /usr/lib/leafnode
+LIBDIR = $(PREFIX_USR)/lib/leafnode
+ETCDIR = /etc/leafnode
 #
 # This is the lock file for fetch.  The normal locations for such lock
 # files are /var/run or /var/lock.
-LOCKFILE = "/var/lock/news/fetch.lck"
+LOCKDIR = $(PREFIX_VAR)/run/news
+LOCKFILE = $(LOCKDIR)/fetch.lck
 
 LIBFILES = nntputil.o configutil.o xoverutil.o activutil.o miscutil.o \
 	   artutil.o filterutil.o
@@ -66,28 +68,24 @@
 
 config.o: config.c Makefile
 	$(CC) -c -DSPOOLDIR=\"$(SPOOLDIR)\" \
-		-DLIBDIR=\"$(LIBDIR)\" \
+		-DLIBDIR=\"$(ETCDIR)\" \
 		-DBINDIR=\"$(BINDIR)\" \
 		-DLOCKFILE=\"$(LOCKFILE)\" \
 		-DVERSION=\"$(VERSION)\" $<
 
 install: nntpd fetch texpire checkgroups
-	install -d -o root -g root -m 755 $(MANDIR)/man1
-	install -d -o root -g root -m 755 $(MANDIR)/man8
-	install -d -o root -g bin -m 755 $(BINDIR)
 	install -g news -m 750 -o news -s nntpd $(BINDIR)/leafnode
 	install -g news -m 750 -o news -s fetch $(BINDIR)/fetch
 	install -g news -m 750 -o news -s texpire $(BINDIR)/texpire
 	install -g news -m 750 -o news -s checkgroups $(BINDIR)/checkgroups
-	install -g news -m 750 -o news -s newsq $(USRDIR)/newsq
-	cp *.8 $(MANDIR)/man8
-	cp *.1 $(MANDIR)/man1
-	-mkdir -p `dirname $(LOCKFILE)`
-	chown news.news `dirname $(LOCKFILE)`
-	-mkdir -p $(SPOOLDIR) $(LIBDIR)
+	install -g news -m 750 -o news newsq $(USRDIR)/newsq
+	$(BSD_INSTALL_MAN) *.8 $(MANDIR)/man8
+	$(BSD_INSTALL_MAN) *.1 $(MANDIR)/man1
+	install -d -g news -o news $(LOCKDIR)
+	-mkdir -p $(SPOOLDIR) $(LIBDIR) $(ETCDIR)
 	-mkdir -p $(SPOOLDIR)/leaf.node
 	-mkdir -p $(SPOOLDIR)/{message.id,interesting.groups,out.going}
-	-chown news.news $(SPOOLDIR) $(LIBDIR)
+	-chown news.news $(SPOOLDIR)
 	-chown news.news $(SPOOLDIR)/leaf.node
 	-chown news.news $(SPOOLDIR)/{message.id,interesting.groups,out.going}
 	cd $(SPOOLDIR)/message.id ; for a in 0 1 2 3 4 5 6 7 8 9 ; do \
@@ -101,10 +99,21 @@
 				$${a}$${b}6 $${a}$${b}7 $${a}$${b}8 \
 				$${a}$${b}9 ; \
 			done ; done
-	cp config.example $(LIBDIR)
+	${BSD_INSTALL_DATA} README INSTALL config.example $(LIBDIR)
+	test -f $(ETCDIR)/config || \
+		${BSD_INSTALL_DATA} config.example $(ETCDIR)/config
 	chmod 2755 $(SPOOLDIR)
-	@echo Edit /etc/inetd.conf to start $(BINDIR)/leafnode and restart inetd
-	@echo If you update from a leafnode version \< 1.6, do a "make update"
+	@echo "*** edit /etc/inetd.conf to start $(BINDIR)/leafnode"
+
+	@echo "*** Verify $(ETCDIR)/config -- a copy of which is saved"
+	@echo "*** as $(LIBDIR)/config.example."
+	@echo "*** See $(LIBDIR)/README" and
+	@echo "*** $(LIBDIR)/INSTALL for more information"
+	@echo "### You may need to add"
+	@echo "### \"install -d -g news -o news /var/run/news\""
+	@echo "### to /etc/rc.local"
+	@echo "*** if you update from a leafnode version < 1.6, do a \"make update\""
+	@echo ""
 
 uninstall:
 	-rm $(BINDIR)/{fetch,checkgroups,texpire,leafnode}
