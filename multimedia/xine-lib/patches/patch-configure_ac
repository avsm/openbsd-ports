$OpenBSD: patch-configure_ac,v 1.6 2010/03/21 01:41:15 sthen Exp $
--- configure.ac.orig	Sat Mar  6 14:31:25 2010
+++ configure.ac	Fri Mar 12 19:26:43 2010
@@ -564,9 +564,9 @@ t q
 b
 :q
 q"
-x_lib_location="`ls -1 "${x_libraries:-/usr/local/lib}/libX11.so"* "${x_libraries:-/usr/lib}/libX11.so"* 2>/dev/null | sed -e \"${soname_script}\"`"
+x_lib_location="`ls -1 "${x_libraries:-/usr/local/lib}/libX11.so"* "${x_libraries:-/usr/lib}/libX11.so"* 2>/dev/null | sed 1q`"
 AC_DEFINE_UNQUOTED([LIBX11_SO], "${x_lib_location:-libX11.so}", [The soname of libX11, needed for dlopen()])
-x_lib_location="`ls -1 "${x_libraries:-/usr/local/lib}/libXv.so"*  "${x_libraries:-/usr/lib}/libXv.so"*  2>/dev/null | sed -e \"${soname_script}\"`"
+x_lib_location="`ls -1 "${x_libraries:-/usr/local/lib}/libXv.so"*  "${x_libraries:-/usr/lib}/libXv.so"*  2>/dev/null | sed 1q`"
 AC_DEFINE_UNQUOTED([LIBXV_SO],  "${x_lib_location:-libXv.so}",  [The soname of libXv, needed for dlopen()])
 
 
@@ -698,7 +698,7 @@ dnl ----------------------------------------------
 AC_ARG_ENABLE([libv4l],
 	AS_HELP_STRING([--disable-libv4l], [do not build with libv4l support]))
 
-if test "x$have_v4l2" = xyes; then
+if test "x$have_v4l2" = xyes && test "x$enable_libv4l" != xno; then
   have_libv4l=no
   PKG_CHECK_MODULES([V4L2], [libv4l2],
 	[have_libv4l=yes
@@ -1308,7 +1308,7 @@ if test "x$enable_a52dec" = "xno"; then
   AC_MSG_RESULT([a52dec support disabled])
 elif test "x$external_a52dec" = "xyes"; then
   have_a52="yes"
-  AC_CHECK_HEADERS([a52dec/a52.h a52dec/a52_internal.h],, have_a52="no",
+  AC_CHECK_HEADERS([a52dec/a52.h],, have_a52="no",
 [
   #ifdef HAVE_SYS_TYPES_H
   # include <sys/types.h>
@@ -1401,9 +1401,10 @@ if test "x$with_mng" = "xyes"; then
   AC_CHECK_LIB(mng, mng_initialize,
 	[ AC_CHECK_HEADER(libmng.h,
 		[ have_libmng=yes
-		  MNG_LIBS="-lmng" ], 
+		  MNG_LIBS="-lmng -llcms -ljpeg -lz -lm" ], 
 		AC_MSG_RESULT([*** All libmng dependent parts will be disabled ***]))],
-	AC_MSG_RESULT([*** All libmng dependent parts will be disabled ***]))
+	AC_MSG_RESULT([*** All libmng dependent parts will be disabled ***]),
+	[-llcms -ljpeg -lz -lm])
   AC_SUBST(MNG_LIBS)
 else
   have_libmng=no
@@ -2909,6 +2910,9 @@ if test "x$no_gnome_vfs" = "xno"; then
 fi
 if test "x$have_v4l" = "xyes"; then
   echo "   - v4l"
+fi
+if test "x$have_v4l2" = "xyes"; then
+  echo "   - v4l2"
 fi
 if test "x$have_libsmbclient" = "xyes"; then
   echo "   - smbclient"
