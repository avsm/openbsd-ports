$OpenBSD: patch-sim_ether_c,v 1.4 2005/10/24 15:53:26 fgsch Exp $
--- sim_ether.c.orig	Wed Sep  7 08:50:26 2005
+++ sim_ether.c	Mon Oct 24 12:14:39 2005
@@ -588,6 +588,12 @@ int pcap_sendpacket(pcap_t* handle, cons
 }
 #endif /* !HAS_PCAP_SENDPACKET */
 
+int pcap_setnonblock(pcap_t* handle, int nonblock, char *errbuf)
+{
+  fcntl(pcap_fileno(handle), F_SETFL, fcntl(pcap_fileno(handle), F_GETFL, 0) | O_NONBLOCK);
+  return 0;
+}
+
 #if defined (USE_READER_THREAD)
 #include <pthread.h>
 
@@ -1155,12 +1161,13 @@ int eth_host_devices(int used, int max, 
 
 int eth_devices(int max, ETH_LIST* list)
 {
+  int i = 0;
+
+#ifndef DONT_USE_PCAP_FINDALLDEVS
   pcap_if_t* alldevs;
   pcap_if_t* dev;
-  int i = 0;
   char errbuf[PCAP_ERRBUF_SIZE];
 
-#ifndef DONT_USE_PCAP_FINDALLDEVS
   /* retrieve the device list */
   if (pcap_findalldevs(&alldevs, errbuf) == -1) {
     char* msg = "Eth: error in pcap_findalldevs: %s\r\n";
