$OpenBSD: patch-source_ctcp_c,v 1.1.4.1 2003/11/13 21:13:37 margarida Exp $
--- source/ctcp.c.orig	Tue Dec  5 00:11:56 2000
+++ source/ctcp.c	Thu Nov 13 17:24:55 2003
@@ -897,7 +897,8 @@ void	send_ctcp (int type, char *to, int 
 	int	len;
 
 	/* Make sure that the final \001 doesnt get truncated */
-	len = IRCD_BUFFER_SIZE - (12 + strlen(to));
+	if ((len = IRCD_BUFFER_SIZE - (12 + strlen(to))) < 0)
+		return;
 	putbuf2 = alloca(len);
 
 	if (format)
