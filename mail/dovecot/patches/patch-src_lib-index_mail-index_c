$OpenBSD: patch-src_lib-index_mail-index_c,v 1.3 2009/10/30 11:43:48 sthen Exp $
--- src/lib-index/mail-index.c.orig	Thu Oct 29 23:13:10 2009
+++ src/lib-index/mail-index.c	Thu Oct 29 23:14:23 2009
@@ -347,6 +347,11 @@ static int mail_index_open_files(struct mail_index *in
 		}
 
 		ret = mail_transaction_log_create(index->log, FALSE);
+		if (index->map != NULL) {
+			/* log creation could have changed it if someone else
+			   just created it. */
+			index->map->hdr.indexid = index->indexid;
+		}
 		index->initial_create = FALSE;
 		created = TRUE;
 	}
