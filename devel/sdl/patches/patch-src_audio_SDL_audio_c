$OpenBSD: patch-src_audio_SDL_audio_c,v 1.15 2008/12/30 02:15:20 jakemsr Exp $
--- src/audio/SDL_audio.c.orig	Sun Dec 30 20:47:59 2007
+++ src/audio/SDL_audio.c	Sun Dec 28 00:45:48 2008
@@ -36,6 +36,9 @@
 
 /* Available audio drivers */
 static AudioBootStrap *bootstrap[] = {
+#if SDL_AUDIO_DRIVER_LIBSNDIO
+	&LIBSNDIO_bootstrap,
+#endif
 #if SDL_AUDIO_DRIVER_BSD
 	&BSD_AUDIO_bootstrap,
 #endif
@@ -518,8 +521,9 @@ int SDL_OpenAudio(SDL_AudioSpec *desired, SDL_AudioSpe
 
 	/* See if we need to do any conversion */
 	if ( obtained != NULL ) {
-		SDL_memcpy(obtained, &audio->spec, sizeof(audio->spec));
-	} else if ( desired->freq != audio->spec.freq ||
+		SDL_memcpy(obtained, desired, sizeof(audio->spec));
+	}
+	if ( desired->freq != audio->spec.freq ||
                     desired->format != audio->spec.format ||
 	            desired->channels != audio->spec.channels ) {
 		/* Build an audio conversion block */
@@ -532,7 +536,7 @@ int SDL_OpenAudio(SDL_AudioSpec *desired, SDL_AudioSpe
 			return(-1);
 		}
 		if ( audio->convert.needed ) {
-			audio->convert.len = (int) ( ((double) desired->size) /
+			audio->convert.len = (int) ( ((double) audio->spec.size) /
                                           audio->convert.len_ratio );
 			audio->convert.buf =(Uint8 *)SDL_AllocAudioMem(
 			   audio->convert.len*audio->convert.len_mult);
