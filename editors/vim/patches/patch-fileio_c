--- fileio.c.orig	Mon Dec  4 22:12:39 2000
+++ fileio.c	Mon Dec  4 22:14:01 2000
@@ -3027,6 +3027,7 @@ write_lnum_adjust(offset)
 vim_tempname(extra_char)
     int	    extra_char;	    /* character to use in the name instead of '?' */
 {
+    int itmp_fd;
 #ifdef WIN32
     char	szTempFile[_MAX_PATH+1];
     char	buf4[4];
@@ -3076,8 +3077,10 @@ vim_tempname(extra_char)
 	    STRCAT(itmp, TEMPNAME);
 	    if ((p = vim_strchr(itmp, '?')) != NULL)
 		*p = extra_char;
-	    if (mktemp((char *)itmp) == NULL)
-		continue;
+	    if ((itmp_fd = mkstemp((char *)itmp)) == -1) 
+        	continue;
+	    else 
+		close(itmp_fd);
 	    return vim_strsave(itmp);
 	}
     }
