--- Makefile.in.orig	Thu Nov 26 11:03:29 1998
+++ Makefile.in	Thu Sep 14 10:15:18 2000
@@ -15,16 +15,19 @@
 CPPFLAGS      = $(INCLUDE_DIRS) $(DEFINES)
 
 # Installation directories (and install program)
+DESTDIR         = 
+
 prefix          = @prefix@
 exec_prefix     = @exec_prefix@
 INSTALL_INCLUDE = @includedir@
 INSTALL_LIBRARY = @libdir@
-INSTALL         = @INSTALL@
+INSTALL_DATA    = @INSTALL_DATA@
 
 # Other miscellaneous programs
 AR            = @AR@
 ARFLAGS       = -ru
 RANLIB        = @RANLIB@
+LIBTOOL       = libtool --quiet
 
 
 # Source for the library itself -- note that we define LIBSRC and
@@ -41,14 +44,14 @@
 
 # Other files of interest
 
-LIBRARY       = libmpeg.a
+LIBRARY       = libmpeg.la
 SHLIB         = libmpeg.so
 HEADER        = mpeg.h
 EXTRAS        = @extras@
 
 # Implicit targets
 .c.o:
-		$(CC) -c $(CFLAGS) $(CPPFLAGS) $<
+		$(LIBTOOL) --mode=compile $(CC) -c $(CFLAGS) $(CPPFLAGS) $<
 
 
 # Library/cleanup targets: 
@@ -60,20 +63,19 @@
 shlib:          $(SHLIB)
 
 $(LIBRARY):	$(LIBOBJ)
-		$(AR) $(ARFLAGS) $(LIBRARY) $(LIBOBJ)
-		$(RANLIB) $(LIBRARY)
+		$(LIBTOOL) --mode=link $(CC) $(CFLAGS) -o libmpeg.la \
+			$(LIBOBJ:.o=.lo) -version-info 13:1:0 -rpath $(INSTALL_LIBRARY)
+
 
 $(SHLIB):	$(LIBOBJ)
 		$(CC) -shared -o $(SHLIB) $(LIBOBJ)
 
 install:	$(LIBRARY)
-		$(INSTALL) -d $(INSTALL_INCLUDE) $(INSTALL_LIBRARY)
-		$(INSTALL) -m 0644 $(HEADER) $(INSTALL_INCLUDE)/$(HEADER)
-		$(INSTALL) -m 0644 $(LIBRARY) $(INSTALL_LIBRARY)/$(LIBRARY)
-		@if test -f $(SHLIB) ; then echo "warning: $(SHLIB) *not* installed (installing shared libraries is too system-specific)" ; fi
+		$(INSTALL_DATA) $(HEADER) $(DESTDIR)$(INSTALL_INCLUDE)
+		$(LIBTOOL) --mode=install $(INSTALL_DATA) libmpeg.la $(DESTDIR)$(INSTALL_LIBRARY)
 
 clean:
-		rm -f $(LIBRARY) $(EXTRAS) $(LIBOBJ) core
+		rm -f $(LIBRARY) $(SHLIB) $(EXTRAS) $(LIBOBJ) $(LIBOBJ:.o=.lo) core
 		cd extras && $(MAKE) clean
 
 distclean:	clean
