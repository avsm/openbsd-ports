$OpenBSD: patch-avahi-daemon_main_c,v 1.4 2010/07/31 14:33:20 ajacoutot Exp $
--- avahi-daemon/main.c.orig	Tue Jul 13 02:57:19 2010
+++ avahi-daemon/main.c	Sat Jul 31 16:06:23 2010
@@ -320,6 +320,11 @@ static void update_browse_domains(void) {
         return;
     }
 
+    if (!resolv_conf_search_domains) {
+	    avahi_server_set_browse_domains(avahi_server, NULL);
+	    return;
+    }
+
     l = avahi_string_list_copy(config.server_config.browse_domains);
 
     for (p = resolv_conf_search_domains, n = 0; *p && n < BROWSE_DOMAINS_MAX; p++, n++) {
@@ -1103,8 +1108,10 @@ static int run_server(DaemonConfig *c) {
 
     ignore_signal(SIGPIPE);
 
+#ifndef __OpenBSD__ // no NSS in OpenBSD
     if (!(nss_support = avahi_nss_support()))
         avahi_log_warn("WARNING: No NSS support for mDNS detected, consider installing nss-mdns!");
+#endif
 
     if (!(simple_poll_api = avahi_simple_poll_new())) {
         avahi_log_error("Failed to create main loop object.");
