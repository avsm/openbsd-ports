$OpenBSD: patch-base_utils_c,v 1.5 2009/01/09 18:24:35 henning Exp $
--- base/utils.c.orig	Fri Jan  9 14:20:10 2009
+++ base/utils.c	Fri Jan  9 14:28:24 2009
@@ -610,8 +610,16 @@ int my_system(char *cmd,int timeout,int *early_timeout
 				/* handle errors */
 				if(bytes_read==-1){
 					/* we encountered a recoverable error, so try again */
-					if(errno==EINTR || errno==EAGAIN)
+					if(errno==EINTR)
 						continue;
+					else if (errno == EAGAIN) {
+						struct pollfd	pfd;
+
+						pfd.fd = fd[0];
+						pfd.revents = POLLIN;
+						poll(&pfd, 1, -1);
+						continue;
+						}
 					else
 						break;
 					}
