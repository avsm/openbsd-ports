$OpenBSD: patch-qmake_generators_unix_unixmake2_cpp,v 1.2 2006/03/05 21:58:07 espie Exp $
--- qmake/generators/unix/unixmake2.cpp.orig	Thu Feb 16 11:51:34 2006
+++ qmake/generators/unix/unixmake2.cpp	Sun Mar  5 12:23:57 2006
@@ -200,10 +200,8 @@ UnixMakefileGenerator::writeMakeParts(QT
             t << "TARGETD       = " << var("TARGET_x.y") << endl;
             t << "TARGET0       = " << var("TARGET_") << endl;
         } else if(project->isEmpty("QMAKE_HPUX_SHLIB")) {
-            t << "TARGETD       = " << var("TARGET_x.y.z") << endl;
-            t << "TARGET0       = " << var("TARGET_") << endl;
-            t << "TARGET1       = " << var("TARGET_x") << endl;
-            t << "TARGET2       = " << var("TARGET_x.y") << endl;
+	    t << "LIB" << var("OBSD_TARGET_NAME") << "_VERSION = " << var("OBSD_TARGET_VERSION") << endl;
+            t << "TARGETD       = " << var("OBSD_TARGET_x.y") << endl;
         } else {
             t << "TARGETD       = " << var("TARGET_x") << endl;
             t << "TARGET0       = " << var("TARGET_") << endl;
@@ -490,31 +488,22 @@ UnixMakefileGenerator::writeMakeParts(QT
             t << endl << endl;
         } else if(project->isEmpty("QMAKE_HPUX_SHLIB")) {
             t << "\n\t"
-              << "-$(DEL_FILE) $(TARGET) $(TARGET0) $(TARGET1) $(TARGET2)" << "\n\t"
               << var("QMAKE_LINK_SHLIB_CMD") << "\n\t";
-            t << varGlue("QMAKE_LN_SHLIB","-"," "," $(TARGET) $(TARGET0)")  << "\n\t"
-              << varGlue("QMAKE_LN_SHLIB","-"," "," $(TARGET) $(TARGET1)") << "\n\t"
-              << varGlue("QMAKE_LN_SHLIB","-"," "," $(TARGET) $(TARGET2)");
             if(!destdir.isEmpty())
                 t << "\n\t"
                   << "-$(DEL_FILE) " << destdir << "$(TARGET)\n\t"
-                  << "-$(DEL_FILE) " << destdir << "$(TARGET0)\n\t"
-                  << "-$(DEL_FILE) " << destdir << "$(TARGET1)\n\t"
-                  << "-$(DEL_FILE) " << destdir << "$(TARGET2)\n\t"
-                  << "-$(MOVE) $(TARGET) $(TARGET0) $(TARGET1) $(TARGET2) " << destdir;
+                  << "-$(MOVE) $(TARGET) " << destdir;
             if(!project->isEmpty("QMAKE_POST_LINK"))
                 t << "\n\t" << var("QMAKE_POST_LINK");
             t << endl << endl;
         } else {
             t << "\n\t"
-              << "-$(DEL_FILE) $(TARGET) $(TARGET0)" << "\n\t"
+              << "-$(DEL_FILE) $(TARGET)" << "\n\t"
               << var("QMAKE_LINK_SHLIB_CMD") << "\n\t";
-            t << varGlue("QMAKE_LN_SHLIB",""," "," $(TARGET) $(TARGET0)");
             if(!destdir.isEmpty())
                 t  << "\n\t"
                    << "-$(DEL_FILE) " << destdir << "$(TARGET)\n\t"
-                   << "-$(DEL_FILE) " << destdir << "$(TARGET0)\n\t"
-                   << "-$(MOVE) $(TARGET) $(TARGET0) " << destdir;
+                   << "-$(MOVE) $(TARGET) " << destdir;
             if(!project->isEmpty("QMAKE_POST_LINK"))
                 t << "\n\t" << var("QMAKE_POST_LINK");
             t << endl << endl;
@@ -817,8 +806,7 @@ UnixMakefileGenerator::writeMakeParts(QT
         t << "\t-$(DEL_FILE) " << "$(TARGET)" << " " << endl;
     if(!project->isActiveConfig("staticlib") && project->variables()["QMAKE_APP_FLAG"].isEmpty() &&
        !project->isActiveConfig("plugin") && !project->isActiveConfig("compile_libtool"))
-        t << "\t-$(DEL_FILE) " << destdir << "$(TARGET0) " << destdir << "$(TARGET1) "
-          << destdir << "$(TARGET2) $(TARGETA)" << endl;
+        t << "\t-$(DEL_FILE) " << " $(TARGETA)" << endl;
     {
         QString ofile = Option::fixPathToTargetOS(fileFixify(Option::output.fileName()));
         if(!ofile.isEmpty())
@@ -870,6 +858,11 @@ void UnixMakefileGenerator::init2()
     project->variables()["VER_MAJ"].append(l[0]);
     project->variables()["VER_MIN"].append(l[1]);
     project->variables()["VER_PAT"].append(l[2]);
+
+    project->variables()["OBSD_TARGET_NAME"].append(project->first("TARGET"));
+    project->variables()["OBSD_TARGET_VERSION"].append(project->first("VER_MAJ") +  "."  + project->first("VER_MIN"));
+    project->variables()["OBSD_TARGET_x.y"].append("lib" + project->first("TARGET") + "." + project->first("QMAKE_EXTENSION_SHLIB") + ".$(LIB" + project->first("TARGET") + "_VERSION)");
+
     if(project->isEmpty("QMAKE_FRAMEWORK_VERSION"))
         project->variables()["QMAKE_FRAMEWORK_VERSION"].append(project->variables()["VER_MAJ"].first());
 
@@ -991,7 +984,7 @@ void UnixMakefileGenerator::init2()
                                                             project->first("VER_MIN") +  "." +
                                                             project->first("VER_PAT"));
             }
-            project->variables()["TARGET"] = project->variables()["TARGET_x.y.z"];
+            project->variables()["TARGET"] = project->variables()["OBSD_TARGET_x.y"];
         }
         if(project->isEmpty("QMAKE_LN_SHLIB"))
             project->variables()["QMAKE_LN_SHLIB"].append("ln -s");
