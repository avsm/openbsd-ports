$OpenBSD: patch-libgnomevfs_gnome-vfs-mime-magic_c,v 1.1 2003/06/12 19:53:49 marcm Exp $
--- libgnomevfs/gnome-vfs-mime-magic.c.orig	Thu May  1 19:49:03 2003
+++ libgnomevfs/gnome-vfs-mime-magic.c	Thu May  1 19:51:16 2003
@@ -29,8 +29,6 @@
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <stdlib.h>
-#include <wctype.h>
-#include <wchar.h>
 
 #include <glib/garray.h>
 #include <glib/gmessages.h>
@@ -759,50 +757,7 @@ _gnome_vfs_sniff_buffer_looks_like_text 
 	
  		if (g_utf8_get_char_validated(end, remaining_bytes) == -2)
 			return TRUE;
-		else {
-			size_t wlen;
-			wchar_t wc;
-			gchar *src, *end;
-			mbstate_t state;
-
-			src = sniff_buffer->buffer;
-			end = sniff_buffer->buffer + sniff_buffer->buffer_length;
-			
-			memset (&state, 0, sizeof (state));
-			while (src < end) {
-				/* Don't allow embedded zeros in textfiles */
-				if (*src == 0)
-					return FALSE;
-				
-				wlen = mbrtowc(&wc, src, end - src, &state);
-
-				if (wlen == (size_t)(-1)) {
-					/* Illegal mb sequence */
-					return FALSE;
-				}
-				
-				if (wlen == (size_t)(-2)) {
-					/* No complete mb char before end
-					 * Probably a cut off char which is ok */
-					return TRUE;
-				}
-
-				if (wlen == 0) {
-					/* Don't allow embedded zeros in textfiles */
-					return FALSE;
-				}
-				
-				if (!iswspace (wc)  && !iswprint(wc)) {
-					/* Not a printable or whitspace
-					 * Probably not a text file */
-					return FALSE;
-				}
-
-				src += wlen;
-			}
-			return TRUE;
-		}
-	} 
+	}
 }
 
 static int bitrates[2][15] = {
