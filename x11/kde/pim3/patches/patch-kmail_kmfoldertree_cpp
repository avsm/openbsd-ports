$OpenBSD: patch-kmail_kmfoldertree_cpp,v 1.1 2008/05/29 11:58:52 ajacoutot Exp $
--- kmail/kmfoldertree.cpp.orig	Fri Apr 18 17:42:59 2008
+++ kmail/kmfoldertree.cpp	Fri Apr 18 17:43:49 2008
@@ -1540,8 +1540,8 @@ void KMFolderTree::slotFolderExpanded( QListViewItem *
   {
     KMFolderImap *folder = static_cast<KMFolderImap*>( fti->folder()->storage() );
     // if we should list all folders we limit this to the root folder
-    if ( !folder->account()->listOnlyOpenFolders() &&
-         fti->parent() )
+    if ( !folder->account() || ( !folder->account()->listOnlyOpenFolders() &&
+         fti->parent() ) )
       return;
     if ( folder->getSubfolderState() == KMFolderImap::imapNoInformation )
     {
