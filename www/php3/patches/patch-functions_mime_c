$OpenBSD: patch-functions_mime_c,v 1.1 2002/02/27 16:31:59 brad Exp $
--- functions/mime.c.orig	Mon Oct 16 21:30:59 2000
+++ functions/mime.c	Wed Feb 27 10:12:11 2002
@@ -85,7 +85,9 @@ void php3_mime_split(char *buf, int cnt,
 					SAFE_RETURN;
 				}
 				loc = memchr(ptr, '\n', rem);
+				rem -= loc - ptr;
 				name = strstr(ptr, " name=");
+				ptr = loc;
 				if (name && name < loc) {
 					name += 6;
 					s = memchr(name, '\"', loc - name);
@@ -138,6 +140,10 @@ void php3_mime_split(char *buf, int cnt,
 						sprintf(lbuf, "%s_name[]", abuf);
 						sbuf=estrdup(abuf);
 					} else {
+						if (abuf) {
+							efree(abuf);
+							abuf = NULL;
+						}
 						sprintf(lbuf, "%s_name", namebuf);
 						sbuf=estrdup(namebuf);
 					}
