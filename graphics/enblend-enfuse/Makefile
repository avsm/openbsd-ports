# $OpenBSD: Makefile,v 1.7 2010/06/16 09:26:28 sthen Exp $

VMEM_WARNING =	Yes
# and I'm not joking! - don't waste build time on the following arch
# where MAXDSIZ is simply too low to compile this software:
NOT_FOR_ARCHS = m68k m88k sparc vax
# and restrict to -O0 for the largest files, except on selected arch
# (needs approx 1.3GB datasize to build with -O2 on 64-bit gcc4 arch)
.if (${MACHINE_ARCH} != "i386" && ${MACHINE_ARCH} != "amd64")
MAKE_ENV +=	CXXNOOPT=-O0
.endif

COMMENT =	blend seams in panoramic image mosaics

DISTNAME =	enblend-enfuse-3.2
PKGNAME =	${DISTNAME}p1
CATEGORIES =	graphics

HOMEPAGE =	http://enblend.sourceforge.net/

MAINTAINER =	Stuart Henderson <sthen@openbsd.org>

# GPLv2+, MIT
PERMIT_PACKAGE_CDROM =	Yes
PERMIT_PACKAGE_FTP =	Yes
PERMIT_DISTFILES_CDROM =Yes
PERMIT_DISTFILES_FTP =	Yes

WANTLIB =	GL GLU ICE SM X11 Xi Xmu c jpeg m pthread pthread-stubs xcb \
		stdc++ z

MASTER_SITES =	${MASTER_SITE_SOURCEFORGE:=enblend/}

BUILD_DEPENDS += ::devel/boost

LIB_DEPENDS =	GLEW::graphics/glew \
		glut.>=4::graphics/freeglut \
		Half,Iex,IlmThread,Imath::graphics/ilmbase \
		lcms::graphics/lcms \
		xmi::graphics/libxmi \
		IlmImf::graphics/openexr \
		png::graphics/png \
		tiff::graphics/tiff

CONFIGURE_STYLE = gnu
MODGNU_CONFIG_GUESS_DIRS = ${WRKSRC}

CPPFLAGS +=	-I${WRKSRC}/src/vigra_impex \
		-I${LOCALBASE}/include \
		-I${LOCALBASE}/include/libpng \
		-I${X11BASE}/include

LDFLAGS +=	-L${LOCALBASE}/lib \
		-L${X11BASE}/lib

USE_X11 =	Yes

CONFIGURE_ENV =	CPPFLAGS="${CPPFLAGS}" \
		LDFLAGS="${LDFLAGS}"

.include <bsd.port.mk>
