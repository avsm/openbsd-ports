$OpenBSD: patch-libtransmission_tracker_c,v 1.3 2008/12/02 15:29:07 naddy Exp $
--- libtransmission/tracker.c.orig	Mon Nov 10 16:52:25 2008
+++ libtransmission/tracker.c	Mon Dec  1 22:39:45 2008
@@ -444,7 +444,7 @@ onTrackerResponse( tr_session * session,
         if( bencLoaded )
             tr_bencFree( &benc );
     }
-    else
+    else if( responseCode )
     {
         /* %1$ld - http status code, such as 404
          * %2$s - human-readable explanation of the http status code */
@@ -457,19 +457,20 @@ onTrackerResponse( tr_session * session,
 
     retry = updateAddresses( t, success );
 
-    /**
-    ***
-    **/
-
-    if( retry )
+    if( responseCode && retry )
         responseCode = 300;
 
-    if( 200 <= responseCode && responseCode <= 299 )
+    if( responseCode == 0 )
     {
+        dbgmsg( t->name, "No response from tracker... retrying in two minutes." );
+        t->manualAnnounceAllowedAt = ~(time_t)0;
+        t->reannounceAt = time( NULL ) + t->randOffset + 120;
+    }
+    else if( 200 <= responseCode && responseCode <= 299 )
+    {
         const int    interval = t->announceIntervalSec + t->randOffset;
         const time_t now = time ( NULL );
-        dbgmsg( t->name, "request succeeded. reannouncing in %d seconds",
-                interval );
+        dbgmsg( t->name, "request succeeded. reannouncing in %d seconds", interval );
 
         /* if the announce response was a superset of the scrape response,
            treat this as both a successful announce AND scrape. */
@@ -499,8 +500,7 @@ onTrackerResponse( tr_session * session,
         const int interval = 5;
         dbgmsg( t->name, "got a redirect. retrying in %d seconds", interval );
         t->reannounceAt = time( NULL ) + interval;
-        t->manualAnnounceAllowedAt = time( NULL ) +
-                                     t->announceMinIntervalSec;
+        t->manualAnnounceAllowedAt = time( NULL ) + t->announceMinIntervalSec;
     }
     else if( 400 <= responseCode && responseCode <= 499 )
     {
@@ -524,9 +524,7 @@ onTrackerResponse( tr_session * session,
     else
     {
         /* WTF did we get?? */
-        dbgmsg(
-            t->name,
-            "Invalid response from tracker... retrying in two minutes." );
+        dbgmsg( t->name, "Invalid response from tracker... retrying in two minutes." );
         t->manualAnnounceAllowedAt = ~(time_t)0;
         t->reannounceAt = time( NULL ) + t->randOffset + 120;
     }
