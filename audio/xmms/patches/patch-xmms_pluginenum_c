$OpenBSD: patch-xmms_pluginenum_c,v 1.5 2002/04/06 19:32:39 pvalchev Exp $
--- xmms/pluginenum.c.orig	Wed Jan  2 07:21:32 2002
+++ xmms/pluginenum.c	Sat Apr  6 12:15:28 2002
@@ -35,6 +35,10 @@
 # define RTLD_NOW 0
 #endif
 
+#if defined(__OpenBSD__) && !defined(__ELF__)
+# define SYMBOL_PREFIX "_"
+#endif
+
 
 gchar *plugin_dir_list[] =
 {
@@ -431,6 +435,12 @@ void cleanup_plugins(void)
 	while (node)
 	{
 		op = (OutputPlugin *) node->data;
+		if (op != NULL && op->cleanup != NULL) {
+			op->cleanup();
+			GDK_THREADS_LEAVE();
+			while (g_main_iteration(FALSE));
+			GDK_THREADS_ENTER();
+		}
 		close_dynamic_lib(op->handle);
 		node = node->next;
 	}
