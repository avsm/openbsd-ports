$OpenBSD: patch-configure_in,v 1.2 2005/05/16 17:45:58 robert Exp $
--- configure.in.orig	Wed Dec 15 23:08:31 2004
+++ configure.in	Mon May 16 18:15:07 2005
@@ -333,26 +333,41 @@ AC_ARG_WITH(readline, [  --without-readl
 )
 if $try_readline; then
         AC_CHECK_HEADER(readline/readline.h, [
+            LIBS_save="$LIBS"
+            LDFLAGS_save="$LDFLAGS"
+            LIBS=""
+            LDFLAGS=""
             AC_CHECK_LIB(readline, rl_completion_append_character, [
-                AC_CHECK_LIB(readline, rl_completion_matches, [
+                LIBS_save="$LIBS"
+                LDFLAGS_save="$LDFLAGS"
+                LIBS=""
+                LDFLAGS=""
+                AC_CHECK_LIB(readline, completion_matches, [
                     have_readline=true
                     rl_msg="yes (doesn't require explicit -lncurses)"
                     RL_LIBS="-lreadline"
                     RL_CFLAGS=""
                     AC_DEFINE(HAVE_RL,1,[whether we use readline])
                 ], [rl_msg="no (available version too old)"])
+                LIBS="$LIBS_save"
+                LDFLAGS="$LDFLAGS_save"
             ], [
+                LIBS_save="$LIBS"
                 LDFLAGS_save="$LDFLAGS"
+                LIBS=""
                 LDFLAGS="-lncurses"
-                AC_CHECK_LIB(readline, rl_completion_matches, [
+                AC_CHECK_LIB(readline, completion_matches, [
                     have_readline=true
                     rl_msg="yes (requires explicit -lncurses)"
                     RL_LIBS="-lreadline -lncurses"
                     RL_CFLAGS=""
                     AC_DEFINE(HAVE_RL,1,[whether we use readline])
                 ], [rl_msg="no (couldn't link against it or version too old)"])
+                LIBS="$LIBS_save"
                 LDFLAGS="$LDFLAGS_save"
             ])
+            LIBS="$LIBS_save"
+            LDFLAGS="$LDFLAGS_save"
         ])
 fi
 AM_CONDITIONAL(HAVE_RL, $have_readline)
