--- sbr/m_scratch.c.~1~	Sun Jan  4 14:15:18 1998
+++ sbr/m_scratch.c	Tue Apr 28 22:58:25 1998
@@ -13,13 +13,18 @@
 {
     char *cp;
     static char buffer[BUFSIZ], tmpfil[BUFSIZ];
+    int fd;
 
-    sprintf (tmpfil, "%sXXXXXX", template);
-    mktemp (tmpfil);
+    snprintf (tmpfil, BUFSIZ, "%sXXXXXX", template);
+    fd = mkstemp( tmpfil );
+    if ( fd == -1 ) {
+        return 0;
+    }
     if ((cp = r1bindex (file, '/')) == file)
 	strcpy (buffer, tmpfil);
     else
-	sprintf (buffer, "%.*s%s", cp - file, file, tmpfil);
+	snprintf (buffer, BUFSIZ, "%.*s%s", cp - file, file, tmpfil);
+    close( fd );
     unlink (buffer);
 
     return buffer;
