# $OpenBSD: Makefile,v 1.16 2010/10/24 21:15:34 ajacoutot Exp $

COMMENT =		graphical toolkit for Tcl

DISTNAME =		tk8.5.8
PKGNAME =		tk-8.5.8
REVISION=		0
SHARED_LIBS =		tk85 0.5
CATEGORIES =		x11 x11/tk
HOMEPAGE =		http://www.tcl.tk/
MAINTAINER =		Stuart Cassoff <stwo@users.sourceforge.net>

# BSD
PERMIT_PACKAGE_CDROM =	Yes
PERMIT_PACKAGE_FTP =	Yes
PERMIT_DISTFILES_CDROM =Yes
PERMIT_DISTFILES_FTP =	Yes

WANTLIB =		X11 Xau Xdmcp Xext Xft Xrender Xss c expat fontconfig freetype m z

MASTER_SITES =		${MASTER_SITE_SOURCEFORGE:=tcl/}
DISTFILES =		${DISTNAME}-src.tar.gz

.if ${MACHINE_ARCH} != "m88k" && ${MACHINE_ARCH} != "vax"
WANTLIB +=		pthread-stubs xcb
MAKE_FLAGS +=		TK_BUILD_EXP_FILE="libtk85.a" \
			TK_EXP_FILE="libtk85.a"
.endif

FAKE_FLAGS =		INSTALL_DATA_DIR="${INSTALL_DATA_DIR}" \
			INSTALL_LIBRARY="${INSTALL_DATA}" \
			INSTALL_DATA="${INSTALL_DATA}" \
			INSTALL_PROGRAM="${INSTALL_PROGRAM}" \
			CONFIG_INSTALL_DIR="${WRKINST}${TRUEPREFIX}/lib/tk8.5" \
			DEMO_INSTALL_DIR="${WRKINST}${TRUEPREFIX}/share/examples/tk8.5"

REGRESS_FLAGS =		HOME=${TESTHOME}

SEPARATE_BUILD =	concurrent
USE_GROFF =	Yes
CONFIGURE_STYLE =	gnu old
CONFIGURE_ARGS +=	${CONFIGURE_SHARED} \
			--includedir="${PREFIX}/include/tk8.5" \
			--mandir="${PREFIX}/lib/tk8.5/man" \
			--sysconfdir="${SYSCONFDIR}" \
			--enable-man-symlinks \
			--disable-rpath \
			--with-tcl="${LOCALBASE}/lib/tcl8.5"

CONFIGURE_ENV +=	SHLIB_VERSION="${LIBtk85_VERSION}"

REGRESS_IS_INTERACTIVE = x11

FLAVORS =		threaded
FLAVOR ?=

.if ${FLAVOR:L:Mthreaded}
CONFIGURE_ARGS +=	--enable-threads
WANTLIB +=		pthread
LIB_DEPENDS =		tcl85:tcl->=8.5.8p0,<8.5.9-${FLAVOR}:lang/tcl/8.5
.else
LIB_DEPENDS =		tcl85:tcl->=8.5.8p0,<8.5.9:lang/tcl/8.5
.endif

WRKSRC =		${WRKDIST}/unix
REGRESS_TARGET =	test

TESTHOME =		${WRKDIR}/testhome

pre-regress:
	@mkdir -p ${TESTHOME}

post-install:
.if ${MACHINE_ARCH} != "m88k" && ${MACHINE_ARCH} != "vax"
	ln -s libtk85.a ${PREFIX}/lib/libtk85_pic.a
	ln -s libtkstub85.a ${PREFIX}/lib/libtkstub85_pic.a
.endif

.include <bsd.port.mk>
