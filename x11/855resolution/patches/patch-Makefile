$OpenBSD: patch-Makefile,v 1.1.1.1 2005/08/09 20:14:27 sturm Exp $
--- Makefile.orig	Sun May  8 17:27:59 2005
+++ Makefile	Tue Jul 26 12:49:55 2005
@@ -3,27 +3,30 @@ PRG=855resolution
 # Uncomment this line if you want to test with a VBIOS image file
 # VBIOS_FILE:=-DVBIOS_FILE='"../dump/vbios-865.dmp"'
 
-PLUGINS_SRCS:=${shell ls plugins/*.c}
+PLUGINS_SRCS!=ls plugins/*.c
 SRCS=855resolution.c vbios.c plugin.c ${PLUGINS_SRCS}
 OBJS=${SRCS:.c=.o}
 
-PLUGINS_LIST:=${shell cd plugins;ls -x *.c | sed -e 's/.c//g' -e 's/  */,/g' }
-PLUGINS_ADDR:=${shell echo ${PLUGINS_LIST} | sed -e 's/^/\&/g' -e 's/,/,\&/g' }
-VERSION:=${shell cat VERSION.txt}
-LDLIBS:=-lm
+PLUGINS_LIST!=cd plugins;ls -x *.c | sed -e 's/.c//g' -e 's/  *p/,p/g'
+PLUGINS_ADDR!=echo ${PLUGINS_LIST} | sed -e 's/^/\&/g' -e 's/,/,\&/g'
+VERSION!=cat VERSION.txt
+LDLIBS=-lm
 
-CFLAGS:=-Wall -I`pwd` -DVERSION='"${VERSION}"' -DPLUGINS='${PLUGINS_LIST}' -DREF_PLUGINS='${PLUGINS_ADDR}' ${VBIOS_FILE}
+CFLAGS+=-Wall -I`pwd` -DVERSION='"${VERSION}"' -DPLUGINS='${PLUGINS_LIST}' -DREF_PLUGINS='${PLUGINS_ADDR}' ${VBIOS_FILE}
 LDFLAGS:=-s
 
 all: ${PRG}
 
 ${PRG}: ${OBJS}
+	${CC} ${OBJS:S,plugins/,,} -o ${PRG} -li386
 
 clean:
 	rm -f ${OBJS} ${PRG} *~ plugins/*~
 
-install: ${PRG}
-	cp ${PRG} /usr/sbin
+install:
+	${BSD_INSTALL_PROGRAM} ${PRG} ${PREFIX}/sbin
+	${BSD_INSTALL_DATA_DIR} ${PREFIX}/share/doc/855resolution
+	${BSD_INSTALL_DATA} README.txt ${PREFIX}/share/doc/855resolution
 
 distrib: clean
 	tar -C .. -zcvf /tmp/${PRG}-`cat VERSION.txt`.tgz --exclude '.*' ${PRG}
