$OpenBSD: patch-Makefile_in,v 1.15 2010/04/02 20:07:11 sthen Exp $
--- Makefile.in.orig	Mon Mar  8 15:08:54 2010
+++ Makefile.in	Fri Mar 26 19:44:15 2010
@@ -176,11 +176,11 @@ OBJS0 = alter.lo analyze.lo attach.lo auth.lo backup.l
         table.lo tokenize.lo trigger.lo update.lo \
         util.lo vacuum.lo \
         vdbe.lo vdbeapi.lo vdbeaux.lo vdbeblob.lo vdbemem.lo vdbetrace.lo \
-        walker.lo where.lo utf.lo vtab.lo
+        walker.lo where.lo utf.lo vtab.lo pthread_stub.lo
 
 # Object files for the amalgamation.
 #
-OBJS1 = sqlite3.lo
+OBJS1 = sqlite3.lo pthread_stub.lo
 
 # Determine the real value of LIBOBJ based on the 'configure' script
 #
@@ -277,7 +277,8 @@ SRC = \
   $(TOP)/src/vdbeInt.h \
   $(TOP)/src/vtab.c \
   $(TOP)/src/walker.c \
-  $(TOP)/src/where.c
+  $(TOP)/src/where.c \
+  $(TOP)/src/pthread_stub.c
 
 # Generated source code files
 #
@@ -448,7 +449,7 @@ HDR += \
 # hidden when the library is built via the amalgamation).
 #
 TESTFIXTURE_SRC0 = $(TESTSRC2) libsqlite3.la
-TESTFIXTURE_SRC1 = sqlite3.c
+TESTFIXTURE_SRC1 = sqlite3.c $(TOP)/src/pthread_stub.c
 TESTFIXTURE_SRC = $(TESTSRC) $(TOP)/src/tclsqlite.c $(TESTFIXTURE_SRC$(USE_AMALGAMATION))
 
 
@@ -469,7 +470,7 @@ libsqlite3.la:	$(LIBOBJ)
 
 libtclsqlite3.la:	tclsqlite.lo libsqlite3.la
 	$(LTLINK) -o $@ tclsqlite.lo \
-		libsqlite3.la @TCL_STUB_LIB_SPEC@ $(TLIBS) \
+		libsqlite3.la -L./.libs @TCL_STUB_LIB_SPEC@ $(TLIBS) \
 		-rpath "$(TCLLIBDIR)" \
 		-version-info "8:6:8" \
 		-avoid-version
@@ -509,6 +510,9 @@ lemon$(BEXE):	$(TOP)/tool/lemon.c $(TOP)/src/lempar.c
 sqlite3.lo:	sqlite3.c
 	$(LTCOMPILE) $(TEMP_STORE) -c sqlite3.c
 
+pthread_stub.lo: $(TOP)/src/pthread_stub.c
+	$(LTCOMPILE) -c $(TOP)/src/pthread_stub.c
+
 # Rules to build individual files
 #
 alter.lo:	$(TOP)/src/alter.c $(HDR)
@@ -690,8 +694,9 @@ select.lo:	$(TOP)/src/select.c $(HDR)
 status.lo:	$(TOP)/src/status.c $(HDR)
 	$(LTCOMPILE) $(TEMP_STORE) -c $(TOP)/src/status.c
 
-sqlite3.h:	$(TOP)/src/sqlite.h.in $(TOP)/manifest.uuid $(TOP)/VERSION
-	tclsh $(TOP)/tool/mksqlite3h.tcl $(TOP) >sqlite3.h
+sqlite3.h:	$(TOP)/src/sqlite.h.in
+	sed -e s/--VERS--/$(RELEASE)/ $(TOP)/src/sqlite.h.in | \
+	sed -e s/--VERSION-NUMBER--/$(VERSION_NUMBER)/ >sqlite3.h
 
 table.lo:	$(TOP)/src/table.c $(HDR)
 	$(LTCOMPILE) $(TEMP_STORE) -c $(TOP)/src/table.c
@@ -820,6 +825,8 @@ clean:	
 
 distclean:	clean
 	rm -f config.log config.status libtool Makefile sqlite3.pc
+
+.PHONY: test
 
 #
 # Windows section
