$OpenBSD: patch-installer_linux_Makefile_in,v 1.19 2011/06/02 12:46:37 ajacoutot Exp $
--- installer/linux/Makefile.in.orig	Wed Apr 20 16:39:42 2011
+++ installer/linux/Makefile.in	Wed Jun  1 15:24:18 2011
@@ -53,15 +53,15 @@ am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGUR
 mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/common/config.h
 CONFIG_CLEAN_FILES =
-am__installdirs = "$(DESTDIR)$(bindir)" "$(DESTDIR)$(sysconf_initdir)" \
-	"$(DESTDIR)$(datadir)" "$(DESTDIR)$(data_configdir)" \
+am__installdirs = "$(DESTDIR)$(bindir)" \
+	"$(DESTDIR)$(datadir)" \
 	"$(DESTDIR)$(sysconf_certdir)" \
 	"$(DESTDIR)$(sysconf_configdir)" \
 	"$(DESTDIR)$(sysconf_rotatedir)" \
 	"$(DESTDIR)$(sysconf_sysconfigdir)"
 dist_binSCRIPT_INSTALL = $(INSTALL_SCRIPT)
 sysconf_initSCRIPT_INSTALL = $(INSTALL_SCRIPT)
-SCRIPTS = $(dist_bin_SCRIPTS) $(sysconf_init_SCRIPTS)
+SCRIPTS = $(dist_bin_SCRIPTS)
 SOURCES =
 DIST_SOURCES =
 am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
@@ -71,11 +71,10 @@ am__vpath_adj = case $$p in \
   esac;
 am__strip_dir = `echo $$p | sed -e 's|^.*/||'`;
 dist_dataDATA_INSTALL = $(INSTALL_DATA)
-am__dist_data_config_DATA_DIST = server.cfg unix.cfg ldap.propmap.cfg \
+am__dist_data_config_DATA_DIST = server.cfg ldap.propmap.cfg \
 	spooler.cfg gateway.cfg monitor.cfg dagent.cfg ical.cfg \
-	indexer.cfg autorespond licensed.cfg archiver.cfg \
-	ldap.openldap.cfg ldap.active-directory.cfg \
-	ldapms.openldap.cfg ldapms.active-directory.cfg
+	indexer.cfg autorespond \
+	ldap.openldap.cfg ldap.active-directory.cfg
 dist_data_configDATA_INSTALL = $(INSTALL_DATA)
 am__dist_sysconf_cert_DATA_DIST = addtrust.crt
 dist_sysconf_certDATA_INSTALL = $(INSTALL_DATA)
@@ -247,6 +246,7 @@ datadir = ${docdir}
 datarootdir = @datarootdir@
 docdir = @docdir@
 dvidir = @dvidir@
+egdir = ${prefix}/share/examples/zarafa
 exec_prefix = @exec_prefix@
 host = @host@
 host_alias = @host_alias@
@@ -276,7 +276,7 @@ sysconfdir = @sysconfdir@
 target_alias = @target_alias@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
-config_files = server.cfg unix.cfg ldap.propmap.cfg spooler.cfg \
+config_files = server.cfg ldap.propmap.cfg spooler.cfg \
 	gateway.cfg monitor.cfg dagent.cfg ical.cfg indexer.cfg \
 	autorespond $(am__append_2) $(BUILT_SOURCES)
 rhel_initscript_files = zarafa-server.init.rhel \
@@ -311,7 +311,7 @@ sysconf_sysconfigdir = ${@DISTRO@_sysconfig_path}
 sysconf_sysconfig_DATA = ${@DISTRO@_sysconfig_files}
 dist_data_DATA = \
 	db-convert-4.1-to-4.2 db-convert-4.20-to-4.21 db-convert-4.20-to-innodb.sql db-calc-storesize db-convert-attachments-to-files \
-	createuser.dotforward db-convert-4.2x-to-5.00 ssl-certificates.sh db-upgrade-objectsid-to-objectguid.pl ldap-switch-sendas.pl \
+	createuser.dotforward db-convert-4.2x-to-5.00 db-upgrade-objectsid-to-objectguid.pl ldap-switch-sendas.pl \
 	${top_srcdir}/tools/python-scripts/optimize-imap.py audit-parse.pl zarafa7-upgrade
 
 BUILT_SOURCES = ldap.openldap.cfg ldap.active-directory.cfg \
@@ -471,15 +471,7 @@ uninstall-dist_sysconf_configDATA:
 	  echo " rm -f '$(DESTDIR)$(sysconf_configdir)/$$f'"; \
 	  rm -f "$(DESTDIR)$(sysconf_configdir)/$$f"; \
 	done
-install-dist_sysconf_rotateDATA: $(dist_sysconf_rotate_DATA)
-	@$(NORMAL_INSTALL)
-	test -z "$(sysconf_rotatedir)" || $(MKDIR_P) "$(DESTDIR)$(sysconf_rotatedir)"
-	@list='$(dist_sysconf_rotate_DATA)'; for p in $$list; do \
-	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
-	  f=$(am__strip_dir) \
-	  echo " $(dist_sysconf_rotateDATA_INSTALL) '$$d$$p' '$(DESTDIR)$(sysconf_rotatedir)/$$f'"; \
-	  $(dist_sysconf_rotateDATA_INSTALL) "$$d$$p" "$(DESTDIR)$(sysconf_rotatedir)/$$f"; \
-	done
+install-dist_sysconf_rotateDATA:
 
 uninstall-dist_sysconf_rotateDATA:
 	@$(NORMAL_UNINSTALL)
@@ -543,7 +535,7 @@ check: $(BUILT_SOURCES)
 	$(MAKE) $(AM_MAKEFLAGS) check-am
 all-am: Makefile $(SCRIPTS) $(DATA)
 installdirs:
-	for dir in "$(DESTDIR)$(bindir)" "$(DESTDIR)$(sysconf_initdir)" "$(DESTDIR)$(datadir)" "$(DESTDIR)$(data_configdir)" "$(DESTDIR)$(sysconf_certdir)" "$(DESTDIR)$(sysconf_configdir)" "$(DESTDIR)$(sysconf_rotatedir)" "$(DESTDIR)$(sysconf_sysconfigdir)"; do \
+	for dir in "$(DESTDIR)$(bindir)" "$(DESTDIR)$(datadir)" "$(DESTDIR)$(data_configdir)" "$(DESTDIR)$(sysconf_certdir)" "$(DESTDIR)$(sysconf_configdir)" "$(DESTDIR)$(sysconf_sysconfigdir)"; do \
 	  test -z "$$dir" || $(MKDIR_P) "$$dir"; \
 	done
 install: $(BUILT_SOURCES)
@@ -590,9 +582,9 @@ info: info-am
 
 info-am:
 
-install-data-am: install-dist_dataDATA install-dist_data_configDATA \
+install-data-am: install-dist_dataDATA \
 	install-dist_sysconf_certDATA install-dist_sysconf_configDATA \
-	install-dist_sysconf_rotateDATA install-sysconf_initSCRIPTS \
+	install-dist_sysconf_rotateDATA \
 	install-sysconf_sysconfigDATA
 	@$(NORMAL_INSTALL)
 	$(MAKE) $(AM_MAKEFLAGS) install-data-hook
@@ -673,11 +665,7 @@ ldapms.active-directory.cfg: ldap.m4
 	m4 -DTYPE=ADS -DMULTISERVER=1 ${top_srcdir}/installer/linux/ldap.m4 > $@
 
 install-data-hook:
-	install -d -m 755 ${DESTDIR}/${sysconf_configdir}/license
 	install -d -m 755 ${DESTDIR}/${sysconf_configdir}/report
-	for f in ${DESTDIR}/${sysconf_rotatedir}/*.logrotate; do \
-		mv $$f $${f%.logrotate}; \
-	done
 	if test ${DISTRO} = "sles" -o ${DISTRO} = "suse"; then \
 		mv ${DESTDIR}${sysconf_sysconfigdir}/sysconfig.suse ${DESTDIR}${sysconf_sysconfigdir}/sysconfig.zarafa || true; \
 	elif test ${DISTRO} = "rhel"; then \
@@ -685,18 +673,12 @@ install-data-hook:
 	else \
 		true; \
 	fi
-	if test `ls -1A ${DESTDIR}${sysconf_initdir}/ | wc -l` -ne 0; then \
-		for f in ${DESTDIR}${sysconf_initdir}/*; do \
-			newf=`echo "$$f" | sed -e 's/\(zarafa-.*\).init.*/\1/'`; \
-			mv "$$f" "$$newf"; \
-		done \
-	fi
-	mkdir -p ${DESTDIR}/${docdir}/../zarafa-gateway
-	mv ${DESTDIR}/${docdir}/optimize-imap.py ${DESTDIR}/${docdir}/../zarafa-gateway
+	mkdir -p ${DESTDIR}/${docdir}/../zarafa
+	mv ${DESTDIR}/${docdir}/optimize-imap.py ${DESTDIR}/${docdir}/../zarafa
 
 .NOTPARALLEL: install-exec-local
 install-exec-local:
-	cd ${top_srcdir}/installer/linux/ && python setup.py install --root="$(DESTDIR)" --prefix="$(prefix)" --install-purelib $(pythonexeclibdir)
+	cd ${top_srcdir}/installer/linux/ && !!MODPY_BIN!! setup.py install --root="$(DESTDIR)" --prefix="$(prefix)" --install-purelib $(pythonexeclibdir)
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
 .NOEXPORT:
